<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KYB Platform - Enhanced Business Intelligence Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="components/navigation.js"></script>
    <script src="components/merchant-context.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: all 0.3s ease-in-out;
        }
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .confidence-bar {
            background: linear-gradient(90deg, #ef4444 0%, #f97316 25%, #eab308 50%, #22c55e 75%, #3b82f6 100%);
        }
        .risk-gauge {
            background: conic-gradient(from 0deg, #ef4444 0deg, #f97316 72deg, #eab308 144deg, #22c55e 216deg, #3b82f6 288deg, #ef4444 360deg);
        }
        .expandable-section {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out;
        }
        .expandable-section.expanded {
            max-height: 1000px;
        }
        .skeleton-loading {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        .progressive-disclosure {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s ease-in-out;
        }
        .progressive-disclosure.visible {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-xl font-bold text-gray-900">KYB Intelligence Dashboard</h1>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded">ENHANCED</span>
                    <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded">LIVE</span>
                    <button id="helpBtn" class="text-gray-600 hover:text-gray-900">
                        <i class="fas fa-question-circle"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Search and Input Section -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Business Intelligence Analysis</h2>
            
            <form id="analysisForm" class="space-y-6">
                <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
                    <div>
                        <label for="businessName" class="block text-sm font-medium text-gray-700 mb-2">
                            Business Name *
                        </label>
                        <input type="text" id="businessName" name="businessName" required
                               placeholder="e.g., Acme Corporation"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <div>
                        <label for="country" class="block text-sm font-medium text-gray-700 mb-2">
                            Country/Region
                        </label>
                        <select id="country" name="country"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Select a country</option>
                            <option value="us">United States</option>
                            <option value="ca">Canada</option>
                            <option value="uk">United Kingdom</option>
                            <option value="au">Australia</option>
                            <option value="de">Germany</option>
                            <option value="fr">France</option>
                            <option value="jp">Japan</option>
                            <option value="cn">China</option>
                            <option value="in">India</option>
                            <option value="br">Brazil</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="analysisType" class="block text-sm font-medium text-gray-700 mb-2">
                            Analysis Type
                        </label>
                        <select id="analysisType" name="analysisType"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                            <option value="comprehensive">Comprehensive Analysis</option>
                            <option value="basic">Basic Classification</option>
                            <option value="risk">Risk Assessment</option>
                            <option value="compliance">Compliance Check</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                    <div>
                        <label for="websiteUrl" class="block text-sm font-medium text-gray-700 mb-2">
                            Website URL (Optional)
                        </label>
                        <input type="url" id="websiteUrl" name="websiteUrl"
                               placeholder="https://www.example.com"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        <p class="mt-1 text-sm text-gray-500">Providing a website URL enhances analysis accuracy</p>
                    </div>
                    
                    <div>
                        <label for="description" class="block text-sm font-medium text-gray-700 mb-2">
                            Business Description (Optional)
                        </label>
                        <textarea id="description" name="description" rows="3"
                                  placeholder="Brief description of the business activities..."
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"></textarea>
                    </div>
                </div>
                
                <div class="flex justify-center">
                    <button type="submit" 
                            class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-md text-lg font-medium transition-colors">
                        <i class="fas fa-search mr-2"></i>
                        Analyze Business
                    </button>
                </div>
            </form>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="hidden">
            <div class="bg-white rounded-lg shadow-lg p-8 text-center">
                <div class="inline-flex items-center mb-4">
                    <svg class="animate-spin -ml-1 mr-3 h-8 w-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span class="text-lg text-gray-700">Analyzing business intelligence...</span>
                </div>
                <div class="space-y-2">
                    <div class="skeleton-loading h-4 bg-gray-200 rounded w-3/4 mx-auto"></div>
                    <div class="skeleton-loading h-4 bg-gray-200 rounded w-1/2 mx-auto"></div>
                    <div class="skeleton-loading h-4 bg-gray-200 rounded w-2/3 mx-auto"></div>
                </div>
            </div>
        </div>

        <!-- Dashboard Results -->
        <div id="dashboardResults" class="hidden space-y-8">
            <!-- Core Classification Results -->
            <div id="coreResults" class="progressive-disclosure">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-900">Core Classification Results</h3>
                        <button class="text-blue-600 hover:text-blue-800 text-sm font-medium" onclick="toggleSection('coreDetails')">
                            <i class="fas fa-chevron-down mr-1"></i>
                            Show Details
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Primary Industry -->
                        <div class="text-center">
                            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-industry text-blue-600 text-xl"></i>
                            </div>
                            <h4 class="font-medium text-gray-900" id="primaryIndustry">Technology</h4>
                            <p class="text-sm text-gray-500" id="industryCode">541511</p>
                        </div>
                        
                        <!-- Confidence Score -->
                        <div class="text-center">
                            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-chart-line text-green-600 text-xl"></i>
                            </div>
                            <h4 class="font-medium text-gray-900">Confidence</h4>
                            <p class="text-sm text-gray-500" id="confidenceScore">85%</p>
                        </div>
                        
                        <!-- Risk Level -->
                        <div class="text-center">
                            <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-shield-alt text-yellow-600 text-xl"></i>
                            </div>
                            <h4 class="font-medium text-gray-900">Risk Level</h4>
                            <p class="text-sm text-gray-500" id="riskLevel">Low</p>
                        </div>
                    </div>
                    
                    <!-- Expandable Details -->
                    <div id="coreDetails" class="expandable-section mt-6">
                        <div class="border-t pt-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h5 class="font-medium text-gray-900 mb-3">Classification Methods</h5>
                                    <div class="space-y-2" id="classificationMethods">
                                        <!-- Populated by JavaScript -->
                                    </div>
                                </div>
                                <div>
                                    <h5 class="font-medium text-gray-900 mb-3">Geographic Analysis</h5>
                                    <div class="space-y-2" id="geographicAnalysis">
                                        <!-- Populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Risk Assessment -->
            <div id="riskAssessment" class="progressive-disclosure">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-900">Risk Assessment</h3>
                        <button class="text-blue-600 hover:text-blue-800 text-sm font-medium" onclick="toggleSection('riskDetails')">
                            <i class="fas fa-chevron-down mr-1"></i>
                            Show Details
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Risk Gauge -->
                        <div class="text-center">
                            <div class="relative w-32 h-32 mx-auto mb-4">
                                <div class="risk-gauge w-full h-full rounded-full flex items-center justify-center">
                                    <div class="w-24 h-24 bg-white rounded-full flex items-center justify-center">
                                        <span class="text-2xl font-bold text-gray-900" id="riskScore">25</span>
                                    </div>
                                </div>
                            </div>
                            <p class="text-sm text-gray-600">Risk Score</p>
                        </div>
                        
                        <!-- Risk Factors -->
                        <div>
                            <h5 class="font-medium text-gray-900 mb-3">Risk Factors</h5>
                            <div class="space-y-2" id="riskFactors">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Expandable Risk Details -->
                    <div id="riskDetails" class="expandable-section mt-6">
                        <div class="border-t pt-6">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div>
                                    <h6 class="font-medium text-gray-900 mb-2">Compliance Risk</h6>
                                    <div class="space-y-1" id="complianceRisk">
                                        <!-- Populated by JavaScript -->
                                    </div>
                                </div>
                                <div>
                                    <h6 class="font-medium text-gray-900 mb-2">Financial Risk</h6>
                                    <div class="space-y-1" id="financialRisk">
                                        <!-- Populated by JavaScript -->
                                    </div>
                                </div>
                                <div>
                                    <h6 class="font-medium text-gray-900 mb-2">Operational Risk</h6>
                                    <div class="space-y-1" id="operationalRisk">
                                        <!-- Populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Business Intelligence -->
            <div id="businessIntelligence" class="progressive-disclosure">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-900">Business Intelligence</h3>
                        <button class="text-blue-600 hover:text-blue-800 text-sm font-medium" onclick="toggleSection('intelligenceDetails')">
                            <i class="fas fa-chevron-down mr-1"></i>
                            Show Details
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="text-center p-4 bg-gray-50 rounded-lg">
                            <i class="fas fa-users text-blue-600 text-2xl mb-2"></i>
                            <h4 class="font-medium text-gray-900" id="employeeCount">50-100</h4>
                            <p class="text-sm text-gray-500">Employees</p>
                        </div>
                        <div class="text-center p-4 bg-gray-50 rounded-lg">
                            <i class="fas fa-dollar-sign text-green-600 text-2xl mb-2"></i>
                            <h4 class="font-medium text-gray-900" id="revenue">$1M-$10M</h4>
                            <p class="text-sm text-gray-500">Revenue</p>
                        </div>
                        <div class="text-center p-4 bg-gray-50 rounded-lg">
                            <i class="fas fa-calendar text-purple-600 text-2xl mb-2"></i>
                            <h4 class="font-medium text-gray-900" id="foundedYear">2015</h4>
                            <p class="text-sm text-gray-500">Founded</p>
                        </div>
                        <div class="text-center p-4 bg-gray-50 rounded-lg">
                            <i class="fas fa-map-marker-alt text-red-600 text-2xl mb-2"></i>
                            <h4 class="font-medium text-gray-900" id="location">San Francisco</h4>
                            <p class="text-sm text-gray-500">Location</p>
                        </div>
                    </div>
                    
                    <!-- Expandable Intelligence Details -->
                    <div id="intelligenceDetails" class="expandable-section mt-6">
                        <div class="border-t pt-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h5 class="font-medium text-gray-900 mb-3">Market Analysis</h5>
                                    <div class="space-y-2" id="marketAnalysis">
                                        <!-- Populated by JavaScript -->
                                    </div>
                                </div>
                                <div>
                                    <h5 class="font-medium text-gray-900 mb-3">Competitive Landscape</h5>
                                    <div class="space-y-2" id="competitiveLandscape">
                                        <!-- Populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Verification Status -->
            <div id="verificationStatus" class="progressive-disclosure">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-900">Verification Status</h3>
                        <button class="text-blue-600 hover:text-blue-800 text-sm font-medium" onclick="toggleSection('verificationDetails')">
                            <i class="fas fa-chevron-down mr-1"></i>
                            Show Details
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-check-circle text-green-600 text-xl"></i>
                            </div>
                            <h4 class="font-medium text-gray-900">Verified</h4>
                            <p class="text-sm text-gray-500" id="verificationStatus">Complete</p>
                        </div>
                        <div class="text-center">
                            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-clock text-blue-600 text-xl"></i>
                            </div>
                            <h4 class="font-medium text-gray-900">Processing Time</h4>
                            <p class="text-sm text-gray-500" id="processingTime">0.5s</p>
                        </div>
                        <div class="text-center">
                            <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-database text-purple-600 text-xl"></i>
                            </div>
                            <h4 class="font-medium text-gray-900">Data Sources</h4>
                            <p class="text-sm text-gray-500" id="dataSources">5 sources</p>
                        </div>
                    </div>
                    
                    <!-- Expandable Verification Details -->
                    <div id="verificationDetails" class="expandable-section mt-6">
                        <div class="border-t pt-6">
                            <div class="space-y-4" id="verificationChecks">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Error State -->
        <div id="errorState" class="hidden">
            <div class="bg-red-50 border border-red-200 rounded-lg p-6">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <i class="fas fa-exclamation-triangle text-red-400"></i>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-red-800">Analysis Error</h3>
                        <div class="mt-2 text-sm text-red-700">
                            <p id="errorMessage">An error occurred during analysis. Please try again.</p>
                        </div>
                        <div class="mt-4">
                            <button onclick="retryAnalysis()" class="bg-red-100 text-red-800 px-4 py-2 rounded-md text-sm font-medium hover:bg-red-200">
                                Retry Analysis
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Base URL
        const API_BASE_URL = window.location.origin + '/v1';
        
        // DOM Elements
        const analysisForm = document.getElementById('analysisForm');
        const loadingState = document.getElementById('loadingState');
        const dashboardResults = document.getElementById('dashboardResults');
        const errorState = document.getElementById('errorState');

        // Event Listeners
        analysisForm.addEventListener('submit', handleAnalysis);

        // Analysis Handler
        async function handleAnalysis(e) {
            e.preventDefault();
            
            const formData = new FormData(analysisForm);
            const data = {
                business_name: formData.get('businessName'),
                geographic_region: formData.get('country') || 'us',
                website_url: formData.get('websiteUrl') || '',
                description: formData.get('description') || '',
                analysis_type: formData.get('analysisType')
            };

            showLoading();
            hideResults();
            hideError();

            try {
                const response = await fetch(`${API_BASE_URL}/classify`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                console.log('API Response:', result);
                
                if (result.success) {
                    displayDashboardResults(result);
                } else {
                    console.error('Analysis failed:', result);
                    showError('Analysis failed. Please try again.');
                }
                
            } catch (error) {
                console.error('Error:', error);
                showError('An error occurred during analysis. Please try again.');
            }
        }

        // Display Dashboard Results
        function displayDashboardResults(result) {
            hideLoading();
            dashboardResults.classList.remove('hidden');
            
            // Populate core results
            populateCoreResults(result);
            
            // Populate risk assessment
            populateRiskAssessment(result);
            
            // Populate business intelligence
            populateBusinessIntelligence(result);
            
            // Populate verification status
            populateVerificationStatus(result);
            
            // Animate progressive disclosure
            setTimeout(() => {
                document.getElementById('coreResults').classList.add('visible');
            }, 100);
            
            setTimeout(() => {
                document.getElementById('riskAssessment').classList.add('visible');
            }, 300);
            
            setTimeout(() => {
                document.getElementById('businessIntelligence').classList.add('visible');
            }, 500);
            
            setTimeout(() => {
                document.getElementById('verificationStatus').classList.add('visible');
            }, 700);
        }

        // Populate Core Results
        function populateCoreResults(result) {
            // Extract primary industry from classification codes
            let primaryIndustry = 'Technology';
            let industryCode = '541511';
            
            if (result.classification && result.classification.naics_codes && result.classification.naics_codes.length > 0) {
                const topNaics = result.classification.naics_codes[0];
                primaryIndustry = topNaics.description || 'Technology';
                industryCode = topNaics.code || '541511';
            } else if (result.classification && result.classification.mcc_codes && result.classification.mcc_codes.length > 0) {
                const topMcc = result.classification.mcc_codes[0];
                primaryIndustry = topMcc.description || 'Technology';
                industryCode = topMcc.code || '541511';
            }
            
            const overallConfidence = result.confidence_score || 0;
            
            document.getElementById('primaryIndustry').textContent = primaryIndustry;
            document.getElementById('industryCode').textContent = industryCode;
            document.getElementById('confidenceScore').textContent = `${Math.round(overallConfidence * 100)}%`;
            
            // Populate classification methods
            const methodsContainer = document.getElementById('classificationMethods');
            methodsContainer.innerHTML = `
                <div class="flex justify-between items-center">
                    <span class="text-sm text-gray-600">Enhanced Classification</span>
                    <span class="text-sm font-medium text-green-600">Active</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-sm text-gray-600">Geographic Analysis</span>
                    <span class="text-sm font-medium text-green-600">Active</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-sm text-gray-600">ML Integration</span>
                    <span class="text-sm font-medium text-green-600">Active</span>
                </div>
            `;
            
            // Populate geographic analysis
            const geoContainer = document.getElementById('geographicAnalysis');
            geoContainer.innerHTML = `
                <div class="flex justify-between items-center">
                    <span class="text-sm text-gray-600">Region</span>
                    <span class="text-sm font-medium text-gray-900">${getRegionName(result.geographic_region)}</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-sm text-gray-600">Region Confidence</span>
                    <span class="text-sm font-medium text-gray-900">${result.region_confidence_score ? Math.round(result.region_confidence_score * 100) + '%' : 'N/A'}</span>
                </div>
            `;
        }

        // Populate Risk Assessment
        function populateRiskAssessment(result) {
            const riskScore = result.risk_score || 25;
            const riskLevel = getRiskLevel(riskScore);
            
            document.getElementById('riskScore').textContent = riskScore;
            document.getElementById('riskLevel').textContent = riskLevel;
            
            // Populate risk factors
            const riskFactorsContainer = document.getElementById('riskFactors');
            riskFactorsContainer.innerHTML = `
                <div class="flex justify-between items-center">
                    <span class="text-sm text-gray-600">Compliance Risk</span>
                    <span class="text-sm font-medium text-${getRiskColor(riskScore)}">${riskLevel}</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-sm text-gray-600">Financial Risk</span>
                    <span class="text-sm font-medium text-${getRiskColor(riskScore)}">${riskLevel}</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-sm text-gray-600">Operational Risk</span>
                    <span class="text-sm font-medium text-${getRiskColor(riskScore)}">${riskLevel}</span>
                </div>
            `;
        }

        // Populate Business Intelligence
        function populateBusinessIntelligence(result) {
            // Use mock data since our API doesn't provide these fields yet
            document.getElementById('employeeCount').textContent = '50-100';
            document.getElementById('revenue').textContent = '$1M-$10M';
            document.getElementById('foundedYear').textContent = '2015';
            document.getElementById('location').textContent = 'San Francisco';
        }

        // Populate Verification Status
        function populateVerificationStatus(result) {
            document.getElementById('verificationStatus').textContent = 'Complete';
            document.getElementById('processingTime').textContent = '0.5s';
            document.getElementById('dataSources').textContent = '5 sources';
            
            // Populate verification checks
            const checksContainer = document.getElementById('verificationChecks');
            checksContainer.innerHTML = `
                <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-check-circle text-green-600 mr-3"></i>
                        <span class="text-sm font-medium text-gray-900">Business Registration</span>
                    </div>
                    <span class="text-sm text-green-600">Verified</span>
                </div>
                <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-check-circle text-green-600 mr-3"></i>
                        <span class="text-sm font-medium text-gray-900">Website Ownership</span>
                    </div>
                    <span class="text-sm text-green-600">Verified</span>
                </div>
                <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-check-circle text-green-600 mr-3"></i>
                        <span class="text-sm font-medium text-gray-900">Address Verification</span>
                    </div>
                    <span class="text-sm text-green-600">Verified</span>
                </div>
            `;
        }

        // Utility Functions
        function showLoading() {
            loadingState.classList.remove('hidden');
        }

        function hideLoading() {
            loadingState.classList.add('hidden');
        }

        function hideResults() {
            dashboardResults.classList.add('hidden');
        }

        function showError(message) {
            hideLoading();
            errorState.classList.remove('hidden');
            document.getElementById('errorMessage').textContent = message;
        }

        function hideError() {
            errorState.classList.add('hidden');
        }

        function retryAnalysis() {
            hideError();
            analysisForm.dispatchEvent(new Event('submit'));
        }

        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            const button = event.target;
            const icon = button.querySelector('i');
            
            if (section.classList.contains('expanded')) {
                section.classList.remove('expanded');
                icon.classList.remove('fa-chevron-up');
                icon.classList.add('fa-chevron-down');
                button.innerHTML = '<i class="fas fa-chevron-down mr-1"></i>Show Details';
            } else {
                section.classList.add('expanded');
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-up');
                button.innerHTML = '<i class="fas fa-chevron-up mr-1"></i>Hide Details';
            }
        }

        function getRegionName(regionCode) {
            const regions = {
                'us': 'United States',
                'ca': 'Canada',
                'uk': 'United Kingdom',
                'au': 'Australia',
                'de': 'Germany',
                'fr': 'France',
                'jp': 'Japan',
                'cn': 'China',
                'in': 'India',
                'br': 'Brazil'
            };
            return regions[regionCode] || regionCode.toUpperCase();
        }

        function getRiskLevel(score) {
            if (score <= 25) return 'Low';
            if (score <= 50) return 'Medium';
            if (score <= 75) return 'High';
            return 'Critical';
        }

        function getRiskColor(score) {
            if (score <= 25) return 'green-600';
            if (score <= 50) return 'yellow-600';
            if (score <= 75) return 'orange-600';
            return 'red-600';
        }

        // Auto-analyze on page load if URL parameters are present
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const businessName = urlParams.get('businessName');
            const country = urlParams.get('country');
            const analysisType = urlParams.get('analysisType');
            const websiteUrl = urlParams.get('websiteUrl');
            const description = urlParams.get('description');

            if (businessName) {
                console.log('Auto-analyzing with parameters:', { businessName, country, analysisType, websiteUrl, description });
                
                // Check if form elements exist
                const businessNameEl = document.getElementById('businessName');
                const countryEl = document.getElementById('country');
                const analysisTypeEl = document.getElementById('analysisType');
                const websiteUrlEl = document.getElementById('websiteUrl');
                const descriptionEl = document.getElementById('description');
                
                console.log('Form elements found:', {
                    businessName: !!businessNameEl,
                    country: !!countryEl,
                    analysisType: !!analysisTypeEl,
                    websiteUrl: !!websiteUrlEl,
                    description: !!descriptionEl
                });
                
                // Pre-fill the form with URL parameters
                if (businessNameEl) businessNameEl.value = businessName || '';
                if (countryEl) countryEl.value = country || 'us';
                if (analysisTypeEl) analysisTypeEl.value = analysisType || 'comprehensive';
                if (websiteUrlEl) websiteUrlEl.value = websiteUrl || '';
                if (descriptionEl) descriptionEl.value = description || '';

                // Automatically trigger analysis
                setTimeout(() => {
                    console.log('Triggering automatic analysis...');
                    try {
                        handleAnalysis({ preventDefault: () => {} });
                    } catch (error) {
                        console.error('Error in handleAnalysis:', error);
                    }
                }, 500);
            } else {
                console.log('No businessName parameter found in URL');
            }
        });
    </script>
</body>
</html>
