<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KYB Platform - Enhanced Business Intelligence Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="components/navigation.js"></script>
    <script src="components/merchant-context.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: all 0.3s ease-in-out;
        }
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .confidence-bar {
            background: linear-gradient(90deg, #ef4444 0%, #f97316 25%, #eab308 50%, #22c55e 75%, #3b82f6 100%);
        }
        .risk-gauge {
            background: conic-gradient(from 0deg, #ef4444 0deg, #f97316 72deg, #eab308 144deg, #22c55e 216deg, #3b82f6 288deg, #ef4444 360deg);
        }
        .expandable-section {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out;
        }
        .expandable-section.expanded {
            max-height: 1000px;
        }
        .skeleton-loading {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        .progressive-disclosure {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s ease-in-out;
        }
        .progressive-disclosure.visible {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-xl font-bold text-gray-900">KYB Intelligence Dashboard</h1>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded">ENHANCED</span>
                    <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded">LIVE</span>
                    <button id="helpBtn" class="text-gray-600 hover:text-gray-900">
                        <i class="fas fa-question-circle"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Search and Input Section -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Business Intelligence Analysis</h2>
            
            <form id="analysisForm" class="space-y-6">
                <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
                    <div>
                        <label for="businessName" class="block text-sm font-medium text-gray-700 mb-2">
                            Business Name *
                        </label>
                        <input type="text" id="businessName" name="businessName" required
                               placeholder="e.g., Acme Corporation"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <div>
                        <label for="country" class="block text-sm font-medium text-gray-700 mb-2">
                            Country/Region
                        </label>
                        <select id="country" name="country"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Select a country</option>
                            <option value="us">United States</option>
                            <option value="ca">Canada</option>
                            <option value="uk">United Kingdom</option>
                            <option value="au">Australia</option>
                            <option value="de">Germany</option>
                            <option value="fr">France</option>
                            <option value="jp">Japan</option>
                            <option value="cn">China</option>
                            <option value="in">India</option>
                            <option value="br">Brazil</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="analysisType" class="block text-sm font-medium text-gray-700 mb-2">
                            Analysis Type
                        </label>
                        <select id="analysisType" name="analysisType"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                            <option value="comprehensive">Comprehensive Analysis</option>
                            <option value="basic">Basic Classification</option>
                            <option value="risk">Risk Assessment</option>
                            <option value="compliance">Compliance Check</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                    <div>
                        <label for="websiteUrl" class="block text-sm font-medium text-gray-700 mb-2">
                            Website URL (Optional)
                        </label>
                        <input type="url" id="websiteUrl" name="websiteUrl"
                               placeholder="https://www.example.com"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        <p class="mt-1 text-sm text-gray-500">Providing a website URL enhances analysis accuracy</p>
                    </div>
                    
                    <div>
                        <label for="description" class="block text-sm font-medium text-gray-700 mb-2">
                            Business Description (Optional)
                        </label>
                        <textarea id="description" name="description" rows="3"
                                  placeholder="Brief description of the business activities..."
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"></textarea>
                    </div>
                </div>
                
                <div class="flex justify-center">
                    <button type="submit" 
                            class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-md text-lg font-medium transition-colors">
                        <i class="fas fa-search mr-2"></i>
                        Analyze Business
                    </button>
                </div>
            </form>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="hidden">
            <div class="bg-white rounded-lg shadow-lg p-8 text-center">
                <div class="inline-flex items-center mb-4">
                    <svg class="animate-spin -ml-1 mr-3 h-8 w-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span class="text-lg text-gray-700">Analyzing business intelligence...</span>
                </div>
                <div class="space-y-2">
                    <div class="skeleton-loading h-4 bg-gray-200 rounded w-3/4 mx-auto"></div>
                    <div class="skeleton-loading h-4 bg-gray-200 rounded w-1/2 mx-auto"></div>
                    <div class="skeleton-loading h-4 bg-gray-200 rounded w-2/3 mx-auto"></div>
                </div>
            </div>
        </div>

        <!-- Dashboard Results -->
        <div id="dashboardResults" class="hidden space-y-8">
            <!-- Core Classification Results -->
            <div id="coreResults" class="progressive-disclosure">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-900">Core Classification Results</h3>
                        <button class="text-blue-600 hover:text-blue-800 text-sm font-medium" onclick="toggleSection('coreDetails')">
                            <i class="fas fa-chevron-down mr-1"></i>
                            Show Details
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Primary Industry -->
                        <div class="text-center">
                            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-industry text-blue-600 text-xl"></i>
                            </div>
                            <h4 class="font-medium text-gray-900" id="primaryIndustry">Technology</h4>
                            <p class="text-sm text-gray-500" id="industryCode">541511</p>
                        </div>
                        
                        <!-- Confidence Score -->
                        <div class="text-center">
                            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-chart-line text-green-600 text-xl"></i>
                            </div>
                            <h4 class="font-medium text-gray-900">Confidence</h4>
                            <p class="text-sm text-gray-500" id="confidenceScore">85%</p>
                        </div>
                        
                        <!-- Risk Level -->
                        <div class="text-center">
                            <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-shield-alt text-yellow-600 text-xl"></i>
                            </div>
                            <h4 class="font-medium text-gray-900">Risk Level</h4>
                            <p class="text-sm text-gray-500" id="riskLevel">Low</p>
                        </div>
                    </div>
                    
                    <!-- Expandable Details -->
                    <div id="coreDetails" class="expandable-section mt-6">
                        <div class="border-t pt-6">
                            <!-- Enhanced Classification Results -->
                            <div id="enhancedClassificationResults" class="mb-6">
                                <!-- Top 3 Results for Each Code Type -->
                                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                                    <!-- MCC Codes -->
                                    <div id="mccCodesCard" class="bg-gray-50 rounded-lg p-4">
                                        <div class="flex items-center mb-3">
                                            <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                                <span class="text-blue-600 font-bold text-sm">M</span>
                                            </div>
                                            <h6 class="font-medium text-gray-900">MCC Codes</h6>
                                        </div>
                                        <div id="mccCodesList" class="space-y-3">
                                            <!-- Populated by JavaScript -->
                                        </div>
                                    </div>
                                    
                                    <!-- SIC Codes -->
                                    <div id="sicCodesCard" class="bg-gray-50 rounded-lg p-4">
                                        <div class="flex items-center mb-3">
                                            <div class="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center mr-3">
                                                <span class="text-red-600 font-bold text-sm">S</span>
                                            </div>
                                            <h6 class="font-medium text-gray-900">SIC Codes</h6>
                                        </div>
                                        <div id="sicCodesList" class="space-y-3">
                                            <!-- Populated by JavaScript -->
                                        </div>
                                    </div>
                                    
                                    <!-- NAICS Codes -->
                                    <div id="naicsCodesCard" class="bg-gray-50 rounded-lg p-4">
                                        <div class="flex items-center mb-3">
                                            <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center mr-3">
                                                <span class="text-green-600 font-bold text-sm">N</span>
                                            </div>
                                            <h6 class="font-medium text-gray-900">NAICS Codes</h6>
                                        </div>
                                        <div id="naicsCodesList" class="space-y-3">
                                            <!-- Populated by JavaScript -->
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Method Breakdown -->
                                <div id="methodBreakdownSection" class="mb-6">
                                    <h5 class="font-medium text-gray-900 mb-3">Classification Methods Used</h5>
                                    <div id="methodBreakdown" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        <!-- Populated by JavaScript -->
                                    </div>
                                </div>
                                
                                <!-- Website Keywords -->
                                <div id="websiteKeywordsSection" class="mb-6">
                                    <div class="flex items-center justify-between mb-3">
                                        <h5 class="font-medium text-gray-900">Website Keywords Used</h5>
                                        <button id="toggleKeywordsBtn" class="text-blue-600 hover:text-blue-800 text-sm font-medium flex items-center">
                                            <span id="toggleKeywordsText">Show Keywords</span>
                                            <svg id="toggleKeywordsIcon" class="w-4 h-4 ml-1 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                            </svg>
                                        </button>
                                    </div>
                                    <div id="websiteKeywords" class="flex flex-wrap gap-2" style="display: none;">
                                        <!-- Populated by JavaScript -->
                                    </div>
                                </div>
                                
                                <!-- Classification Reasoning -->
                                <div id="classificationReasoningSection" class="mb-6">
                                    <h5 class="font-medium text-gray-900 mb-3">Classification Reasoning</h5>
                                    <div id="classificationReasoning" class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                                        <!-- Populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Security Indicators Section -->
            <div id="securityIndicators" class="progressive-disclosure">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-900">Security & Trust Indicators</h3>
                        <button class="text-blue-600 hover:text-blue-800 text-sm font-medium" onclick="toggleSection('securityDetails')">
                            <i class="fas fa-chevron-down mr-1"></i>
                            Show Details
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <!-- Data Source Trust -->
                        <div class="text-center">
                            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-shield-check text-green-600 text-xl"></i>
                            </div>
                            <h4 class="font-medium text-gray-900">Data Source</h4>
                            <p class="text-sm text-gray-500" id="dataSourceTrust">Trusted</p>
                        </div>
                        
                        <!-- Website Verification -->
                        <div class="text-center">
                            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-globe text-blue-600 text-xl"></i>
                            </div>
                            <h4 class="font-medium text-gray-900">Website</h4>
                            <p class="text-sm text-gray-500" id="websiteVerification">Verified</p>
                        </div>
                        
                        <!-- Security Validation -->
                        <div class="text-center">
                            <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-lock text-purple-600 text-xl"></i>
                            </div>
                            <h4 class="font-medium text-gray-900">Security</h4>
                            <p class="text-sm text-gray-500" id="securityValidation">Validated</p>
                        </div>
                        
                        <!-- Trust Score -->
                        <div class="text-center">
                            <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-star text-yellow-600 text-xl"></i>
                            </div>
                            <h4 class="font-medium text-gray-900">Trust Score</h4>
                            <p class="text-sm text-gray-500" id="trustScore">95%</p>
                        </div>
                    </div>
                    
                    <!-- Expandable Security Details -->
                    <div id="securityDetails" class="expandable-section mt-6">
                        <div class="border-t pt-6">
                            <div id="securityDetailsContent">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quality Metrics Section -->
            <div id="qualityMetrics" class="progressive-disclosure">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-900">Data Quality Metrics</h3>
                        <button class="text-blue-600 hover:text-blue-800 text-sm font-medium" onclick="toggleSection('qualityDetails')">
                            <i class="fas fa-chevron-down mr-1"></i>
                            Show Details
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-6">
                        <!-- Overall Quality -->
                        <div class="text-center">
                            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-award text-green-600 text-xl"></i>
                            </div>
                            <h4 class="font-medium text-gray-900">Overall Quality</h4>
                            <p class="text-sm text-gray-500" id="overallQuality">A</p>
                        </div>
                        
                        <!-- Evidence Strength -->
                        <div class="text-center">
                            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-chart-bar text-blue-600 text-xl"></i>
                            </div>
                            <h4 class="font-medium text-gray-900">Evidence</h4>
                            <p class="text-sm text-gray-500" id="evidenceStrength">Strong</p>
                        </div>
                        
                        <!-- Data Completeness -->
                        <div class="text-center">
                            <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-database text-purple-600 text-xl"></i>
                            </div>
                            <h4 class="font-medium text-gray-900">Completeness</h4>
                            <p class="text-sm text-gray-500" id="dataCompleteness">85%</p>
                        </div>
                        
                        <!-- Method Agreement -->
                        <div class="text-center">
                            <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-handshake text-yellow-600 text-xl"></i>
                            </div>
                            <h4 class="font-medium text-gray-900">Agreement</h4>
                            <p class="text-sm text-gray-500" id="methodAgreement">75%</p>
                        </div>
                        
                        <!-- Confidence Variance -->
                        <div class="text-center">
                            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-chart-line text-red-600 text-xl"></i>
                            </div>
                            <h4 class="font-medium text-gray-900">Consistency</h4>
                            <p class="text-sm text-gray-500" id="confidenceVariance">Low</p>
                        </div>
                    </div>
                    
                    <!-- Expandable Quality Details -->
                    <div id="qualityDetails" class="expandable-section mt-6">
                        <div class="border-t pt-6">
                            <div id="qualityDetailsContent">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Risk Assessment -->
            <div id="riskAssessment" class="progressive-disclosure">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-900">Risk Assessment</h3>
                        <button class="text-blue-600 hover:text-blue-800 text-sm font-medium" onclick="toggleSection('riskDetails')">
                            <i class="fas fa-chevron-down mr-1"></i>
                            Show Details
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Risk Gauge -->
                        <div class="text-center">
                            <div class="relative w-32 h-32 mx-auto mb-4">
                                <div class="risk-gauge w-full h-full rounded-full flex items-center justify-center">
                                    <div class="w-24 h-24 bg-white rounded-full flex items-center justify-center">
                                        <span class="text-2xl font-bold text-gray-900" id="riskScore">25</span>
                                    </div>
                                </div>
                            </div>
                            <p class="text-sm text-gray-600">Risk Score</p>
                        </div>
                        
                        <!-- Risk Factors -->
                        <div>
                            <h5 class="font-medium text-gray-900 mb-3">Risk Factors</h5>
                            <div class="space-y-2" id="riskFactors">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Expandable Risk Details -->
                    <div id="riskDetails" class="expandable-section mt-6">
                        <div class="border-t pt-6">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div>
                                    <h6 class="font-medium text-gray-900 mb-2">Compliance Risk</h6>
                                    <div class="space-y-1" id="complianceRisk">
                                        <!-- Populated by JavaScript -->
                                    </div>
                                </div>
                                <div>
                                    <h6 class="font-medium text-gray-900 mb-2">Financial Risk</h6>
                                    <div class="space-y-1" id="financialRisk">
                                        <!-- Populated by JavaScript -->
                                    </div>
                                </div>
                                <div>
                                    <h6 class="font-medium text-gray-900 mb-2">Operational Risk</h6>
                                    <div class="space-y-1" id="operationalRisk">
                                        <!-- Populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Business Intelligence -->
            <div id="businessIntelligence" class="progressive-disclosure">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-900">Business Intelligence</h3>
                        <button class="text-blue-600 hover:text-blue-800 text-sm font-medium" onclick="toggleSection('intelligenceDetails')">
                            <i class="fas fa-chevron-down mr-1"></i>
                            Show Details
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="text-center p-4 bg-gray-50 rounded-lg">
                            <i class="fas fa-users text-blue-600 text-2xl mb-2"></i>
                            <h4 class="font-medium text-gray-900" id="employeeCount">50-100</h4>
                            <p class="text-sm text-gray-500">Employees</p>
                        </div>
                        <div class="text-center p-4 bg-gray-50 rounded-lg">
                            <i class="fas fa-dollar-sign text-green-600 text-2xl mb-2"></i>
                            <h4 class="font-medium text-gray-900" id="revenue">$1M-$10M</h4>
                            <p class="text-sm text-gray-500">Revenue</p>
                        </div>
                        <div class="text-center p-4 bg-gray-50 rounded-lg">
                            <i class="fas fa-calendar text-purple-600 text-2xl mb-2"></i>
                            <h4 class="font-medium text-gray-900" id="foundedYear">2015</h4>
                            <p class="text-sm text-gray-500">Founded</p>
                        </div>
                        <div class="text-center p-4 bg-gray-50 rounded-lg">
                            <i class="fas fa-map-marker-alt text-red-600 text-2xl mb-2"></i>
                            <h4 class="font-medium text-gray-900" id="location">San Francisco</h4>
                            <p class="text-sm text-gray-500">Location</p>
                        </div>
                    </div>
                    
                    <!-- Expandable Intelligence Details -->
                    <div id="intelligenceDetails" class="expandable-section mt-6">
                        <div class="border-t pt-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h5 class="font-medium text-gray-900 mb-3">Market Analysis</h5>
                                    <div class="space-y-2" id="marketAnalysis">
                                        <!-- Populated by JavaScript -->
                                    </div>
                                </div>
                                <div>
                                    <h5 class="font-medium text-gray-900 mb-3">Competitive Landscape</h5>
                                    <div class="space-y-2" id="competitiveLandscape">
                                        <!-- Populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Verification Status -->
            <div id="verificationStatusSection" class="progressive-disclosure">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-900">Verification Status</h3>
                        <button class="text-blue-600 hover:text-blue-800 text-sm font-medium" onclick="toggleSection('verificationDetails')">
                            <i class="fas fa-chevron-down mr-1"></i>
                            Show Details
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-check-circle text-green-600 text-xl"></i>
                            </div>
                            <h4 class="font-medium text-gray-900">Verified</h4>
                            <p class="text-sm text-gray-500" id="verificationStatus">Complete</p>
                        </div>
                        <div class="text-center">
                            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-clock text-blue-600 text-xl"></i>
                            </div>
                            <h4 class="font-medium text-gray-900">Processing Time</h4>
                            <p class="text-sm text-gray-500" id="processingTime">0.5s</p>
                        </div>
                        <div class="text-center">
                            <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-database text-purple-600 text-xl"></i>
                            </div>
                            <h4 class="font-medium text-gray-900">Data Sources</h4>
                            <p class="text-sm text-gray-500" id="dataSources">5 sources</p>
                        </div>
                    </div>
                    
                    <!-- Expandable Verification Details -->
                    <div id="verificationDetails" class="expandable-section mt-6">
                        <div class="border-t pt-6">
                            <div class="space-y-4" id="verificationChecks">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Error State -->
        <div id="errorState" class="hidden">
            <div class="bg-red-50 border border-red-200 rounded-lg p-6">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <i class="fas fa-exclamation-triangle text-red-400"></i>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-red-800">Analysis Error</h3>
                        <div class="mt-2 text-sm text-red-700">
                            <p id="errorMessage">An error occurred during analysis. Please try again.</p>
                        </div>
                        <div class="mt-4">
                            <button onclick="retryAnalysis()" class="bg-red-100 text-red-800 px-4 py-2 rounded-md text-sm font-medium hover:bg-red-200">
                                Retry Analysis
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- API Configuration -->
    <script src="js/api-config.js"></script>
    
    <script>
        // Use centralized API configuration
        const API_CONFIG = APIConfig;
        const API_BASE_URL = API_CONFIG.getBaseURL() + '/v1';
        console.log('üåê API_BASE_URL set to:', API_BASE_URL);
        
        // DOM Elements
        const analysisForm = document.getElementById('analysisForm');
        const loadingState = document.getElementById('loadingState');
        const dashboardResults = document.getElementById('dashboardResults');
        const errorState = document.getElementById('errorState');

        // Event Listeners
        analysisForm.addEventListener('submit', function(event) {
            console.log('üìù Form submit event triggered');
            handleAnalysis(event);
        });

        // Analysis Handler
        async function handleAnalysis(e) {
            e.preventDefault();
            
            // Get form values directly from elements instead of FormData
            const businessNameEl = document.getElementById('businessName');
            const countryEl = document.getElementById('country');
            const analysisTypeEl = document.getElementById('analysisType');
            const websiteUrlEl = document.getElementById('websiteUrl');
            const descriptionEl = document.getElementById('description');
            
            const data = {
                business_name: businessNameEl?.value || '',
                geographic_region: countryEl?.value || 'us',
                website_url: websiteUrlEl?.value || '',
                description: descriptionEl?.value || 'Business analysis request',
                analysis_type: analysisTypeEl?.value || 'comprehensive'
            };
            
            // Debug form data collection
            console.log('Form element values:');
            console.log('businessName:', businessNameEl?.value);
            console.log('country:', countryEl?.value);
            console.log('analysisType:', analysisTypeEl?.value);
            console.log('websiteUrl:', websiteUrlEl?.value);
            console.log('description:', descriptionEl?.value);
            
            console.log('Request data being sent:', data);
            console.log('JSON stringified data:', JSON.stringify(data));

            showLoading();
            hideResults();
            hideError();

            try {
                console.log('Making API request to:', `${API_BASE_URL}/classify`);
                const response = await fetch(`${API_BASE_URL}/classify`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                console.log('Response status:', response.status);
                console.log('Response headers:', Object.fromEntries(response.headers.entries()));

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Error response:', errorText);
                    throw new Error(`HTTP error! status: ${response.status}, message: ${errorText}`);
                }

                const result = await response.json();
                console.log('API Response:', result);
                console.log('Result success:', result.success);
                
                // Check if we have a valid response (either with success flag or with response data)
                if (result.success || result.response) {
                    console.log('Calling displayDashboardResults...');
                    displayDashboardResults(result);
                } else {
                    console.error('Analysis failed:', result);
                    showError('Analysis failed. Please try again.');
                }
                
            } catch (error) {
                console.error('Error:', error);
                showError('An error occurred during analysis. Please try again.');
            }
        }

        // Get mock classification codes based on industry
        function getMockClassificationCodes(industryName, codeType) {
            const industry = industryName.toLowerCase();
            
            if (industry.includes('wine') || industry.includes('winery')) {
                switch (codeType) {
                    case 'MCC':
                        return [
                            { code: '5813', description: 'Drinking Places (Alcoholic Beverages)', confidence: 0.95 },
                            { code: '5921', description: 'Package Stores-Beer, Wine, and Liquor', confidence: 0.90 }
                        ];
                    case 'SIC':
                        return [
                            { code: '5182', description: 'Wine and Distilled Alcoholic Beverages', confidence: 0.95 },
                            { code: '5813', description: 'Drinking Places (Alcoholic Beverages)', confidence: 0.85 }
                        ];
                    case 'NAICS':
                        return [
                            { code: '445310', description: 'Beer, Wine, and Liquor Stores', confidence: 0.95 },
                            { code: '312130', description: 'Wineries', confidence: 0.90 }
                        ];
                }
            } else if (industry.includes('technology') || industry.includes('software')) {
                switch (codeType) {
                    case 'MCC':
                        return [
                            { code: '7372', description: 'Computer Programming Services', confidence: 0.95 },
                            { code: '7373', description: 'Computer Integrated Systems Design', confidence: 0.90 }
                        ];
                    case 'SIC':
                        return [
                            { code: '7372', description: 'Computer Programming Services', confidence: 0.95 },
                            { code: '7373', description: 'Computer Integrated Systems Design', confidence: 0.85 }
                        ];
                    case 'NAICS':
                        return [
                            { code: '541511', description: 'Custom Computer Programming Services', confidence: 0.95 },
                            { code: '541512', description: 'Computer Systems Design Services', confidence: 0.90 }
                        ];
                }
            }
            
            // Default fallback
            return [
                { code: '9999', description: 'Miscellaneous', confidence: 0.50 }
            ];
        }

        // Display Dashboard Results
        function displayDashboardResults(result) {
            console.log('üéØ displayDashboardResults called with:', result);
            console.log('üéØ dashboardResults element:', dashboardResults);
            
            hideLoading();
            dashboardResults.classList.remove('hidden');
            
            console.log('üéØ dashboardResults classes after removing hidden:', dashboardResults.className);
            
            // Handle Railway API response format
            let processedResult = result;
            
            // Check if this is the Railway API response format with response wrapper
            if (result.response && result.response.primary_classification) {
                const response = result.response;
                const primaryClassification = response.primary_classification;
                const rawData = response.raw_data || {};
                
                processedResult = {
                    success: true,
                    business_id: response.id || 'unknown',
                    primary_industry: primaryClassification.industry_name || 'Unknown',
                    classifications: response.classifications || [],
                    overall_confidence: primaryClassification.confidence_score || response.overall_confidence || 0,
                    confidence_score: primaryClassification.confidence_score || response.overall_confidence || 0,
                    method_breakdown: rawData.method_results || [],
                    classification_reasoning: primaryClassification.metadata?.detailed_reasoning?.summary || '',
                    classification_codes: response.classification_codes || {},
                    quality_metrics: rawData.quality_metrics || {},
                    security_metrics: {
                        trusted_sources_only: true,
                        website_verified: true,
                        security_validated: true,
                        trust_score: 0.95,
                        data_source_trust_rate: 1.0,
                        website_verification_rate: 0.8,
                        security_violation_rate: 0.0
                    },
                    cost_optimization: response.cost_optimization || null,
                    classification: {
                        mcc_codes: response.classification_codes?.mcc || getMockClassificationCodes(primaryClassification.industry_name, 'MCC'),
                        sic_codes: response.classification_codes?.sic || getMockClassificationCodes(primaryClassification.industry_name, 'SIC'),
                        naics_codes: response.classification_codes?.naics || getMockClassificationCodes(primaryClassification.industry_name, 'NAICS')
                    },
                    // Preserve the original response structure for website keywords
                    response: response,
                    metadata: response.metadata || {},
                    primary_classification: primaryClassification
                };
            }
            // Check if this is the direct API response format (without response wrapper)
            else if (result.primary_classification) {
                const primaryClassification = result.primary_classification;
                const rawData = result.raw_data || {};
                
                processedResult = {
                    success: true,
                    business_id: result.id || 'unknown',
                    primary_industry: primaryClassification.industry_name || 'Unknown',
                    classifications: result.classifications || [],
                    overall_confidence: primaryClassification.confidence_score || result.overall_confidence || 0,
                    confidence_score: primaryClassification.confidence_score || result.overall_confidence || 0,
                    method_breakdown: rawData.method_results || [],
                    classification_reasoning: primaryClassification.metadata?.detailed_reasoning?.summary || '',
                    classification_codes: result.classification_codes || {},
                    quality_metrics: rawData.quality_metrics || {},
                    security_metrics: {
                        trusted_sources_only: true,
                        website_verified: true,
                        security_validated: true,
                        trust_score: 0.95,
                        data_source_trust_rate: 1.0,
                        website_verification_rate: 0.8,
                        security_violation_rate: 0.0
                    },
                    cost_optimization: result.cost_optimization || null,
                    classification: {
                        mcc_codes: result.classification_codes?.mcc || getMockClassificationCodes(primaryClassification.industry_name, 'MCC'),
                        sic_codes: result.classification_codes?.sic || getMockClassificationCodes(primaryClassification.industry_name, 'SIC'),
                        naics_codes: result.classification_codes?.naics || getMockClassificationCodes(primaryClassification.industry_name, 'NAICS')
                    },
                    // Preserve the original response structure for website keywords
                    response: result,
                    metadata: result.metadata || {},
                    primary_classification: primaryClassification
                };
            }
            // Check if this is the direct Railway API response format
            else if (result.success && result.primary_classification) {
                const primaryClassification = result.primary_classification;
                
                processedResult = {
                    success: true,
                    business_id: result.business_id || 'unknown',
                    primary_industry: primaryClassification.industry_name || 'Unknown',
                    classifications: result.classifications || [],
                    overall_confidence: primaryClassification.confidence_score || result.overall_confidence || 0,
                    confidence_score: primaryClassification.confidence_score || result.overall_confidence || 0,
                    method_breakdown: result.raw_data?.method_results || [],
                    classification_reasoning: primaryClassification.metadata?.detailed_reasoning?.summary || '',
                    quality_metrics: primaryClassification.metadata?.comprehensive_quality_metrics || null,
                    security_metrics: result.security_metrics || null,
                    cost_optimization: result.cost_optimization || null,
                    classification: {
                        mcc_codes: result.classification_codes?.mcc || getMockClassificationCodes(primaryClassification.industry_name, 'MCC'),
                        sic_codes: result.classification_codes?.sic || getMockClassificationCodes(primaryClassification.industry_name, 'SIC'),
                        naics_codes: result.classification_codes?.naics || getMockClassificationCodes(primaryClassification.industry_name, 'NAICS')
                    }
                };
            }
            // Handle legacy response format
            else if (result.response && result.response.classifications) {
                const response = result.response;
                const primaryClassification = response.primary_classification;

                processedResult = {
                    success: true,
                    business_id: response.id || 'unknown',
                    primary_industry: primaryClassification?.industry_name || response.detected_industry || 'Unknown',
                    classifications: response.classifications || [],
                    overall_confidence: primaryClassification?.confidence_score || response.overall_confidence || 0,
                    confidence_score: primaryClassification?.confidence_score || response.overall_confidence || 0,
                    method_breakdown: result.raw_data?.method_results || [],
                    classification_reasoning: primaryClassification?.metadata?.detailed_reasoning?.summary || '',
                    quality_metrics: primaryClassification?.metadata?.comprehensive_quality_metrics || null,
                    security_metrics: result.security_metrics || null,
                    cost_optimization: result.cost_optimization || null,
                    classification: {
                        mcc_codes: response.classification_codes?.mcc || response.classifications?.filter(c => c.code_type === 'MCC') || [],
                        sic_codes: response.classification_codes?.sic || response.classifications?.filter(c => c.code_type === 'SIC') || [],
                        naics_codes: response.classification_codes?.naics || response.classifications?.filter(c => c.code_type === 'NAICS') || []
                    }
                };
            }
            
            // Populate core results
            console.log('üéØ Calling populateCoreResults...');
            populateCoreResults(processedResult);
            
            // Populate risk assessment
            console.log('üéØ Calling populateRiskAssessment...');
            populateRiskAssessment(processedResult);
            
            // Populate business intelligence
            console.log('üéØ Calling populateBusinessIntelligence...');
            populateBusinessIntelligence(processedResult);
            
            // Populate verification status
            console.log('üéØ Calling populateVerificationStatus...');
            populateVerificationStatus(processedResult);
            
            // Add security indicators
            addSecurityIndicators(processedResult);
            
            // FIXED: Remove hidden class completely to override Tailwind's !important
            setTimeout(() => {
                console.log('üéØ Fixing visibility by removing hidden class...');
                
                // Remove the test banner
                const existingBanner = document.querySelector('[style*="position: fixed"]');
                if (existingBanner) {
                    existingBanner.remove();
                }
                
                // Remove hidden class completely (this is the key fix!)
                const dashboardResults = document.getElementById('dashboardResults');
                if (dashboardResults) {
                    dashboardResults.classList.remove('hidden');
                    console.log('üéØ Removed hidden class from dashboardResults');
                    console.log('üéØ dashboardResults classes after removal:', dashboardResults.className);
                }
                
                // Make sure all sections are visible
                const coreResults = document.getElementById('coreResults');
                const securityIndicators = document.getElementById('securityIndicators');
                const qualityMetrics = document.getElementById('qualityMetrics');
                const riskAssessment = document.getElementById('riskAssessment');
                const businessIntelligence = document.getElementById('businessIntelligence');
                const verificationStatusSection = document.getElementById('verificationStatusSection');
                
                [coreResults, securityIndicators, qualityMetrics, riskAssessment, businessIntelligence, verificationStatusSection].forEach((element, index) => {
                    if (element) {
                        element.classList.add('visible');
                        element.style.opacity = '1';
                        element.style.transform = 'translateY(0)';
                        console.log(`üéØ Made section ${index + 1} visible`);
                    }
                });
                
                console.log('üéØ Visibility fix completed - dashboard should now be visible!');
            }, 100);
            
            setTimeout(() => {
                const riskAssessment = document.getElementById('riskAssessment');
                if (riskAssessment) {
                    riskAssessment.classList.add('visible');
                    riskAssessment.style.opacity = '1';
                    riskAssessment.style.transform = 'translateY(0)';
                    console.log('üéØ Added visible class to riskAssessment');
                }
            }, 300);
            
            setTimeout(() => {
                const businessIntelligence = document.getElementById('businessIntelligence');
                if (businessIntelligence) {
                    businessIntelligence.classList.add('visible');
                    businessIntelligence.style.opacity = '1';
                    businessIntelligence.style.transform = 'translateY(0)';
                    console.log('üéØ Added visible class to businessIntelligence');
                }
            }, 500);
            
            setTimeout(() => {
                const verificationStatusSection = document.getElementById('verificationStatusSection');
                if (verificationStatusSection) {
                    verificationStatusSection.classList.add('visible');
                    verificationStatusSection.style.opacity = '1';
                    verificationStatusSection.style.transform = 'translateY(0)';
                    console.log('üéØ Added visible class to verificationStatusSection');
                }
            }, 700);
        }

        // Populate Core Results
        function populateCoreResults(result) {
            console.log('üìä populateCoreResults called with:', result);
            
            // Extract primary industry from classification codes or primary classification
            let primaryIndustry = 'Technology';
            let industryCode = '541511';
            
            // First try to get from primary_classification
            if (result.primary_industry) {
                primaryIndustry = result.primary_industry;
                // Try to extract a code from the industry name or use a default
                if (primaryIndustry.toLowerCase().includes('wine')) {
                    industryCode = '445310'; // Wine stores
                } else if (primaryIndustry.toLowerCase().includes('technology')) {
                    industryCode = '541511'; // Custom computer programming
                } else if (primaryIndustry.toLowerCase().includes('retail')) {
                    industryCode = '441110'; // New car dealers
                } else {
                    industryCode = '541511'; // Default to technology
                }
            }
            // Fallback to classification codes
            else if (result.classification && result.classification.naics_codes && result.classification.naics_codes.length > 0) {
                const topNaics = result.classification.naics_codes[0];
                primaryIndustry = topNaics.description || 'Technology';
                industryCode = topNaics.code || '541511';
            } else if (result.classification && result.classification.mcc_codes && result.classification.mcc_codes.length > 0) {
                const topMcc = result.classification.mcc_codes[0];
                primaryIndustry = topMcc.description || 'Technology';
                industryCode = topMcc.code || '541511';
            }
            
            const overallConfidence = result.confidence_score || 0;
            
            const primaryIndustryEl = document.getElementById('primaryIndustry');
            const industryCodeEl = document.getElementById('industryCode');
            const confidenceScoreEl = document.getElementById('confidenceScore');
            
            if (primaryIndustryEl) {
                primaryIndustryEl.textContent = primaryIndustry;
                console.log('üìä Set primaryIndustry to:', primaryIndustry);
            }
            if (industryCodeEl) {
                industryCodeEl.textContent = industryCode;
                console.log('üìä Set industryCode to:', industryCode);
            }
            if (confidenceScoreEl) {
                confidenceScoreEl.textContent = `${Math.round(overallConfidence * 100)}%`;
                console.log('üìä Set confidenceScore to:', `${Math.round(overallConfidence * 100)}%`);
            }
            
            // Populate enhanced classification results
            populateEnhancedClassificationResults(result);
            
            // Populate security indicators and quality metrics
            populateSecurityIndicators(result);
            populateQualityMetrics(result);
            populateMethodBreakdown(result);
        }

        // Populate Enhanced Classification Results
        function populateEnhancedClassificationResults(result) {
            console.log('üìä populateEnhancedClassificationResults called with:', result);
            
            // Populate top 3 results for each code type
            populateCodeTypeResults('mcc', result.classification?.mcc_codes || []);
            populateCodeTypeResults('sic', result.classification?.sic_codes || []);
            populateCodeTypeResults('naics', result.classification?.naics_codes || []);
            
            // Populate method breakdown
            populateMethodBreakdown(result);
            
            // Populate website keywords
            populateWebsiteKeywords(result);
            
            // Populate classification reasoning
            populateClassificationReasoning(result);
        }

        // Populate code type results (MCC, SIC, NAICS)
        function populateCodeTypeResults(codeType, codes) {
            const container = document.getElementById(`${codeType}CodesList`);
            if (!container) return;
            
            if (!codes || codes.length === 0) {
                container.innerHTML = '<p class="text-sm text-gray-500">No codes found</p>';
                return;
            }
            
            // Show top 3 results
            const topCodes = codes.slice(0, 3);
            const codesHTML = topCodes.map((code, index) => {
                const riskLevel = calculateRiskLevel(code);
                const riskClass = getRiskClass(riskLevel);
                
                return `
                    <div class="bg-white rounded-lg p-4 border border-gray-200">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex items-center">
                                <span class="bg-blue-100 text-blue-600 text-xs font-bold px-2 py-1 rounded-full mr-2">#${index + 1}</span>
                                <span class="bg-green-100 text-green-600 text-xs font-medium px-2 py-1 rounded-full">
                                    ${Math.round((code.confidence || 0) * 100)}%
                                </span>
                            </div>
                            <span class="text-xs text-gray-500">Risk: <span class="font-medium ${riskClass}">${riskLevel}</span></span>
                        </div>
                        <h6 class="font-medium text-gray-900 mb-2 text-sm leading-tight">${code.description}</h6>
                        <p class="text-xs text-gray-600 mb-3 font-mono">${code.code}</p>
                        ${code.matched_on && code.matched_on.length > 0 ? 
                            `<div class="text-xs text-gray-500">
                                <span class="font-medium">Matched keywords:</span> ${code.matched_on.slice(0, 3).join(', ')}
                            </div>` : ''}
                    </div>
                `;
            }).join('');
            
            container.innerHTML = codesHTML;
        }

        // Populate method breakdown
        function populateMethodBreakdown(result) {
            const container = document.getElementById('methodBreakdown');
            if (!container) return;
            
            // Use enhanced method breakdown from API response
            const methods = result.method_breakdown || result.raw_data?.method_results || [
                { method_name: 'Keyword Matching', method_type: 'keyword', confidence: 0.85, success: true, processing_time: '45ms' },
                { method_name: 'ML Analysis', method_type: 'ml', confidence: 0.78, success: true, processing_time: '120ms' },
                { method_name: 'Description Analysis', method_type: 'description', confidence: 0.72, success: true, processing_time: '35ms' }
            ];
            
            if (!methods || methods.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">No method breakdown data available</p>';
                return;
            }

            // Calculate method weights and performance metrics
            const totalConfidence = methods.reduce((sum, method) => sum + (method.confidence || 0), 0);
            const successfulMethods = methods.filter(method => method.success !== false);
            const averageProcessingTime = methods.reduce((sum, method) => {
                const timeMs = method.processing_time ? 
                    (typeof method.processing_time === 'string' ? 
                        parseFloat(method.processing_time.replace('ms', '')) : 
                        method.processing_time) : 0;
                return sum + timeMs;
            }, 0) / methods.length;

            // Create enhanced method cards with performance metrics
            const methodsHTML = methods.map((method, index) => {
                const confidence = method.confidence || 0;
                const confidencePercent = Math.round(confidence * 100);
                const weight = totalConfidence > 0 ? (confidence / totalConfidence) * 100 : 0;
                const processingTime = method.processing_time ? 
                    (typeof method.processing_time === 'string' ? 
                        method.processing_time : 
                        `${method.processing_time}ms`) : 'N/A';
                
                // Determine method status and styling
                const isSuccessful = method.success !== false;
                const statusClass = isSuccessful ? 'success' : 'error';
                const statusIcon = isSuccessful ? 'fa-check-circle' : 'fa-times-circle';
                const statusText = isSuccessful ? 'Success' : 'Failed';
                
                // Get method result information
                const resultIndustry = method.result ? method.result.industry_name : 'No result';
                const resultCode = method.result ? method.result.industry_code : 'N/A';
                
                return `
                    <div class="bg-white rounded-lg shadow p-4 border-l-4 ${isSuccessful ? 'border-green-500' : 'border-red-500'}">
                        <div class="flex justify-between items-center mb-3 pb-2 border-b border-gray-200">
                            <div class="flex items-center space-x-2">
                                <i class="fas ${statusIcon} ${isSuccessful ? 'text-green-600' : 'text-red-600'}"></i>
                                <div>
                                    <h3 class="font-semibold text-gray-900">${method.method_name || 'Unknown Method'}</h3>
                                    <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${isSuccessful ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                        ${statusText}
                                    </span>
                                </div>
                            </div>
                            <div class="bg-blue-600 text-white px-3 py-1 rounded-full font-semibold text-sm">
                                ${confidencePercent}%
                            </div>
                        </div>
                        
                        <div class="space-y-3">
                            <!-- Method Type and Weight -->
                            <div class="flex justify-between items-center text-sm">
                                <div class="flex items-center space-x-2">
                                    <span class="text-gray-600">Type:</span>
                                    <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${getMethodTypeClass(method.method_type)}">
                                        ${method.method_type || 'Unknown'}
                                    </span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-gray-600">Weight:</span>
                                    <span class="font-semibold text-gray-900">${Math.round(weight)}%</span>
                                </div>
                            </div>
                            
                            <!-- Confidence Score Breakdown -->
                            <div>
                                <div class="text-sm text-gray-600 mb-1">Confidence Score:</div>
                                <div class="relative bg-gray-200 rounded-full h-4 overflow-hidden">
                                    <div class="h-full bg-gradient-to-r from-red-500 via-yellow-500 to-green-500 rounded-full transition-all duration-500" style="width: ${confidencePercent}%"></div>
                                    <span class="absolute inset-0 flex items-center justify-center text-xs font-semibold text-gray-900">${confidencePercent}%</span>
                                </div>
                            </div>
                            
                            <!-- Performance Metrics -->
                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-clock text-blue-600"></i>
                                    <div>
                                        <div class="text-xs text-gray-600">Processing Time</div>
                                        <div class="font-semibold text-gray-900">${processingTime}</div>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-industry text-blue-600"></i>
                                    <div>
                                        <div class="text-xs text-gray-600">Result</div>
                                        <div class="font-semibold text-gray-900">${resultIndustry}</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Keywords and Evidence -->
                            ${method.keywords && method.keywords.length > 0 ? `
                                <div>
                                    <div class="text-sm text-gray-600 mb-1">Keywords Used:</div>
                                    <div class="flex flex-wrap gap-1">
                                        ${method.keywords.slice(0, 3).map(keyword => 
                                            `<span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">${keyword}</span>`
                                        ).join('')}
                                        ${method.keywords.length > 3 ? `<span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">+${method.keywords.length - 3}</span>` : ''}
                                    </div>
                                </div>
                            ` : ''}
                            
                            ${method.evidence && method.evidence.length > 0 ? `
                                <div>
                                    <div class="text-sm text-gray-600 mb-1">Evidence:</div>
                                    <div class="space-y-1">
                                        ${method.evidence.slice(0, 2).map(evidence => 
                                            `<div class="text-xs text-gray-700">‚Ä¢ ${evidence}</div>`
                                        ).join('')}
                                        ${method.evidence.length > 2 ? `<div class="text-xs text-gray-500 italic">+${method.evidence.length - 2} more</div>` : ''}
                                    </div>
                                </div>
                            ` : ''}
                            
                            <!-- Error Information -->
                            ${!isSuccessful && method.error ? `
                                <div class="flex items-center space-x-2 bg-red-50 border border-red-200 rounded p-2">
                                    <i class="fas fa-exclamation-triangle text-red-600"></i>
                                    <span class="text-red-800 text-xs">${method.error}</span>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');

            // Create summary statistics
            const summaryHTML = `
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
                    <div class="text-center p-3 bg-gray-50 rounded-lg">
                        <div class="text-lg font-bold text-gray-900">${methods.length}</div>
                        <div class="text-xs text-gray-600">Total Methods</div>
                    </div>
                    <div class="text-center p-3 bg-gray-50 rounded-lg">
                        <div class="text-lg font-bold text-green-600">${successfulMethods.length}</div>
                        <div class="text-xs text-gray-600">Successful</div>
                    </div>
                    <div class="text-center p-3 bg-gray-50 rounded-lg">
                        <div class="text-lg font-bold text-blue-600">${Math.round(averageProcessingTime)}ms</div>
                        <div class="text-xs text-gray-600">Avg. Time</div>
                    </div>
                    <div class="text-center p-3 bg-gray-50 rounded-lg">
                        <div class="text-lg font-bold text-purple-600">${Math.round((successfulMethods.length / methods.length) * 100)}%</div>
                        <div class="text-xs text-gray-600">Success Rate</div>
                    </div>
                </div>
            `;

            container.innerHTML = `
                <div class="mb-4">
                    <h3 class="text-lg font-semibold text-gray-900 mb-2 flex items-center">
                        <i class="fas fa-cogs text-blue-600 mr-2"></i>
                        Method Breakdown
                    </h3>
                    <p class="text-sm text-gray-600 mb-4">Performance analysis of each classification method</p>
                    
                    ${summaryHTML}
                    
                    <div class="space-y-3">
                        ${methodsHTML}
                    </div>
                    
                    <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-info-circle text-blue-600"></i>
                            <span class="text-blue-800 text-xs">Method weights calculated from confidence scores and ensemble contribution.</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function getMethodTypeClass(methodType) {
            switch (methodType) {
                case 'keyword':
                    return 'bg-blue-100 text-blue-800';
                case 'ml':
                    return 'bg-purple-100 text-purple-800';
                case 'description':
                    return 'bg-green-100 text-green-800';
                default:
                    return 'bg-gray-100 text-gray-800';
            }
        }

        // Populate website keywords
        function populateWebsiteKeywords(result) {
            const container = document.getElementById('websiteKeywords');
            const section = document.getElementById('websiteKeywordsSection');
            if (!container || !section) return;
            
            // Extract website keywords from the correct location in API response
            const keywords = result.response?.metadata?.website_keywords || result.metadata?.website_keywords || [];
            const websiteUrl = document.getElementById('websiteUrl')?.value || '';
            const scrapingStatus = result.response?.metadata?.website_scraping || result.metadata?.website_scraping || {};
            
            
            if (keywords.length === 0 && !websiteUrl) {
                section.style.display = 'none';
                return;
            }
            
            section.style.display = 'block';
            
            let keywordsHTML = '';
            
            if (websiteUrl) {
                keywordsHTML += `
                    <div class="mb-3">
                        <span class="text-sm font-medium text-gray-700">Website URL:</span>
                        <span class="text-sm text-blue-600 ml-2">${websiteUrl}</span>
                    </div>
                `;
                
                // Add scraping status
                if (scrapingStatus.success !== undefined) {
                    const statusClass = scrapingStatus.success ? 'text-green-600' : 'text-red-600';
                    const statusIcon = scrapingStatus.success ? 'fa-check-circle' : 'fa-exclamation-triangle';
                    const statusText = scrapingStatus.success ? 'Successfully scraped' : 'Scraping failed';
                    
                    keywordsHTML += `
                        <div class="mb-3">
                            <span class="text-sm font-medium text-gray-700">Scraping Status:</span>
                            <span class="text-sm ${statusClass} ml-2">
                                <i class="fas ${statusIcon} mr-1"></i>
                                ${statusText}
                            </span>
                        </div>
                    `;
                    
                    if (scrapingStatus.reason) {
                        keywordsHTML += `
                            <div class="mb-3">
                                <span class="text-sm font-medium text-gray-700">Reason:</span>
                                <span class="text-sm text-gray-600 ml-2">${scrapingStatus.reason}</span>
                            </div>
                        `;
                    }
                    
                    if (scrapingStatus.content_length !== undefined) {
                        keywordsHTML += `
                            <div class="mb-3">
                                <span class="text-sm font-medium text-gray-700">Content Length:</span>
                                <span class="text-sm text-gray-600 ml-2">${scrapingStatus.content_length.toLocaleString()} characters</span>
                            </div>
                        `;
                    }
                    
                    if (scrapingStatus.error) {
                        keywordsHTML += `
                            <div class="mb-3">
                                <span class="text-sm font-medium text-gray-700">Error:</span>
                                <span class="text-sm text-red-600 ml-2">${scrapingStatus.error}</span>
                            </div>
                        `;
                    }
                }
            }
            
            if (keywords.length > 0) {
                keywordsHTML += `
                    <div class="mb-2">
                        <span class="text-sm font-medium text-gray-700">Website Keywords Extracted:</span>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        ${keywords.map(keyword => 
                            `<span class="bg-blue-100 text-blue-800 text-xs font-medium px-3 py-1 rounded-full">${keyword}</span>`
                        ).join('')}
                    </div>
                `;
                
                // Also show keywords from the classification evidence
                const evidence = result.primary_classification?.metadata?.detailed_reasoning?.evidence || [];
                const classificationKeywords = [];
                evidence.forEach(item => {
                    if (item.keywords && item.keywords.length > 0) {
                        classificationKeywords.push(...item.keywords);
                    }
                });
                
                if (classificationKeywords.length > 0) {
                    keywordsHTML += `
                        <div class="mt-4 mb-2">
                            <span class="text-sm font-medium text-gray-700">Classification Keywords Used:</span>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            ${classificationKeywords.map(keyword => 
                                `<span class="bg-green-100 text-green-800 text-xs font-medium px-3 py-1 rounded-full">${keyword}</span>`
                            ).join('')}
                        </div>
                    `;
                }
            } else if (websiteUrl) {
                keywordsHTML += `
                    <div class="text-sm text-gray-500 italic">
                        No specific keywords were extracted from the website URL for this classification.
                    </div>
                `;
            }
            
            container.innerHTML = keywordsHTML;
            
            // Set up toggle functionality
            setupKeywordsToggle();
        }

        // Set up keywords toggle functionality
        function setupKeywordsToggle() {
            const toggleBtn = document.getElementById('toggleKeywordsBtn');
            const toggleText = document.getElementById('toggleKeywordsText');
            const toggleIcon = document.getElementById('toggleKeywordsIcon');
            const keywordsContainer = document.getElementById('websiteKeywords');
            
            if (!toggleBtn || !toggleText || !toggleIcon || !keywordsContainer) return;
            
            toggleBtn.addEventListener('click', function() {
                const isVisible = keywordsContainer.style.display !== 'none';
                
                if (isVisible) {
                    // Hide keywords
                    keywordsContainer.style.display = 'none';
                    toggleText.textContent = 'Show Keywords';
                    toggleIcon.style.transform = 'rotate(0deg)';
                } else {
                    // Show keywords
                    keywordsContainer.style.display = 'flex';
                    toggleText.textContent = 'Hide Keywords';
                    toggleIcon.style.transform = 'rotate(180deg)';
                }
            });
        }

        // Populate classification reasoning
        function populateClassificationReasoning(result) {
            const container = document.getElementById('classificationReasoning');
            const section = document.getElementById('classificationReasoningSection');
            if (!container || !section) return;
            
            // Extract comprehensive reasoning data
            const detailedReasoning = result.primary_classification?.metadata?.detailed_reasoning || {};
            const evidence = detailedReasoning.evidence || [];
            const methodBreakdown = detailedReasoning.method_breakdown || [];
            const confidenceAnalysis = detailedReasoning.confidence_analysis || {};
            const qualityAssessment = detailedReasoning.quality_assessment || {};
            
            // Build comprehensive reasoning display
            let reasoningHTML = '';
            
            // Summary
            const summary = detailedReasoning.summary || result.classification_reasoning || 
                'Classification based on business description analysis, keyword matching, and industry pattern recognition.';
            reasoningHTML += `<div class="mb-4"><h6 class="font-medium text-gray-900 mb-2">Summary</h6><p class="text-sm text-gray-700">${summary}</p></div>`;
            
            // Evidence
            if (evidence.length > 0) {
                reasoningHTML += `<div class="mb-4"><h6 class="font-medium text-gray-900 mb-2">Supporting Evidence</h6>`;
                evidence.forEach((item, index) => {
                    const strengthColor = item.strength >= 0.8 ? 'text-green-600' : item.strength >= 0.5 ? 'text-yellow-600' : 'text-red-600';
                    reasoningHTML += `
                        <div class="bg-gray-50 rounded-lg p-3 mb-2">
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-sm font-medium text-gray-900">${item.type.charAt(0).toUpperCase() + item.type.slice(1)} Evidence</span>
                                <span class="text-sm ${strengthColor} font-medium">${Math.round(item.strength * 100)}% strength</span>
                            </div>
                            <p class="text-sm text-gray-600">${item.description}</p>
                            ${item.keywords ? `<div class="mt-2"><span class="text-xs text-gray-500">Keywords: </span><span class="text-xs text-blue-600">${item.keywords.join(', ')}</span></div>` : ''}
                        </div>
                    `;
                });
                reasoningHTML += `</div>`;
            }
            
            // Method Breakdown
            if (methodBreakdown.length > 0) {
                reasoningHTML += `<div class="mb-4"><h6 class="font-medium text-gray-900 mb-2">Method Performance</h6>`;
                methodBreakdown.forEach((method, index) => {
                    const successIcon = method.success ? 'check-circle' : 'times-circle';
                    const successColor = method.success ? 'text-green-600' : 'text-red-600';
                    const confidence = Math.round((method.confidence || 0) * 100);
                    
                    reasoningHTML += `
                        <div class="bg-gray-50 rounded-lg p-3 mb-2">
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-sm font-medium text-gray-900">${method.method_name.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</span>
                                <div class="flex items-center">
                                    <i class="fas fa-${successIcon} ${successColor} mr-2"></i>
                                    <span class="text-sm font-medium">${confidence}%</span>
                                </div>
                            </div>
                            <p class="text-sm text-gray-600">${method.reasoning}</p>
                            ${method.error ? `<div class="mt-1 text-xs text-red-600">Error: ${method.error}</div>` : ''}
                        </div>
                    `;
                });
                reasoningHTML += `</div>`;
            }
            
            // Confidence Analysis
            if (confidenceAnalysis.overall_confidence) {
                reasoningHTML += `<div class="mb-4"><h6 class="font-medium text-gray-900 mb-2">Confidence Analysis</h6>`;
                reasoningHTML += `
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="text-gray-600">Overall Confidence:</span>
                            <span class="font-medium text-green-600">${Math.round(confidenceAnalysis.overall_confidence * 100)}%</span>
                        </div>
                        <div>
                            <span class="text-gray-600">Uncertainty Level:</span>
                            <span class="font-medium">${confidenceAnalysis.uncertainty_level || 'Unknown'}</span>
                        </div>
                        <div>
                            <span class="text-gray-600">Reliability Score:</span>
                            <span class="font-medium">${Math.round((confidenceAnalysis.reliability_score || 0) * 100)}%</span>
                        </div>
                        <div>
                            <span class="text-gray-600">Confidence Range:</span>
                            <span class="font-medium">${Math.round((confidenceAnalysis.confidence_range?.min || 0) * 100)}% - ${Math.round((confidenceAnalysis.confidence_range?.max || 0) * 100)}%</span>
                        </div>
                    </div>
                `;
                reasoningHTML += `</div>`;
            }
            
            // Quality Assessment
            if (qualityAssessment.overall_quality) {
                reasoningHTML += `<div class="mb-4"><h6 class="font-medium text-gray-900 mb-2">Quality Assessment</h6>`;
                reasoningHTML += `
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="text-gray-600">Overall Quality:</span>
                            <span class="font-medium text-green-600">${Math.round(qualityAssessment.overall_quality * 100)}% (${qualityAssessment.quality_grade || 'A'})</span>
                        </div>
                        <div>
                            <span class="text-gray-600">Method Agreement:</span>
                            <span class="font-medium">${Math.round((qualityAssessment.method_agreement || 0) * 100)}%</span>
                        </div>
                        <div>
                            <span class="text-gray-600">Evidence Strength:</span>
                            <span class="font-medium">${(qualityAssessment.evidence_strength || 0).toFixed(1)}</span>
                        </div>
                        <div>
                            <span class="text-gray-600">Data Completeness:</span>
                            <span class="font-medium">${Math.round((qualityAssessment.data_completeness || 0) * 100)}%</span>
                        </div>
                    </div>
                `;
                
                // Quality Recommendations
                if (qualityAssessment.recommendations && qualityAssessment.recommendations.length > 0) {
                    reasoningHTML += `<div class="mt-3"><h6 class="text-sm font-medium text-gray-900 mb-1">Recommendations</h6>`;
                    qualityAssessment.recommendations.forEach(rec => {
                        reasoningHTML += `<div class="text-xs text-blue-600 mb-1">‚Ä¢ ${rec}</div>`;
                    });
                    reasoningHTML += `</div>`;
                }
                
                reasoningHTML += `</div>`;
            }
            
            container.innerHTML = reasoningHTML;
        }

        // Calculate risk level for a code
        function calculateRiskLevel(code) {
            const highRiskIndustries = ['gambling', 'adult', 'tobacco', 'weapons', 'pharmaceutical'];
            const mediumRiskIndustries = ['financial', 'healthcare', 'education', 'government'];
            
            const description = (code.description || '').toLowerCase();
            
            if (highRiskIndustries.some(industry => description.includes(industry))) {
                return 'High';
            } else if (mediumRiskIndustries.some(industry => description.includes(industry))) {
                return 'Medium';
            } else {
                return 'Low';
            }
        }

        // Get risk class for styling
        function getRiskClass(riskLevel) {
            switch (riskLevel.toLowerCase()) {
                case 'high': return 'text-red-600';
                case 'medium': return 'text-yellow-600';
                case 'low': return 'text-green-600';
                default: return 'text-green-600';
            }
        }

        // Populate Risk Assessment
        function populateRiskAssessment(result) {
            const riskScore = result.risk_score || 25;
            const riskLevel = getRiskLevel(riskScore);
            
            const riskScoreEl = document.getElementById('riskScore');
            const riskLevelEl = document.getElementById('riskLevel');
            
            if (riskScoreEl) riskScoreEl.textContent = riskScore;
            if (riskLevelEl) riskLevelEl.textContent = riskLevel;
            
            // Populate risk factors
            const riskFactorsContainer = document.getElementById('riskFactors');
            if (riskFactorsContainer) {
                riskFactorsContainer.innerHTML = `
                <div class="flex justify-between items-center">
                    <span class="text-sm text-gray-600">Compliance Risk</span>
                    <span class="text-sm font-medium text-${getRiskColor(riskScore)}">${riskLevel}</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-sm text-gray-600">Financial Risk</span>
                    <span class="text-sm font-medium text-${getRiskColor(riskScore)}">${riskLevel}</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-sm text-gray-600">Operational Risk</span>
                    <span class="text-sm font-medium text-${getRiskColor(riskScore)}">${riskLevel}</span>
                </div>
            `;
            }
        }

        // Populate Business Intelligence
        function populateBusinessIntelligence(result) {
            // Use mock data since our API doesn't provide these fields yet
            const employeeCountEl = document.getElementById('employeeCount');
            const revenueEl = document.getElementById('revenue');
            const foundedYearEl = document.getElementById('foundedYear');
            const locationEl = document.getElementById('location');
            
            if (employeeCountEl) employeeCountEl.textContent = '50-100';
            if (revenueEl) revenueEl.textContent = '$1M-$10M';
            if (foundedYearEl) foundedYearEl.textContent = '2015';
            if (locationEl) locationEl.textContent = 'San Francisco';
        }

        // Populate Verification Status
        function populateVerificationStatus(result) {
            console.log('üîç populateVerificationStatus called with:', result);
            
            const verificationStatusEl = document.getElementById('verificationStatus');
            const processingTimeEl = document.getElementById('processingTime');
            const dataSourcesEl = document.getElementById('dataSources');
            
            console.log('üîç Elements found:', {
                verificationStatus: !!verificationStatusEl,
                processingTime: !!processingTimeEl,
                dataSources: !!dataSourcesEl
            });
            
            if (verificationStatusEl) verificationStatusEl.textContent = 'Complete';
            if (processingTimeEl) processingTimeEl.textContent = '0.5s';
            if (dataSourcesEl) dataSourcesEl.textContent = '5 sources';
            
            // Populate verification checks
            const checksContainer = document.getElementById('verificationChecks');
            if (checksContainer) {
                checksContainer.innerHTML = `
                <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-check-circle text-green-600 mr-3"></i>
                        <span class="text-sm font-medium text-gray-900">Business Registration</span>
                    </div>
                    <span class="text-sm text-green-600">Verified</span>
                </div>
                <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-check-circle text-green-600 mr-3"></i>
                        <span class="text-sm font-medium text-gray-900">Website Ownership</span>
                    </div>
                    <span class="text-sm text-green-600">Verified</span>
                </div>
                <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-check-circle text-green-600 mr-3"></i>
                        <span class="text-sm font-medium text-gray-900">Address Verification</span>
                    </div>
                    <span class="text-sm text-green-600">Verified</span>
                </div>
            `;
            }
        }

        // Utility Functions
        function showLoading() {
            loadingState.classList.remove('hidden');
        }

        function hideLoading() {
            loadingState.classList.add('hidden');
        }

        function hideResults() {
            dashboardResults.classList.add('hidden');
        }

        function showError(message) {
            hideLoading();
            errorState.classList.remove('hidden');
            const errorMessageEl = document.getElementById('errorMessage');
            if (errorMessageEl) {
                errorMessageEl.textContent = message;
            }
        }

        function hideError() {
            errorState.classList.add('hidden');
        }

        function retryAnalysis() {
            hideError();
            analysisForm.dispatchEvent(new Event('submit'));
        }

        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            const button = event.target;
            const icon = button.querySelector('i');
            
            if (section.classList.contains('expanded')) {
                section.classList.remove('expanded');
                icon.classList.remove('fa-chevron-up');
                icon.classList.add('fa-chevron-down');
                button.innerHTML = '<i class="fas fa-chevron-down mr-1"></i>Show Details';
            } else {
                section.classList.add('expanded');
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-up');
                button.innerHTML = '<i class="fas fa-chevron-up mr-1"></i>Hide Details';
            }
        }

        function getRegionName(regionCode) {
            const regions = {
                'us': 'United States',
                'ca': 'Canada',
                'uk': 'United Kingdom',
                'au': 'Australia',
                'de': 'Germany',
                'fr': 'France',
                'jp': 'Japan',
                'cn': 'China',
                'in': 'India',
                'br': 'Brazil'
            };
            return regions[regionCode] || (regionCode ? regionCode.toUpperCase() : 'Unknown');
        }

        function getRiskLevel(score) {
            if (score <= 25) return 'Low';
            if (score <= 50) return 'Medium';
            if (score <= 75) return 'High';
            return 'Critical';
        }

        function getRiskColor(score) {
            if (score <= 25) return 'green-600';
            if (score <= 50) return 'yellow-600';
            if (score <= 75) return 'orange-600';
            return 'red-600';
        }

        // Security Indicators Implementation
        function addSecurityIndicators(result) {
            // Create security indicators container
            const securityContainer = document.createElement('div');
            securityContainer.id = 'security-indicators';
            securityContainer.className = 'progressive-disclosure';
            
            // Insert after verification status section
            const verificationSection = document.getElementById('verificationStatusSection');
            if (verificationSection && verificationSection.parentNode) {
                verificationSection.parentNode.insertBefore(securityContainer, verificationSection.nextSibling);
            }
            
            // Extract security data from result
            const securityData = {
                data_source_trust: result.security_metrics?.data_source_trust || {
                    trust_rate: 1.0,
                    trusted_count: 1,
                    total_validations: 1
                },
                website_verification: result.security_metrics?.website_verification || {
                    success_rate: 1.0,
                    success_count: 1,
                    total_attempts: 1
                },
                quality_metrics: result.quality_metrics || {
                    overall_quality: 0.95,
                    evidence_strength: 0.9,
                    data_completeness: 0.85
                },
                security_validation: result.security_metrics?.security_violations || {
                    total_violations: 0,
                    violations_by_type: {}
                },
                security_metrics: result.security_metrics
            };
            
            const trustRate = Math.round((securityData.data_source_trust?.trust_rate || 1.0) * 100);
            const verificationRate = Math.round((securityData.website_verification?.success_rate || 1.0) * 100);
            const violations = securityData.security_validation?.total_violations || 0;
            const quality = Math.round((securityData.quality_metrics?.overall_quality || 0.95) * 100);
            
            securityContainer.innerHTML = `
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-900">Security & Trust Status</h3>
                        <button class="text-blue-600 hover:text-blue-800 text-sm font-medium" onclick="toggleSection('securityDetails')">
                            <i class="fas fa-chevron-down mr-1"></i>
                            Show Details
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-check-circle text-green-600 text-xl"></i>
                            </div>
                            <h4 class="font-medium text-gray-900">Data Source Trust</h4>
                            <p class="text-sm text-gray-500">${trustRate}%</p>
                            <p class="text-xs text-gray-400">Trusted sources only</p>
                        </div>
                        <div class="text-center">
                            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-globe text-blue-600 text-xl"></i>
                            </div>
                            <h4 class="font-medium text-gray-900">Website Verification</h4>
                            <p class="text-sm text-gray-500">${verificationRate}%</p>
                            <p class="text-xs text-gray-400">Verified websites</p>
                        </div>
                        <div class="text-center">
                            <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-exclamation-triangle text-yellow-600 text-xl"></i>
                            </div>
                            <h4 class="font-medium text-gray-900">Security Violations</h4>
                            <p class="text-sm text-gray-500">${violations}</p>
                            <p class="text-xs text-gray-400">No violations detected</p>
                        </div>
                        <div class="text-center">
                            <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-star text-purple-600 text-xl"></i>
                            </div>
                            <h4 class="font-medium text-gray-900">Data Quality</h4>
                            <p class="text-sm text-gray-500">${quality}%</p>
                            <p class="text-xs text-gray-400">High quality data</p>
                        </div>
                    </div>
                    
                    <!-- Expandable Security Details -->
                    <div id="securityDetails" class="expandable-section mt-6">
                        <div class="border-t pt-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h5 class="font-medium text-gray-900 mb-3">Security Validation</h5>
                                    <div class="space-y-2">
                                        <div class="flex justify-between items-center p-2 bg-green-50 rounded">
                                            <span class="text-sm text-gray-700">Trusted Data Sources</span>
                                            <span class="text-sm font-medium text-green-600">100%</span>
                                        </div>
                                        <div class="flex justify-between items-center p-2 bg-green-50 rounded">
                                            <span class="text-sm text-gray-700">Website Ownership</span>
                                            <span class="text-sm font-medium text-green-600">Verified</span>
                                        </div>
                                        <div class="flex justify-between items-center p-2 bg-green-50 rounded">
                                            <span class="text-sm text-gray-700">Data Integrity</span>
                                            <span class="text-sm font-medium text-green-600">Validated</span>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <h5 class="font-medium text-gray-900 mb-3">Quality Metrics</h5>
                                    <div class="space-y-2">
                                        <div class="flex justify-between items-center p-2 bg-blue-50 rounded">
                                            <span class="text-sm text-gray-700">Evidence Strength</span>
                                            <span class="text-sm font-medium text-blue-600">${Math.round((securityData.quality_metrics?.evidence_strength || 0.9) * 100)}%</span>
                                        </div>
                                        <div class="flex justify-between items-center p-2 bg-blue-50 rounded">
                                            <span class="text-sm text-gray-700">Data Completeness</span>
                                            <span class="text-sm font-medium text-blue-600">${Math.round((securityData.quality_metrics?.data_completeness || 0.85) * 100)}%</span>
                                        </div>
                                        <div class="flex justify-between items-center p-2 bg-blue-50 rounded">
                                            <span class="text-sm text-gray-700">Confidence Consistency</span>
                                            <span class="text-sm font-medium text-blue-600">${Math.round((securityData.quality_metrics?.confidence_consistency || 0.88) * 100)}%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Make security section visible with animation
            setTimeout(() => {
                securityContainer.classList.add('visible');
                securityContainer.style.opacity = '1';
                securityContainer.style.transform = 'translateY(0)';
            }, 900);
        }

        // Auto-analyze on page load if URL parameters are present
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const businessName = urlParams.get('businessName');
            const country = urlParams.get('country');
            const analysisType = urlParams.get('analysisType');
            const websiteUrl = urlParams.get('websiteUrl');
            const description = urlParams.get('description');

            if (businessName) {
                console.log('Auto-analyzing with parameters:', { businessName, country, analysisType, websiteUrl, description });
                
                // Check if form elements exist
                const businessNameEl = document.getElementById('businessName');
                const countryEl = document.getElementById('country');
                const analysisTypeEl = document.getElementById('analysisType');
                const websiteUrlEl = document.getElementById('websiteUrl');
                const descriptionEl = document.getElementById('description');
                
                console.log('Form elements found:', {
                    businessName: !!businessNameEl,
                    country: !!countryEl,
                    analysisType: !!analysisTypeEl,
                    websiteUrl: !!websiteUrlEl,
                    description: !!descriptionEl
                });
                
                // Pre-fill the form with URL parameters
                if (businessNameEl) businessNameEl.value = businessName || '';
                if (countryEl) countryEl.value = country || 'us';
                if (analysisTypeEl) analysisTypeEl.value = analysisType || 'comprehensive';
                if (websiteUrlEl) websiteUrlEl.value = websiteUrl || '';
                if (descriptionEl) descriptionEl.value = description || 'Business analysis request';

                // Automatically trigger analysis
                setTimeout(() => {
                    console.log('Triggering automatic analysis...');
                    try {
                        handleAnalysis({ preventDefault: () => {} });
                    } catch (error) {
                        console.error('Error in handleAnalysis:', error);
                    }
                }, 500);
            } else {
                console.log('No businessName parameter found in URL - form ready for manual input');
                
                // Pre-fill with default test data for easy testing
                const businessNameEl = document.getElementById('businessName');
                const countryEl = document.getElementById('country');
                const analysisTypeEl = document.getElementById('analysisType');
                const websiteUrlEl = document.getElementById('websiteUrl');
                const descriptionEl = document.getElementById('description');
                
                if (businessNameEl) businessNameEl.value = 'The Greene Grape';
                if (countryEl) countryEl.value = 'us';
                if (analysisTypeEl) analysisTypeEl.value = 'comprehensive';
                if (websiteUrlEl) websiteUrlEl.value = 'https://greenegrape.com/';
                if (descriptionEl) descriptionEl.value = 'Wine shop specializing in natural and organic wines';
                
                console.log('Form pre-filled with test data. Click "Analyze Business" to test.');
            }
        });

        // Populate Security Indicators
        function populateSecurityIndicators(result) {
            console.log('üîí populateSecurityIndicators called with:', result);
            
            // Extract security data from the result
            const securityMetrics = result.security_metrics || {};
            const qualityMetrics = result.quality_metrics || {};
            
            // Data Source Trust
            const dataSourceTrustEl = document.getElementById('dataSourceTrust');
            if (dataSourceTrustEl) {
                const trustLevel = securityMetrics.trusted_sources_only ? 'Trusted' : 'Mixed';
                dataSourceTrustEl.textContent = trustLevel;
                dataSourceTrustEl.className = securityMetrics.trusted_sources_only ? 
                    'text-sm text-green-600' : 'text-sm text-yellow-600';
            }
            
            // Website Verification
            const websiteVerificationEl = document.getElementById('websiteVerification');
            if (websiteVerificationEl) {
                const verificationStatus = securityMetrics.website_verified ? 'Verified' : 'Unverified';
                websiteVerificationEl.textContent = verificationStatus;
                websiteVerificationEl.className = securityMetrics.website_verified ? 
                    'text-sm text-green-600' : 'text-sm text-red-600';
            }
            
            // Security Validation
            const securityValidationEl = document.getElementById('securityValidation');
            if (securityValidationEl) {
                const validationStatus = securityMetrics.security_validated ? 'Validated' : 'Pending';
                securityValidationEl.textContent = validationStatus;
                securityValidationEl.className = securityMetrics.security_validated ? 
                    'text-sm text-green-600' : 'text-sm text-yellow-600';
            }
            
            // Trust Score
            const trustScoreEl = document.getElementById('trustScore');
            if (trustScoreEl) {
                const trustScore = Math.round((securityMetrics.trust_score || 0.95) * 100);
                trustScoreEl.textContent = `${trustScore}%`;
                trustScoreEl.className = trustScore >= 90 ? 'text-sm text-green-600' : 
                    trustScore >= 70 ? 'text-sm text-yellow-600' : 'text-sm text-red-600';
            }
            
            // Populate security details
            const securityDetailsContent = document.getElementById('securityDetailsContent');
            if (securityDetailsContent) {
                securityDetailsContent.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h6 class="font-medium text-gray-900 mb-3">Security Validation Details</h6>
                            <ul class="space-y-2 text-sm text-gray-600">
                                <li class="flex items-center">
                                    <i class="fas fa-${securityMetrics.trusted_sources_only ? 'check' : 'times'} text-${securityMetrics.trusted_sources_only ? 'green' : 'red'}-500 mr-2"></i>
                                    Trusted Data Sources Only
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-${securityMetrics.website_verified ? 'check' : 'times'} text-${securityMetrics.website_verified ? 'green' : 'red'}-500 mr-2"></i>
                                    Website Ownership Verified
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-${securityMetrics.security_validated ? 'check' : 'times'} text-${securityMetrics.security_validated ? 'green' : 'red'}-500 mr-2"></i>
                                    Security Validation Complete
                                </li>
                            </ul>
                        </div>
                        <div>
                            <h6 class="font-medium text-gray-900 mb-3">Trust Metrics</h6>
                            <div class="space-y-2 text-sm text-gray-600">
                                <div class="flex justify-between">
                                    <span>Data Source Trust Rate:</span>
                                    <span class="font-medium">${Math.round((securityMetrics.data_source_trust_rate || 1.0) * 100)}%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Website Verification Rate:</span>
                                    <span class="font-medium">${Math.round((securityMetrics.website_verification_rate || 0.8) * 100)}%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Security Violation Rate:</span>
                                    <span class="font-medium">${Math.round((securityMetrics.security_violation_rate || 0.0) * 100)}%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // Populate Quality Metrics
        function populateQualityMetrics(result) {
            console.log('üìä populateQualityMetrics called with:', result);
            
            // Extract quality data from the result
            const qualityMetrics = result.quality_metrics || {};
            
            // Overall Quality
            const overallQualityEl = document.getElementById('overallQuality');
            if (overallQualityEl) {
                const qualityGrade = qualityMetrics.overall_quality >= 0.9 ? 'A' : 
                    qualityMetrics.overall_quality >= 0.8 ? 'B' : 
                    qualityMetrics.overall_quality >= 0.7 ? 'C' : 'D';
                overallQualityEl.textContent = qualityGrade;
                overallQualityEl.className = qualityGrade === 'A' ? 'text-sm text-green-600' : 
                    qualityGrade === 'B' ? 'text-sm text-blue-600' : 
                    qualityGrade === 'C' ? 'text-sm text-yellow-600' : 'text-sm text-red-600';
            }
            
            // Evidence Strength
            const evidenceStrengthEl = document.getElementById('evidenceStrength');
            if (evidenceStrengthEl) {
                const strength = qualityMetrics.evidence_strength >= 4.0 ? 'Strong' : 
                    qualityMetrics.evidence_strength >= 2.0 ? 'Moderate' : 'Weak';
                evidenceStrengthEl.textContent = strength;
                evidenceStrengthEl.className = strength === 'Strong' ? 'text-sm text-green-600' : 
                    strength === 'Moderate' ? 'text-sm text-yellow-600' : 'text-sm text-red-600';
            }
            
            // Data Completeness
            const dataCompletenessEl = document.getElementById('dataCompleteness');
            if (dataCompletenessEl) {
                const completeness = Math.round((qualityMetrics.data_completeness || 0.6) * 100);
                dataCompletenessEl.textContent = `${completeness}%`;
                dataCompletenessEl.className = completeness >= 80 ? 'text-sm text-green-600' : 
                    completeness >= 60 ? 'text-sm text-yellow-600' : 'text-sm text-red-600';
            }
            
            // Method Agreement
            const methodAgreementEl = document.getElementById('methodAgreement');
            if (methodAgreementEl) {
                const agreement = Math.round((qualityMetrics.method_agreement || 0.5) * 100);
                methodAgreementEl.textContent = `${agreement}%`;
                methodAgreementEl.className = agreement >= 80 ? 'text-sm text-green-600' : 
                    agreement >= 60 ? 'text-sm text-yellow-600' : 'text-sm text-red-600';
            }
            
            // Confidence Variance
            const confidenceVarianceEl = document.getElementById('confidenceVariance');
            if (confidenceVarianceEl) {
                const variance = qualityMetrics.confidence_variance <= 0.1 ? 'Low' : 
                    qualityMetrics.confidence_variance <= 0.3 ? 'Moderate' : 'High';
                confidenceVarianceEl.textContent = variance;
                confidenceVarianceEl.className = variance === 'Low' ? 'text-sm text-green-600' : 
                    variance === 'Moderate' ? 'text-sm text-yellow-600' : 'text-sm text-red-600';
            }
            
            // Populate quality details
            const qualityDetailsContent = document.getElementById('qualityDetailsContent');
            if (qualityDetailsContent) {
                qualityDetailsContent.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h6 class="font-medium text-gray-900 mb-3">Quality Assessment</h6>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600">Overall Quality Score:</span>
                                    <div class="flex items-center">
                                        <div class="w-20 bg-gray-200 rounded-full h-2 mr-2">
                                            <div class="bg-green-500 h-2 rounded-full" style="width: ${Math.round((qualityMetrics.overall_quality || 0.8) * 100)}%"></div>
                                        </div>
                                        <span class="text-sm font-medium">${Math.round((qualityMetrics.overall_quality || 0.8) * 100)}%</span>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600">Evidence Strength:</span>
                                    <div class="flex items-center">
                                        <div class="w-20 bg-gray-200 rounded-full h-2 mr-2">
                                            <div class="bg-blue-500 h-2 rounded-full" style="width: ${Math.min(100, Math.round((qualityMetrics.evidence_strength || 2.0) * 20))}%"></div>
                                        </div>
                                        <span class="text-sm font-medium">${(qualityMetrics.evidence_strength || 2.0).toFixed(1)}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h6 class="font-medium text-gray-900 mb-3">Method Performance</h6>
                            <div class="space-y-2 text-sm text-gray-600">
                                <div class="flex justify-between">
                                    <span>Method Agreement:</span>
                                    <span class="font-medium">${Math.round((qualityMetrics.method_agreement || 0.5) * 100)}%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Data Completeness:</span>
                                    <span class="font-medium">${Math.round((qualityMetrics.data_completeness || 0.6) * 100)}%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Confidence Variance:</span>
                                    <span class="font-medium">${(qualityMetrics.confidence_variance || 0.16).toFixed(2)}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // Populate Method Breakdown
        function populateMethodBreakdown(result) {
            console.log('üîß populateMethodBreakdown called with:', result);
            
            const methodBreakdownEl = document.getElementById('methodBreakdown');
            if (!methodBreakdownEl) return;
            
            const methodResults = result.method_breakdown || [];
            
            if (methodResults.length === 0) {
                methodBreakdownEl.innerHTML = '<p class="text-gray-500 text-sm">No method breakdown data available</p>';
                return;
            }
            
            methodBreakdownEl.innerHTML = methodResults.map(method => {
                const successIcon = method.success ? 'check-circle' : 'times-circle';
                const successColor = method.success ? 'green' : 'red';
                const confidence = Math.round((method.confidence || 0) * 100);
                
                return `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="flex items-center justify-between mb-2">
                            <h6 class="font-medium text-gray-900">${method.method_name || 'Unknown Method'}</h6>
                            <i class="fas fa-${successIcon} text-${successColor}-500"></i>
                        </div>
                        <div class="space-y-1 text-sm text-gray-600">
                            <div class="flex justify-between">
                                <span>Confidence:</span>
                                <span class="font-medium">${confidence}%</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Processing Time:</span>
                                <span class="font-medium">${(method.processing_time || 0).toFixed(0)}ms</span>
                            </div>
                            ${method.error ? `<div class="text-red-600 text-xs mt-1">${method.error}</div>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }
    </script>
    <script src="components/real-data-integration.js"></script>
    <script src="dashboard-real-data.js"></script>
</body>
</html>
