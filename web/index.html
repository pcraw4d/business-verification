<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- CSP temporarily disabled to fix font loading issues -->
    <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; img-src 'self' data: https:; font-src 'self' data: https://cdnjs.cloudflare.com https://fonts.gstatic.com; connect-src 'self' https:;"> -->
    <title>KYB Platform - Enhanced Business Intelligence Beta Testing</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="components/navigation.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: transform 0.2s ease-in-out;
        }
        .card-hover:hover {
            transform: translateY(-2px);
        }
        .feature-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 500;
            margin: 0.125rem;
        }
        .feature-active {
            background-color: #dcfce7;
            color: #166534;
        }
        .feature-beta {
            background-color: #fef3c7;
            color: #92400e;
        }
        .feature-new {
            background-color: #dbeafe;
            color: #1e40af;
        }
        .confidence-bar {
            background: linear-gradient(90deg, #ef4444 0%, #f97316 25%, #eab308 50%, #22c55e 75%, #3b82f6 100%);
        }

        /* Security Indicators Styles */
        .security-indicators {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 24px;
            margin: 24px 0;
        }

        .security-indicators h3 {
            color: #1e293b;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .security-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .security-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.2s ease;
        }

        .security-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .security-card.trust {
            border-left: 4px solid #10b981;
        }

        .security-card.verification {
            border-left: 4px solid #3b82f6;
        }

        .security-card.violations {
            border-left: 4px solid #f59e0b;
        }

        .security-card.quality {
            border-left: 4px solid #8b5cf6;
        }

        .security-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .security-card.trust .security-icon {
            background: #d1fae5;
            color: #10b981;
        }

        .security-card.verification .security-icon {
            background: #dbeafe;
            color: #3b82f6;
        }

        .security-card.violations .security-icon {
            background: #fef3c7;
            color: #f59e0b;
        }

        .security-card.quality .security-icon {
            background: #ede9fe;
            color: #8b5cf6;
        }

        .security-content {
            flex: 1;
        }

        .security-title {
            font-size: 14px;
            font-weight: 500;
            color: #64748b;
            margin-bottom: 4px;
        }

        .security-value {
            font-size: 24px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 4px;
        }

        .security-description {
            font-size: 12px;
            color: #94a3b8;
        }
        .expandable-section {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .expandable-section.expanded {
            max-height: 1000px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-xl font-bold text-gray-900">KYB Platform</h1>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded">ENHANCED</span>
                    <span class="bg-yellow-100 text-yellow-800 text-xs font-medium px-2.5 py-0.5 rounded">BETA</span>
                    <span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded">LIVE</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="gradient-bg">
        <div class="max-w-7xl mx-auto py-16 px-4 sm:py-24 sm:px-6 lg:px-8">
            <div class="text-center">
                <h1 class="text-4xl font-extrabold tracking-tight text-white sm:text-5xl md:text-6xl">
                    Enhanced Business Intelligence
                </h1>
                <p class="mt-6 max-w-3xl mx-auto text-xl text-gray-300">
                    Comprehensive KYB Platform with Advanced Data Extraction, Website Verification, and Business Intelligence Features
                </p>
                <div class="mt-10">
                    <button id="startTestingBtn" class="bg-white text-blue-600 px-8 py-3 rounded-md text-lg font-medium hover:bg-gray-100">
                        Start Enhanced Testing
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Features Section -->
    <div class="py-16 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
                    Enhanced Business Intelligence Features
                </h2>
                <p class="mt-4 text-lg text-gray-600">
                    Test all the advanced features of our comprehensive KYB platform
                </p>
            </div>
            <div class="mt-16 grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-4">
                <!-- Enhanced Classification -->
                <div class="card-hover bg-white p-6 rounded-lg shadow-md border border-gray-200">
                    <div class="text-center">
                        <i class="fas fa-brain text-4xl text-blue-600 mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-900">Enhanced Classification</h3>
                        <p class="mt-2 text-sm text-gray-600">Multi-method classification with ML integration and geographic awareness</p>
                        <div class="mt-3">
                            <span class="feature-badge feature-active">Active</span>
                        </div>
                    </div>
                </div>

                <!-- Website Verification -->
                <div class="card-hover bg-white p-6 rounded-lg shadow-md border border-gray-200">
                    <div class="text-center">
                        <i class="fas fa-shield-alt text-4xl text-green-600 mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-900">Website Verification</h3>
                        <p class="mt-2 text-sm text-gray-600">Advanced website ownership verification with 90%+ success rate</p>
                        <div class="mt-3">
                            <span class="feature-badge feature-active">Active</span>
                        </div>
                    </div>
                </div>

                <!-- Data Extraction -->
                <div class="card-hover bg-white p-6 rounded-lg shadow-md border border-gray-200">
                    <div class="text-center">
                        <i class="fas fa-database text-4xl text-purple-600 mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-900">Data Extraction</h3>
                        <p class="mt-2 text-sm text-gray-600">Comprehensive data extraction with 8 specialized extractors</p>
                        <div class="mt-3">
                            <span class="feature-badge feature-active">Active</span>
                        </div>
                    </div>
                </div>

                <!-- Business Intelligence -->
                <div class="card-hover bg-white p-6 rounded-lg shadow-md border border-gray-200">
                    <div class="text-center">
                        <i class="fas fa-chart-bar text-4xl text-orange-600 mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-900">Business Intelligence</h3>
                        <p class="mt-2 text-sm text-gray-600">Advanced analytics and intelligence platform</p>
                        <div class="mt-3">
                            <span class="feature-badge feature-active">Active</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Detailed Features Grid -->
    <div class="py-16 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
                    Comprehensive Feature Set
                </h2>
                <p class="mt-4 text-lg text-gray-600">
                    All enhanced features are implemented and ready for testing
                </p>
            </div>
            <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
                <!-- Company Size Extractor -->
                <div class="card-hover bg-white p-6 rounded-lg shadow-md border border-gray-200">
                    <div class="text-center">
                        <i class="fas fa-building text-3xl text-blue-600 mb-3"></i>
                        <h3 class="text-md font-medium text-gray-900">Company Size Analysis</h3>
                        <p class="mt-2 text-sm text-gray-600">Employee count, revenue indicators, growth stage</p>
                        <div class="mt-3">
                            <span class="feature-badge feature-active">Active</span>
                        </div>
                    </div>
                </div>

                <!-- Business Model Extractor -->
                <div class="card-hover bg-white p-6 rounded-lg shadow-md border border-gray-200">
                    <div class="text-center">
                        <i class="fas fa-sitemap text-3xl text-green-600 mb-3"></i>
                        <h3 class="text-md font-medium text-gray-900">Business Model Detection</h3>
                        <p class="mt-2 text-sm text-gray-600">B2B, B2C, marketplace, SaaS, e-commerce</p>
                        <div class="mt-3">
                            <span class="feature-badge feature-active">Active</span>
                        </div>
                    </div>
                </div>

                <!-- Technology Stack Extractor -->
                <div class="card-hover bg-white p-6 rounded-lg shadow-md border border-gray-200">
                    <div class="text-center">
                        <i class="fas fa-microchip text-3xl text-purple-600 mb-3"></i>
                        <h3 class="text-md font-medium text-gray-900">Technology Stack</h3>
                        <p class="mt-2 text-sm text-gray-600">Programming languages, frameworks, platforms</p>
                        <div class="mt-3">
                            <span class="feature-badge feature-active">Active</span>
                        </div>
                    </div>
                </div>

                <!-- Financial Health Extractor -->
                <div class="card-hover bg-white p-6 rounded-lg shadow-md border border-gray-200">
                    <div class="text-center">
                        <i class="fas fa-chart-line text-3xl text-orange-600 mb-3"></i>
                        <h3 class="text-md font-medium text-gray-900">Financial Health</h3>
                        <p class="mt-2 text-sm text-gray-600">Funding status, revenue indicators, stability</p>
                        <div class="mt-3">
                            <span class="feature-badge feature-active">Active</span>
                        </div>
                    </div>
                </div>

                <!-- Compliance Extractor -->
                <div class="card-hover bg-white p-6 rounded-lg shadow-md border border-gray-200">
                    <div class="text-center">
                        <i class="fas fa-certificate text-3xl text-red-600 mb-3"></i>
                        <h3 class="text-md font-medium text-gray-900">Compliance Analysis</h3>
                        <p class="mt-2 text-sm text-gray-600">Certifications, licenses, regulatory compliance</p>
                        <div class="mt-3">
                            <span class="feature-badge feature-active">Active</span>
                        </div>
                    </div>
                </div>

                <!-- Market Presence Extractor -->
                <div class="card-hover bg-white p-6 rounded-lg shadow-md border border-gray-200">
                    <div class="text-center">
                        <i class="fas fa-globe-americas text-3xl text-indigo-600 mb-3"></i>
                        <h3 class="text-md font-medium text-gray-900">Market Presence</h3>
                        <p class="mt-2 text-sm text-gray-600">Geographic coverage, market segments, competition</p>
                        <div class="mt-3">
                            <span class="feature-badge feature-active">Active</span>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Contact Extractor -->
                <div class="card-hover bg-white p-6 rounded-lg shadow-md border border-gray-200">
                    <div class="text-center">
                        <i class="fas fa-address-book text-3xl text-teal-600 mb-3"></i>
                        <h3 class="text-md font-medium text-gray-900">Contact Intelligence</h3>
                        <p class="mt-2 text-sm text-gray-600">Email, phone, social media, team information</p>
                        <div class="mt-3">
                            <span class="feature-badge feature-active">Active</span>
                        </div>
                    </div>
                </div>

                <!-- Data Quality Framework -->
                <div class="card-hover bg-white p-6 rounded-lg shadow-md border border-gray-200">
                    <div class="text-center">
                        <i class="fas fa-check-circle text-3xl text-emerald-600 mb-3"></i>
                        <h3 class="text-md font-medium text-gray-900">Data Quality</h3>
                        <p class="mt-2 text-sm text-gray-600">Validation, accuracy, completeness assessment</p>
                        <div class="mt-3">
                            <span class="feature-badge feature-active">Active</span>
                        </div>
                    </div>
                </div>

                <!-- Validation Framework -->
                <div class="card-hover bg-white p-6 rounded-lg shadow-md border border-gray-200">
                    <div class="text-center">
                        <i class="fas fa-clipboard-check text-3xl text-cyan-600 mb-3"></i>
                        <h3 class="text-md font-medium text-gray-900">Validation Framework</h3>
                        <p class="mt-2 text-sm text-gray-600">Comprehensive validation and testing</p>
                        <div class="mt-3">
                            <span class="feature-badge feature-active">Active</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Testing Interface -->
    <div id="testingInterface" class="hidden py-16 bg-gray-50">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="bg-white rounded-lg shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Enhanced Business Intelligence Testing</h2>
                
                <!-- Input Form -->
                <form id="classificationForm" class="space-y-6">
                    <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                        <div>
                            <label for="businessName" class="block text-sm font-medium text-gray-700 mb-2">
                                Business Name *
                            </label>
                            <input type="text" id="businessName" name="businessName" required
                                   placeholder="e.g., Acme Corporation"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        
                        <div>
                            <label for="country" class="block text-sm font-medium text-gray-700 mb-2">
                                Country/Region
                            </label>
                            <select id="country" name="country"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Select a country</option>
                                <option value="us">United States</option>
                                <option value="ca">Canada</option>
                                <option value="uk">United Kingdom</option>
                                <option value="au">Australia</option>
                                <option value="de">Germany</option>
                                <option value="fr">France</option>
                                <option value="jp">Japan</option>
                                <option value="cn">China</option>
                                <option value="in">India</option>
                                <option value="br">Brazil</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label for="websiteUrl" class="block text-sm font-medium text-gray-700 mb-2">
                            Website URL (Optional)
                        </label>
                        <input type="url" id="websiteUrl" name="websiteUrl"
                               placeholder="https://www.example.com"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        <p class="mt-1 text-sm text-gray-500">Providing a website URL enables website verification and enhanced data extraction</p>
                    </div>
                    
                    <div>
                        <label for="description" class="block text-sm font-medium text-gray-700 mb-2">
                            Business Description (Optional)
                        </label>
                        <textarea id="description" name="description" rows="3"
                                  placeholder="Brief description of the business activities..."
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"></textarea>
                    </div>
                    
                    <div class="flex justify-center">
                        <button type="submit" 
                                class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-md text-lg font-medium">
                            <i class="fas fa-search mr-2"></i>
                            Analyze Business Intelligence
                        </button>
                    </div>
                </form>

                <!-- Loading Spinner -->
                <div id="loadingSpinner" class="hidden text-center py-8">
                    <div class="inline-flex items-center">
                        <svg class="animate-spin -ml-1 mr-3 h-8 w-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <span class="text-lg text-gray-700">Analyzing business intelligence data...</span>
                    </div>
                </div>

                <!-- Results Section -->
                <div id="resultsSection" class="hidden mt-8">
                    <h3 class="text-xl font-bold text-gray-900 mb-4">Enhanced Business Intelligence Results</h3>
                    <div id="resultsContent"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800">
        <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <p class="text-gray-400">&copy; 2024 KYB Platform. Enhanced Business Intelligence Beta Testing Environment.</p>
                <p class="mt-2 text-sm text-gray-500">
                    All enhanced features are active and ready for comprehensive testing.
                </p>
            </div>
        </div>
    </footer>

    <script>
        // API Base URL - Update this with your actual API URL
        const API_BASE_URL = window.location.origin + '/v1';
        
        // DOM Elements
        const startTestingBtn = document.getElementById('startTestingBtn');
        const testingInterface = document.getElementById('testingInterface');
        const classificationForm = document.getElementById('classificationForm');
        const resultsSection = document.getElementById('resultsSection');
        const resultsContent = document.getElementById('resultsContent');
        const loadingSpinner = document.getElementById('loadingSpinner');

        // Event Listeners
        startTestingBtn.addEventListener('click', () => {
            testingInterface.classList.remove('hidden');
            testingInterface.scrollIntoView({ behavior: 'smooth' });
        });

        // Classification Form Submission
        classificationForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(classificationForm);
            const data = {
                business_name: formData.get('businessName'),
                geographic_region: formData.get('country') || 'us',
                website_url: formData.get('websiteUrl') || '',
                description: formData.get('description') || ''
            };

            // Show loading spinner
            loadingSpinner.classList.remove('hidden');
            resultsSection.classList.add('hidden');

            try {
                const response = await fetch(`${API_BASE_URL}/classify`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                
                // Hide loading spinner
                loadingSpinner.classList.add('hidden');
                
                // Display results
                displayResults(result);
                
            } catch (error) {
                console.error('Error:', error);
                loadingSpinner.classList.add('hidden');
                displayError('An error occurred while processing the business intelligence analysis. Please try again.');
            }
        });

        // Create enhanced reasoning details section
        function createReasoningDetailsSection(result) {
            // Handle Railway API response format
            let processedResult = result;
            if (result.response && result.response.classifications) {
                const response = result.response;
                const primaryClassification = response.primary_classification;
                
                processedResult = {
                    method_breakdown: result.raw_data?.method_results || [],
                    classification_reasoning: primaryClassification?.metadata?.detailed_reasoning?.summary || '',
                    quality_metrics: primaryClassification?.metadata?.comprehensive_quality_metrics || null,
                    classifications: response.classifications || []
                };
            }
            
            const methodBreakdown = processedResult.method_breakdown || [];
            const classificationReasoning = processedResult.classification_reasoning || '';
            const qualityMetrics = processedResult.quality_metrics || null;
            const securityMetrics = processedResult.security_metrics || null;
            const classifications = processedResult.classifications || [];
            
            // Extract evidence from classifications
            const evidenceItems = classifications.map(c => ({
                type: c.code_type || 'Unknown',
                code: c.code || 'N/A',
                description: c.description || 'No description available',
                confidence: c.confidence_score || 0,
                evidence: c.evidence || 'No evidence provided',
                keywords: c.keywords || [],
                method: c.classification_method || 'Unknown'
            }));
            
            // Create evidence items display
            const evidenceHTML = evidenceItems.length > 0 ? `
                <div class="mb-6">
                    <h5 class="font-semibold text-gray-900 mb-3 flex items-center">
                        <i class="fas fa-clipboard-list text-blue-600 mr-2"></i>
                        Evidence Items
                    </h5>
                    <div class="space-y-3">
                        ${evidenceItems.map(item => `
                            <div class="bg-white border border-gray-200 rounded-lg p-4">
                                <div class="flex justify-between items-start mb-2">
                                    <div>
                                        <span class="inline-block px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full mr-2">${item.type}</span>
                                        <span class="font-medium text-gray-900">${item.code}</span>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-sm font-medium text-gray-900">${Math.round(item.confidence * 100)}%</div>
                                        <div class="text-xs text-gray-500">${item.method}</div>
                                    </div>
                                </div>
                                <p class="text-sm text-gray-700 mb-2">${item.description}</p>
                                <p class="text-sm text-gray-600 mb-2"><strong>Evidence:</strong> ${item.evidence}</p>
                                ${item.keywords.length > 0 ? `
                                    <div class="flex flex-wrap gap-1">
                                        ${item.keywords.slice(0, 5).map(keyword => `
                                            <span class="px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded">${keyword}</span>
                                        `).join('')}
                                        ${item.keywords.length > 5 ? `<span class="text-xs text-gray-500">+${item.keywords.length - 5} more</span>` : ''}
                                    </div>
                                ` : ''}
                            </div>
                        `).join('')}
                    </div>
                </div>
            ` : '';
            
            // Create method reasoning explanation
            const methodReasoningHTML = methodBreakdown.length > 0 ? `
                <div class="mb-6">
                    <h5 class="font-semibold text-gray-900 mb-3 flex items-center">
                        <i class="fas fa-cogs text-green-600 mr-2"></i>
                        Method Reasoning Explanation
                    </h5>
                    <div class="space-y-4">
                        ${methodBreakdown.map(method => `
                            <div class="bg-white border border-gray-200 rounded-lg p-4">
                                <div class="flex justify-between items-center mb-3">
                                    <div class="flex items-center">
                                        <span class="inline-block px-3 py-1 ${getMethodTypeClass(method.method_type)} text-sm rounded-full mr-3">
                                            ${method.method_type.toUpperCase()}
                                        </span>
                                        <span class="font-medium text-gray-900">${method.method_name}</span>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-sm font-medium text-gray-900">${Math.round(method.confidence * 100)}%</div>
                                        <div class="text-xs text-gray-500">${Math.round(method.processing_time * 1000)}ms</div>
                                    </div>
                                </div>
                                
                                ${method.success ? `
                                    <div class="mb-3">
                                        <p class="text-sm text-gray-700 mb-2"><strong>Result:</strong> ${method.result?.industry_name || 'No result'}</p>
                                        ${method.evidence && method.evidence.length > 0 ? `
                                            <p class="text-sm text-gray-600 mb-2"><strong>Evidence:</strong></p>
                                            <ul class="text-sm text-gray-600 list-disc list-inside ml-4">
                                                ${method.evidence.map(evidence => `<li>${evidence}</li>`).join('')}
                                            </ul>
                                        ` : ''}
                                        ${method.keywords && method.keywords.length > 0 ? `
                                            <div class="mt-2">
                                                <p class="text-sm text-gray-600 mb-1"><strong>Keywords Used:</strong></p>
                                                <div class="flex flex-wrap gap-1">
                                                    ${method.keywords.slice(0, 8).map(keyword => `
                                                        <span class="px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded">${keyword}</span>
                                                    `).join('')}
                                                    ${method.keywords.length > 8 ? `<span class="text-xs text-gray-500">+${method.keywords.length - 8} more</span>` : ''}
                                                </div>
                                            </div>
                                        ` : ''}
                                    </div>
                                ` : `
                                    <div class="mb-3">
                                        <p class="text-sm text-red-600"><strong>Error:</strong> ${method.error || 'Unknown error'}</p>
                                    </div>
                                `}
                            </div>
                        `).join('')}
                    </div>
                </div>
            ` : '';
            
            // Create confidence analysis
            const confidenceAnalysisHTML = `
                <div class="mb-6">
                    <h5 class="font-semibold text-gray-900 mb-3 flex items-center">
                        <i class="fas fa-chart-line text-purple-600 mr-2"></i>
                        Confidence Analysis
                    </h5>
                    <div class="bg-white border border-gray-200 rounded-lg p-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <p class="text-sm text-gray-600 mb-2"><strong>Overall Confidence:</strong></p>
                                <div class="flex items-center">
                                    <div class="w-full bg-gray-200 rounded-full h-3 mr-3">
                                        <div class="bg-purple-600 h-3 rounded-full" style="width: ${Math.round((result.overall_confidence || result.confidence_score || 0) * 100)}%"></div>
                                    </div>
                                    <span class="text-sm font-medium text-gray-900">${Math.round((result.overall_confidence || result.confidence_score || 0) * 100)}%</span>
                                </div>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600 mb-2"><strong>Method Agreement:</strong></p>
                                <div class="flex items-center">
                                    <div class="w-full bg-gray-200 rounded-full h-3 mr-3">
                                        <div class="bg-green-600 h-3 rounded-full" style="width: ${Math.round((qualityMetrics?.method_agreement || 0.85) * 100)}%"></div>
                                    </div>
                                    <span class="text-sm font-medium text-gray-900">${Math.round((qualityMetrics?.method_agreement || 0.85) * 100)}%</span>
                                </div>
                            </div>
                        </div>
                        
                        ${qualityMetrics ? `
                            <div class="mt-4 pt-4 border-t border-gray-200">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                                    <div>
                                        <p class="text-gray-600"><strong>Evidence Strength:</strong></p>
                                        <p class="text-gray-900">${Math.round((qualityMetrics.evidence_strength || 0) * 100)}%</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-600"><strong>Data Completeness:</strong></p>
                                        <p class="text-gray-900">${Math.round((qualityMetrics.data_completeness || 0) * 100)}%</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-600"><strong>Confidence Variance:</strong></p>
                                        <p class="text-gray-900">${Math.round((qualityMetrics.confidence_variance || 0) * 100)}%</p>
                                    </div>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            // Create recommendations section
            const recommendationsHTML = `
                <div class="mb-6">
                    <h5 class="font-semibold text-gray-900 mb-3 flex items-center">
                        <i class="fas fa-lightbulb text-yellow-600 mr-2"></i>
                        Recommendations
                    </h5>
                    <div class="bg-white border border-gray-200 rounded-lg p-4">
                        <div class="space-y-3">
                            ${generateRecommendations(result, qualityMetrics, securityMetrics)}
                        </div>
                    </div>
                </div>
            `;
            
            // Only show the section if we have meaningful data
            if (evidenceItems.length > 0 || methodBreakdown.length > 0 || classificationReasoning) {
                return `
                    <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                        <h4 class="font-bold text-gray-900 text-lg mb-4 flex items-center">
                            <i class="fas fa-search text-gray-600 mr-2"></i>
                            Classification Reasoning Details
                        </h4>
                        <p class="text-gray-600 mb-6">Detailed analysis of how the classification was determined, including evidence, method reasoning, and confidence analysis.</p>
                        
                        ${evidenceHTML}
                        ${methodReasoningHTML}
                        ${confidenceAnalysisHTML}
                        ${recommendationsHTML}
                        
                        ${classificationReasoning ? `
                            <div class="mt-6 pt-6 border-t border-gray-200">
                                <h5 class="font-semibold text-gray-900 mb-3 flex items-center">
                                    <i class="fas fa-comment-alt text-indigo-600 mr-2"></i>
                                    Classification Summary
                                </h5>
                                <p class="text-sm text-gray-700 bg-indigo-50 p-4 rounded-lg">${classificationReasoning}</p>
                            </div>
                        ` : ''}
                    </div>
                `;
            }
            
            return '';
        }
        
        // Helper function to get method type CSS class
        function getMethodTypeClass(methodType) {
            switch (methodType) {
                case 'keyword':
                    return 'bg-blue-100 text-blue-800';
                case 'ml':
                    return 'bg-purple-100 text-purple-800';
                case 'description':
                    return 'bg-green-100 text-green-800';
                default:
                    return 'bg-gray-100 text-gray-800';
            }
        }
        
        // Generate recommendations based on analysis
        function generateRecommendations(result, qualityMetrics, securityMetrics) {
            const recommendations = [];
            
            // Confidence-based recommendations
            const overallConfidence = result.overall_confidence || result.confidence_score || 0;
            if (overallConfidence < 0.7) {
                recommendations.push({
                    type: 'warning',
                    icon: 'fas fa-exclamation-triangle',
                    title: 'Low Confidence Score',
                    description: 'Consider providing more detailed business information to improve classification accuracy.'
                });
            }
            
            // Quality-based recommendations
            if (qualityMetrics) {
                if (qualityMetrics.evidence_strength < 0.8) {
                    recommendations.push({
                        type: 'info',
                        icon: 'fas fa-info-circle',
                        title: 'Evidence Strength',
                        description: 'Additional business documentation or website content could strengthen the classification evidence.'
                    });
                }
                
                if (qualityMetrics.data_completeness < 0.9) {
                    recommendations.push({
                        type: 'info',
                        icon: 'fas fa-database',
                        title: 'Data Completeness',
                        description: 'Consider adding more business details like industry description, services offered, or target market.'
                    });
                }
            }
            
            // Security-based recommendations
            if (securityMetrics) {
                if (securityMetrics.data_source_trust?.trust_rate < 1.0) {
                    recommendations.push({
                        type: 'security',
                        icon: 'fas fa-shield-alt',
                        title: 'Data Source Verification',
                        description: 'Some data sources could not be fully verified. Consider using official business registration documents.'
                    });
                }
            }
            
            // Default recommendation if no specific issues
            if (recommendations.length === 0) {
                recommendations.push({
                    type: 'success',
                    icon: 'fas fa-check-circle',
                    title: 'High Quality Classification',
                    description: 'The classification appears to be of high quality with strong evidence and confidence scores.'
                });
            }
            
            return recommendations.map(rec => `
                <div class="flex items-start p-3 rounded-lg ${getRecommendationTypeClass(rec.type)}">
                    <i class="${rec.icon} ${getRecommendationIconClass(rec.type)} mr-3 mt-1"></i>
                    <div>
                        <h6 class="font-medium ${getRecommendationTitleClass(rec.type)}">${rec.title}</h6>
                        <p class="text-sm ${getRecommendationTextClass(rec.type)}">${rec.description}</p>
                    </div>
                </div>
            `).join('');
        }
        
        // Helper functions for recommendation styling
        function getRecommendationTypeClass(type) {
            switch (type) {
                case 'success': return 'bg-green-50 border border-green-200';
                case 'warning': return 'bg-yellow-50 border border-yellow-200';
                case 'info': return 'bg-blue-50 border border-blue-200';
                case 'security': return 'bg-purple-50 border border-purple-200';
                default: return 'bg-gray-50 border border-gray-200';
            }
        }
        
        function getRecommendationIconClass(type) {
            switch (type) {
                case 'success': return 'text-green-600';
                case 'warning': return 'text-yellow-600';
                case 'info': return 'text-blue-600';
                case 'security': return 'text-purple-600';
                default: return 'text-gray-600';
            }
        }
        
        function getRecommendationTitleClass(type) {
            switch (type) {
                case 'success': return 'text-green-900';
                case 'warning': return 'text-yellow-900';
                case 'info': return 'text-blue-900';
                case 'security': return 'text-purple-900';
                default: return 'text-gray-900';
            }
        }
        
        function getRecommendationTextClass(type) {
            switch (type) {
                case 'success': return 'text-green-700';
                case 'warning': return 'text-yellow-700';
                case 'info': return 'text-blue-700';
                case 'security': return 'text-purple-700';
                default: return 'text-gray-700';
            }
        }

        // Display enhanced business intelligence results
        function displayResults(result) {
            resultsSection.classList.remove('hidden');
            
            // Handle Railway API response format
            let processedResult = result;
            if (result.response && result.response.classifications) {
                const response = result.response;
                const primaryClassification = response.primary_classification;
                
                processedResult = {
                    success: true,
                    business_id: response.id || 'unknown',
                    primary_industry: primaryClassification?.industry_name || response.detected_industry || 'Unknown',
                    classifications: response.classifications || [],
                    overall_confidence: primaryClassification?.confidence_score || response.overall_confidence || 0,
                    confidence_score: primaryClassification?.confidence_score || response.overall_confidence || 0,
                    method_breakdown: result.raw_data?.method_results || [],
                    classification_reasoning: primaryClassification?.metadata?.detailed_reasoning?.summary || '',
                    quality_metrics: primaryClassification?.metadata?.comprehensive_quality_metrics || null
                };
            }
            
            if (processedResult.success && processedResult.business_id) {
                const primaryIndustry = processedResult.primary_industry || processedResult.classifications?.[0]?.industry_name || 'Technology';
                const classifications = processedResult.classifications || [];
                const overallConfidence = processedResult.overall_confidence || processedResult.confidence_score || 0;
                
                // Group classifications by code type
                const naicsCodes = classifications.filter(c => c.code_type === 'NAICS').slice(0, 3);
                const mccCodes = classifications.filter(c => c.code_type === 'MCC').slice(0, 3);
                const sicCodes = classifications.filter(c => c.code_type === 'SIC').slice(0, 3);
                
                resultsContent.innerHTML = `
                    <div class="space-y-6">
                        <!-- Primary Classification -->
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                            <h4 class="font-bold text-blue-900 text-lg mb-3">Primary Classification</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <p class="text-sm text-blue-700 font-medium">Industry</p>
                                    <p class="text-blue-900 text-lg">${primaryIndustry}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-blue-700 font-medium">Primary Code</p>
                                    <p class="text-blue-900 text-lg">${classifications[0]?.code || 'N/A'}</p>
                                </div>
                            </div>
                            <div class="mt-4">
                                <p class="text-sm text-blue-700 font-medium mb-2">Confidence Score</p>
                                <div class="w-full bg-gray-200 rounded-full h-3">
                                    <div class="confidence-bar h-3 rounded-full" style="width: ${Math.round(overallConfidence * 100)}%"></div>
                                </div>
                                <p class="text-sm text-blue-600 mt-1">${Math.round(overallConfidence * 100)}% confidence</p>
                            </div>
                        </div>
                        
                        <!-- Risk Assessment -->
                        ${result.risk_assessment ? createRiskAssessmentHTML(result.risk_assessment) : ''}
                        
                        <!-- Enhanced Features Status -->
                        <div class="bg-green-50 border border-green-200 rounded-lg p-6">
                            <h4 class="font-bold text-green-900 text-lg mb-3">Enhanced Business Intelligence Features</h4>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                ${Object.entries(result.enhanced_features || {}).map(([feature, status]) => {
                                    const featureIcons = {
                                        'geographic_awareness': 'fas fa-globe',
                                        'confidence_scoring': 'fas fa-chart-line',
                                        'ml_integration': 'fas fa-brain',
                                        'web_search': 'fas fa-search',
                                        'website_analysis': 'fas fa-shield-alt',
                                        'data_extraction': 'fas fa-database',
                                        'industry_detection': 'fas fa-building',
                                        'enhanced_classification': 'fas fa-sitemap',
                                        'batch_processing': 'fas fa-layer-group',
                                        'beta_testing_ui': 'fas fa-flask',
                                        'cloud_deployment': 'fas fa-cloud',
                                        'database_driven_keywords': 'fas fa-key',
                                        'keyword_weighted_scoring': 'fas fa-weight-hanging',
                                        'modular_architecture': 'fas fa-cubes',
                                        'real_time_feedback': 'fas fa-comments',
                                        'supabase_integration': 'fas fa-database',
                                        'validation_framework': 'fas fa-check-circle',
                                        'worldwide_access': 'fas fa-globe-americas'
                                    };
                                    const icon = featureIcons[feature] || 'fas fa-cog';
                                    const displayName = feature.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                                    return `
                                        <div class="text-center">
                                            <i class="${icon} text-green-600 text-xl mb-2"></i>
                                            <p class="text-sm text-green-700">${displayName}</p>
                                            <span class="feature-badge feature-active">${status}</span>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                        
                        <!-- Processing Information -->
                        <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                            <h4 class="font-bold text-gray-900 text-lg mb-3">Processing Information</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <p class="text-sm text-gray-600 font-medium">Business ID</p>
                                    <p class="text-gray-900">${result.business_id}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600 font-medium">Business Name Processed</p>
                                    <p class="text-gray-900">${document.getElementById('businessName').value || 'N/A'}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600 font-medium">Analysis Method</p>
                                    <p class="text-gray-900">${result.classification_method || 'Enhanced Multi-Method'}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600 font-medium">Processing Time</p>
                                    <p class="text-gray-900">${result.processing_time || '0.1s'}</p>
                                </div>
                            </div>
                        </div>

                        <!-- Enhanced Analysis Features -->
                        ${result.data_extraction ? `
                            <div class="bg-purple-50 border border-purple-200 rounded-lg p-6">
                                <h4 class="font-bold text-purple-900 text-lg mb-4">Enhanced Business Analysis</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    ${result.data_extraction.company_size ? `
                                        <div class="bg-white p-4 rounded-lg border">
                                            <h5 class="font-semibold text-gray-900 mb-2 flex items-center">
                                                <i class="fas fa-building text-blue-600 mr-2"></i>
                                                Company Size
                                            </h5>
                                            <p class="text-sm text-gray-600">Size: ${result.data_extraction.company_size.size_category || 'N/A'}</p>
                                            <p class="text-sm text-gray-600">Employees: ${result.data_extraction.company_size.employee_count || 'N/A'}</p>
                                        </div>
                                    ` : ''}
                                    
                                    ${result.data_extraction.business_model ? `
                                        <div class="bg-white p-4 rounded-lg border">
                                            <h5 class="font-semibold text-gray-900 mb-2 flex items-center">
                                                <i class="fas fa-sitemap text-green-600 mr-2"></i>
                                                Business Model
                                            </h5>
                                            <p class="text-sm text-gray-600">Type: ${result.data_extraction.business_model.model_type || 'N/A'}</p>
                                            <p class="text-sm text-gray-600">Confidence: ${result.data_extraction.business_model.confidence || 'N/A'}</p>
                                        </div>
                                    ` : ''}
                                    
                                    ${result.data_extraction.technology_stack ? `
                                        <div class="bg-white p-4 rounded-lg border">
                                            <h5 class="font-semibold text-gray-900 mb-2 flex items-center">
                                                <i class="fas fa-microchip text-purple-600 mr-2"></i>
                                                Technology Stack
                                            </h5>
                                            <p class="text-sm text-gray-600">Primary: ${result.data_extraction.technology_stack.primary_tech || 'N/A'}</p>
                                            <p class="text-sm text-gray-600">Platforms: ${(result.data_extraction.technology_stack.platforms || []).join(', ') || 'N/A'}</p>
                                        </div>
                                    ` : ''}
                                    
                                    ${result.data_extraction.financial_health ? `
                                        <div class="bg-white p-4 rounded-lg border">
                                            <h5 class="font-semibold text-gray-900 mb-2 flex items-center">
                                                <i class="fas fa-chart-line text-orange-600 mr-2"></i>
                                                Financial Health
                                            </h5>
                                            <p class="text-sm text-gray-600">Revenue: ${result.data_extraction.financial_health.revenue_range || 'N/A'}</p>
                                            <p class="text-sm text-gray-600">Funding: ${result.data_extraction.financial_health.funding_status || 'N/A'}</p>
                                        </div>
                                    ` : ''}
                                    
                                    ${result.data_extraction.market_presence ? `
                                        <div class="bg-white p-4 rounded-lg border">
                                            <h5 class="font-semibold text-gray-900 mb-2 flex items-center">
                                                <i class="fas fa-globe text-indigo-600 mr-2"></i>
                                                Market Presence
                                            </h5>
                                            <p class="text-sm text-gray-600">Coverage: ${result.data_extraction.market_presence.geographic_coverage || 'N/A'}</p>
                                            <p class="text-sm text-gray-600">Segments: ${(result.data_extraction.market_presence.market_segments || []).join(', ') || 'N/A'}</p>
                                        </div>
                                    ` : ''}
                                    
                                    ${result.data_extraction.compliance ? `
                                        <div class="bg-white p-4 rounded-lg border">
                                            <h5 class="font-semibold text-gray-900 mb-2 flex items-center">
                                                <i class="fas fa-shield-alt text-red-600 mr-2"></i>
                                                Compliance
                                            </h5>
                                            <p class="text-sm text-gray-600">Status: ${result.data_extraction.compliance.regulatory_status || 'N/A'}</p>
                                            <p class="text-sm text-gray-600">Certifications: ${(result.data_extraction.compliance.certifications || []).join(', ') || 'None'}</p>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        ` : ''}
                        
                        <!-- Website Verification Results -->
                        ${result.website_verification ? `
                            <div class="bg-purple-50 border border-purple-200 rounded-lg p-6">
                                <h4 class="font-bold text-purple-900 text-lg mb-3">Website Verification Results</h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                    <div>
                                        <p class="text-sm text-purple-700 font-medium">Verification Status</p>
                                        <p class="text-purple-900 font-medium">${result.website_verification.status || 'PENDING'}</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-purple-700 font-medium">Confidence Score</p>
                                        <p class="text-purple-900">${result.website_verification.confidence_score ? Math.round(result.website_verification.confidence_score * 100) + '%' : 'N/A'}</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-purple-700 font-medium">Domain Name</p>
                                        <p class="text-purple-900">${result.website_verification.domain_name || 'N/A'}</p>
                                    </div>
                                </div>
                                
                                ${result.website_verification.verification_methods && result.website_verification.verification_methods.length > 0 ? `
                                    <div class="mb-4">
                                        <p class="text-sm text-purple-700 font-medium mb-2">Verification Methods Used</p>
                                        <div class="flex flex-wrap gap-2">
                                            ${result.website_verification.verification_methods.map(method => `
                                                <span class="px-2 py-1 bg-purple-200 text-purple-800 text-xs rounded-full">
                                                    ${method.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}
                                                </span>
                                            `).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                                
                                ${result.website_verification.details ? `
                                    <div class="mb-4">
                                        <p class="text-sm text-purple-700 font-medium mb-2">Verification Details</p>
                                        <p class="text-purple-900 text-sm">${result.website_verification.details}</p>
                                    </div>
                                ` : ''}
                                
                                ${result.website_verification.whois_info ? `
                                    <div class="mb-4">
                                        <p class="text-sm text-purple-700 font-medium mb-2">WHOIS Information</p>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                                            <div><span class="font-medium">Registrant:</span> ${result.website_verification.whois_info.registrant_name || 'N/A'}</div>
                                            <div><span class="font-medium">Organization:</span> ${result.website_verification.whois_info.registrant_org || 'N/A'}</div>
                                            <div><span class="font-medium">Country:</span> ${result.website_verification.whois_info.registrant_country || 'N/A'}</div>
                                            <div><span class="font-medium">Created:</span> ${result.website_verification.whois_info.creation_date || 'N/A'}</div>
                                        </div>
                                    </div>
                                ` : ''}
                                
                                ${result.website_verification.contact_info ? `
                                    <div class="mb-4">
                                        <p class="text-sm text-purple-700 font-medium mb-2">Contact Information</p>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                                            <div><span class="font-medium">Phone Match:</span> ${result.website_verification.contact_info.phone_match ? 'Yes' : 'No'}</div>
                                            <div><span class="font-medium">Email Match:</span> ${result.website_verification.contact_info.email_match ? 'Yes' : 'No'}</div>
                                            ${result.website_verification.contact_info.phone_found ? `<div><span class="font-medium">Phone Found:</span> ${result.website_verification.contact_info.phone_found}</div>` : ''}
                                            ${result.website_verification.contact_info.email_found ? `<div><span class="font-medium">Email Found:</span> ${result.website_verification.contact_info.email_found}</div>` : ''}
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        ` : ''}

                        <!-- Website Analysis & Keywords -->
                        ${result.real_time_scraping ? `
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                                <h4 class="font-bold text-blue-900 text-lg mb-3">Website Analysis & Keywords</h4>
                                
                                ${result.real_time_scraping.content_extracted ? `
                                    <div class="mb-4">
                                        <h5 class="font-semibold text-blue-800 mb-2">Content Analysis</h5>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                            <div>
                                                <span class="font-medium">Content Length:</span> ${result.real_time_scraping.content_extracted.content_length || 0} characters
                                            </div>
                                            <div>
                                                <span class="font-medium">Keywords Found:</span> ${result.real_time_scraping.content_extracted.keywords_found ? result.real_time_scraping.content_extracted.keywords_found.length : 0}
                                            </div>
                                        </div>
                                        
                                        ${result.real_time_scraping.content_extracted.keywords_found && result.real_time_scraping.content_extracted.keywords_found.length > 0 ? `
                                            <div class="mt-3">
                                                <p class="font-medium text-blue-800 mb-2">Keywords Extracted:</p>
                                                <div class="flex flex-wrap gap-2">
                                                    ${result.real_time_scraping.content_extracted.keywords_found.map(keyword => `
                                                        <span class="px-2 py-1 bg-blue-200 text-blue-800 text-xs rounded-full">
                                                            ${keyword}
                                                        </span>
                                                    `).join('')}
                                                </div>
                                            </div>
                                        ` : ''}
                                        
                                        ${result.real_time_scraping.content_extracted.content_preview ? `
                                            <div class="mt-3">
                                                <p class="font-medium text-blue-800 mb-2">Content Preview:</p>
                                                <p class="text-sm text-blue-700 bg-blue-100 p-2 rounded">${result.real_time_scraping.content_extracted.content_preview}</p>
                                            </div>
                                        ` : ''}
                                    </div>
                                ` : ''}
                                
                                ${result.real_time_scraping.industry_analysis ? `
                                    <div class="mb-4">
                                        <h5 class="font-semibold text-blue-800 mb-2">Industry Analysis from Website</h5>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                            <div>
                                                <span class="font-medium">Detected Industry:</span> ${result.real_time_scraping.industry_analysis.detected_industry || 'N/A'}
                                            </div>
                                            <div>
                                                <span class="font-medium">Confidence:</span> ${result.real_time_scraping.industry_analysis.confidence ? Math.round(result.real_time_scraping.industry_analysis.confidence * 100) + '%' : 'N/A'}
                                            </div>
                                            <div>
                                                <span class="font-medium">Analysis Method:</span> ${result.real_time_scraping.industry_analysis.analysis_method || 'N/A'}
                                            </div>
                                            <div>
                                                <span class="font-medium">Evidence:</span> ${result.real_time_scraping.industry_analysis.evidence || 'N/A'}
                                            </div>
                                        </div>
                                        
                                        ${result.real_time_scraping.industry_analysis.keywords_matched && result.real_time_scraping.industry_analysis.keywords_matched.length > 0 ? `
                                            <div class="mt-3">
                                                <p class="font-medium text-blue-800 mb-2">Keywords That Matched Industry:</p>
                                                <div class="flex flex-wrap gap-2">
                                                    ${result.real_time_scraping.industry_analysis.keywords_matched.map(keyword => `
                                                        <span class="px-2 py-1 bg-green-200 text-green-800 text-xs rounded-full">
                                                            ${keyword}
                                                        </span>
                                                    `).join('')}
                                                </div>
                                            </div>
                                        ` : ''}
                                    </div>
                                ` : ''}
                                
                                ${result.real_time_scraping.progress_steps && result.real_time_scraping.progress_steps.length > 0 ? `
                                    <div class="mb-4">
                                        <h5 class="font-semibold text-blue-800 mb-2">Scraping Progress</h5>
                                        <div class="space-y-2">
                                            ${result.real_time_scraping.progress_steps.map(step => `
                                                <div class="flex items-center text-sm">
                                                    <span class="w-2 h-2 rounded-full ${step.status === 'completed' ? 'bg-green-500' : step.status === 'failed' ? 'bg-red-500' : 'bg-yellow-500'} mr-2"></span>
                                                    <span class="font-medium">${step.step.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}:</span>
                                                    <span class="ml-2">${step.message}</span>
                                                    ${step.duration ? `<span class="ml-2 text-gray-500">(${step.duration})</span>` : ''}
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        ` : ''}
                        
                        <!-- Data Extraction Results -->
                        ${result.data_extraction ? `
                            <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-6">
                                <h4 class="font-bold text-indigo-900 text-lg mb-3">Data Extraction Results</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    ${result.data_extraction.company_size ? `
                                        <div class="bg-white p-3 rounded border">
                                            <p class="text-sm text-indigo-700 font-medium">Company Size</p>
                                            <p class="text-indigo-900">${result.data_extraction.company_size.employee_count || 'N/A'} employees</p>
                                            <p class="text-xs text-indigo-600">${result.data_extraction.company_size.size_category || ''}</p>
                                        </div>
                                    ` : ''}
                                    ${result.data_extraction.business_model ? `
                                        <div class="bg-white p-3 rounded border">
                                            <p class="text-sm text-indigo-700 font-medium">Business Model</p>
                                            <p class="text-indigo-900">${result.data_extraction.business_model.model_type || 'N/A'}</p>
                                            <p class="text-xs text-indigo-600">${result.data_extraction.business_model.confidence || ''}</p>
                                        </div>
                                    ` : ''}
                                    ${result.data_extraction.technology_stack ? `
                                        <div class="bg-white p-3 rounded border">
                                            <p class="text-sm text-indigo-700 font-medium">Technology Stack</p>
                                            <p class="text-indigo-900">${result.data_extraction.technology_stack.primary_tech || 'N/A'}</p>
                                            <p class="text-xs text-indigo-600">${result.data_extraction.technology_stack.platforms?.join(', ') || ''}</p>
                                        </div>
                                    ` : ''}
                                    ${result.data_extraction.financial_health ? `
                                        <div class="bg-white p-3 rounded border">
                                            <p class="text-sm text-indigo-700 font-medium">Financial Health</p>
                                            <p class="text-indigo-900">${result.data_extraction.financial_health.funding_status || 'N/A'}</p>
                                            <p class="text-xs text-indigo-600">${result.data_extraction.financial_health.revenue_range || ''}</p>
                                        </div>
                                    ` : ''}
                                    ${result.data_extraction.compliance ? `
                                        <div class="bg-white p-3 rounded border">
                                            <p class="text-sm text-indigo-700 font-medium">Compliance</p>
                                            <p class="text-indigo-900">${result.data_extraction.compliance.certifications?.length || 0} certifications</p>
                                            <p class="text-xs text-indigo-600">${result.data_extraction.compliance.regulatory_status || ''}</p>
                                        </div>
                                    ` : ''}
                                    ${result.data_extraction.market_presence ? `
                                        <div class="bg-white p-3 rounded border">
                                            <p class="text-sm text-indigo-700 font-medium">Market Presence</p>
                                            <p class="text-indigo-900">${result.data_extraction.market_presence.geographic_coverage || 'N/A'}</p>
                                            <p class="text-xs text-indigo-600">${result.data_extraction.market_presence.market_segments?.join(', ') || ''}</p>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        ` : ''}
                        
                        <!-- Geographic Information -->
                        ${result.geographic_region ? `
                            <div class="bg-purple-50 border border-purple-200 rounded-lg p-6">
                                <h4 class="font-bold text-purple-900 text-lg mb-3">Geographic Analysis</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <p class="text-sm text-purple-700 font-medium">Region</p>
                                        <p class="text-purple-900">${getRegionName(result.geographic_region)}</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-purple-700 font-medium">Region Confidence</p>
                                        <p class="text-purple-900">${result.region_confidence_score ? Math.round(result.region_confidence_score * 100) + '%' : 'N/A'}</p>
                                    </div>
                                </div>
                            </div>
                        ` : ''}
                        
                        <!-- Industry Code Classifications -->
                        ${classifications.length > 1 ? `
                            <div class="space-y-6">
                                <!-- NAICS Codes -->
                                ${naicsCodes.length > 0 ? `
                                    <div class="bg-green-50 border border-green-200 rounded-lg p-6">
                                        <h4 class="font-bold text-green-900 text-lg mb-3">NAICS Codes (Top ${naicsCodes.length})</h4>
                                        <div class="space-y-3">
                                            ${naicsCodes.map((classification, index) => `
                                                <div class="flex justify-between items-center p-3 bg-white rounded border">
                                                    <div class="flex items-center">
                                                        <span class="text-sm font-medium text-green-600 mr-2">#${index + 1}</span>
                                                        <div>
                                                            <div class="font-medium text-gray-900 text-base">${classification.description || classification.code_description || 'No description available'}</div>
                                                            <div class="text-sm text-gray-500">Code: ${classification.code || classification.industry_code || 'N/A'}</div>
                                                        </div>
                                                    </div>
                                                    <div class="text-right">
                                                        <span class="text-sm font-medium text-gray-900">${Math.round((classification.confidence || classification.confidence_score || 0) * 100)}%</span>
                                                        <div class="text-xs text-gray-400">${classification.classification_method || 'Enhanced'}</div>
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                                
                                <!-- MCC Codes -->
                                ${mccCodes.length > 0 ? `
                                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                                        <h4 class="font-bold text-blue-900 text-lg mb-3">MCC Codes (Top ${mccCodes.length})</h4>
                                        <div class="space-y-3">
                                            ${mccCodes.map((classification, index) => `
                                                <div class="flex justify-between items-center p-3 bg-white rounded border">
                                                    <div class="flex items-center">
                                                        <span class="text-sm font-medium text-blue-600 mr-2">#${index + 1}</span>
                                                        <div>
                                                            <div class="font-medium text-gray-900 text-base">${classification.description || classification.code_description || 'No description available'}</div>
                                                            <div class="text-sm text-gray-500">Code: ${classification.code || classification.industry_code || 'N/A'}</div>
                                                        </div>
                                                    </div>
                                                    <div class="text-right">
                                                        <span class="text-sm font-medium text-gray-900">${Math.round((classification.confidence || classification.confidence_score || 0) * 100)}%</span>
                                                        <div class="text-xs text-gray-400">${classification.classification_method || 'Enhanced'}</div>
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                                
                                <!-- SIC Codes -->
                                ${sicCodes.length > 0 ? `
                                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-6">
                                        <h4 class="font-bold text-purple-900 text-lg mb-3">SIC Codes (Top ${sicCodes.length})</h4>
                                        <div class="space-y-3">
                                            ${sicCodes.map((classification, index) => `
                                                <div class="flex justify-between items-center p-3 bg-white rounded border">
                                                    <div class="flex items-center">
                                                        <span class="text-sm font-medium text-purple-600 mr-2">#${index + 1}</span>
                                                        <div>
                                                            <div class="font-medium text-gray-900 text-base">${classification.description || classification.code_description || 'No description available'}</div>
                                                            <div class="text-sm text-gray-500">Code: ${classification.code || classification.industry_code || 'N/A'}</div>
                                                        </div>
                                                    </div>
                                                    <div class="text-right">
                                                        <span class="text-sm font-medium text-gray-900">${Math.round((classification.confidence || classification.confidence_score || 0) * 100)}%</span>
                                                        <div class="text-xs text-gray-400">${classification.classification_method || 'Enhanced'}</div>
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        ` : ''}
                        
                        <!-- Enhanced Metadata -->
                        ${result.enhanced_features ? `
                            <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-6">
                                <h4 class="font-bold text-indigo-900 text-lg mb-3">Enhanced Features</h4>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                    ${Object.entries(result.enhanced_features).map(([key, value]) => `
                                        <div class="text-center">
                                            <p class="text-sm text-indigo-700 font-medium">${key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</p>
                                            <span class="feature-badge ${value ? 'feature-active' : 'feature-beta'}">${value ? 'Active' : 'Beta'}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                        
                        <!-- Enhanced Reasoning Details Section -->
                        ${createReasoningDetailsSection(result)}
                        
                        <!-- Security Indicators -->
                        <div id="security-indicators"></div>
                    </div>
                `;
            } else {
                displayError('Business intelligence analysis failed. Please try again.');
            }
            
            // Update security indicators with result data
            updateSecurityIndicators(result);
        }

        // Create risk assessment HTML
        function createRiskAssessmentHTML(riskAssessment) {
            const riskLevel = riskAssessment.risk_level || 'low';
            const riskScore = riskAssessment.risk_score || 0;
            const riskFactors = riskAssessment.risk_factors || {};
            const detectedRisks = riskAssessment.detected_risks || [];
            const prohibitedKeywords = riskAssessment.prohibited_keywords_found || [];
            
            // Get risk level styling
            const riskLevelConfig = getRiskLevelConfig(riskLevel);
            
            return `
                <div class="bg-white border border-gray-200 rounded-lg p-6">
                    <h4 class="font-bold text-gray-900 text-lg mb-4 flex items-center">
                        <i class="fas ${riskLevelConfig.icon} ${riskLevelConfig.textColor} mr-2"></i>
                        Risk Assessment
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Risk Overview -->
                        <div class="space-y-4">
                            <div class="p-4 rounded-lg ${riskLevelConfig.bgColor} border ${riskLevelConfig.borderColor}">
                                <div class="flex items-center justify-between mb-2">
                                    <h5 class="text-lg font-semibold ${riskLevelConfig.textColor}">Risk Level</h5>
                                    <i class="fas ${riskLevelConfig.icon} ${riskLevelConfig.textColor} text-xl"></i>
                                </div>
                                <div class="text-2xl font-bold ${riskLevelConfig.textColor} mb-1">${riskLevelConfig.label}</div>
                                <div class="text-sm ${riskLevelConfig.textColor} opacity-80">Score: ${Math.round(riskScore * 100)}%</div>
                            </div>
                            
                            <!-- Risk Score Bar -->
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Risk Score</span>
                                    <span class="font-medium">${Math.round(riskScore * 100)}%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="h-2 rounded-full ${riskLevelConfig.barColor}" style="width: ${Math.min(riskScore * 100, 100)}%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Risk Details -->
                        <div class="space-y-4">
                            ${detectedRisks.length > 0 ? `
                                <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                                    <h5 class="font-semibold text-yellow-800 mb-2"> Detected Risks</h5>
                                    <ul class="text-sm text-yellow-700 space-y-1">
                                        ${detectedRisks.map(risk => `<li> ${formatRiskType(risk)}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                            
                            ${prohibitedKeywords.length > 0 ? `
                                <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
                                    <h5 class="font-semibold text-red-800 mb-2"> Prohibited Keywords</h5>
                                    <div class="text-sm text-red-700">
                                        ${prohibitedKeywords.map(keyword => `<span class="inline-block bg-red-100 text-red-800 px-2 py-1 rounded text-xs mr-1 mb-1">${keyword}</span>`).join('')}
                                    </div>
                                </div>
                            ` : ''}
                            
                            ${Object.keys(riskFactors).length > 0 ? `
                                <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                                    <h5 class="font-semibold text-blue-800 mb-2"> Risk Factors</h5>
                                    <div class="text-sm text-blue-700 space-y-1">
                                        ${Object.entries(riskFactors).map(([key, value]) => 
                                            `<div><span class="font-medium">${formatRiskFactor(key)}:</span> ${value}</div>`
                                        ).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        // Get risk level configuration
        function getRiskLevelConfig(riskLevel) {
            switch (riskLevel) {
                case 'critical':
                    return {
                        label: 'CRITICAL',
                        bgColor: 'bg-red-50',
                        borderColor: 'border-red-200',
                        textColor: 'text-red-800',
                        barColor: 'bg-red-500',
                        icon: 'fa-exclamation-triangle'
                    };
                case 'high':
                    return {
                        label: 'HIGH',
                        bgColor: 'bg-orange-50',
                        borderColor: 'border-orange-200',
                        textColor: 'text-orange-800',
                        barColor: 'bg-orange-500',
                        icon: 'fa-exclamation-circle'
                    };
                case 'medium':
                    return {
                        label: 'MEDIUM',
                        bgColor: 'bg-yellow-50',
                        borderColor: 'border-yellow-200',
                        textColor: 'text-yellow-800',
                        barColor: 'bg-yellow-500',
                        icon: 'fa-exclamation-triangle'
                    };
                default:
                    return {
                        label: 'LOW',
                        bgColor: 'bg-green-50',
                        borderColor: 'border-green-200',
                        textColor: 'text-green-800',
                        barColor: 'bg-green-500',
                        icon: 'fa-shield-check'
                    };
            }
        }

        // Format risk type
        function formatRiskType(riskType) {
            return riskType.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }

        // Format risk factor
        function formatRiskFactor(factor) {
            return factor.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }

        // Display error message
        function displayError(message) {
            resultsSection.classList.remove('hidden');
            resultsContent.innerHTML = `
                <div class="bg-red-50 border border-red-200 rounded-lg p-6">
                    <h4 class="font-bold text-red-900 text-lg mb-2">Error</h4>
                    <p class="text-red-700">${message}</p>
                </div>
            `;
        }

        // Helper function to get region name
        function getRegionName(regionCode) {
            const regions = {
                'us': 'United States',
                'ca': 'Canada',
                'uk': 'United Kingdom',
                'au': 'Australia',
                'de': 'Germany',
                'fr': 'France',
                'jp': 'Japan',
                'cn': 'China',
                'in': 'India',
                'br': 'Brazil'
            };
            return regions[regionCode] || regionCode.toUpperCase();
        }

        // Initialize Security Indicators Component
        let securityIndicators = null;
        
        function initializeSecurityIndicators() {
            // Create SecurityIndicators class if it doesn't exist
            if (typeof SecurityIndicators === 'undefined') {
                window.SecurityIndicators = class SecurityIndicators {
                    constructor(options) {
                        this.containerId = options.containerId;
                        this.showDetailed = options.showDetailed || false;
                        this.showTooltips = options.showTooltips || false;
                        this.theme = options.theme || 'default';
                    }
                    
                    init() {
                        // Initialize security indicators
                    }
                    
                    update(securityData) {
                        const container = document.getElementById(this.containerId);
                        if (!container) return;
                        
                        const trustRate = Math.round((securityData.data_source_trust?.trust_rate || 1.0) * 100);
                        const verificationRate = Math.round((securityData.website_verification?.success_rate || 1.0) * 100);
                        const violations = securityData.security_validation?.total_violations || 0;
                        const quality = Math.round((securityData.quality_metrics?.overall_quality || 0.95) * 100);
                        
                        container.innerHTML = `
                            <div class="security-indicators">
                                <h3><i class="fas fa-shield-alt"></i> Security & Trust Status</h3>
                                <div class="security-grid">
                                    <div class="security-card trust">
                                        <div class="security-icon">
                                            <i class="fas fa-check-circle"></i>
                                        </div>
                                        <div class="security-content">
                                            <div class="security-title">Data Source Trust</div>
                                            <div class="security-value">${trustRate}%</div>
                                            <div class="security-description">Trusted sources only</div>
                                        </div>
                                    </div>
                                    <div class="security-card verification">
                                        <div class="security-icon">
                                            <i class="fas fa-globe"></i>
                                        </div>
                                        <div class="security-content">
                                            <div class="security-title">Website Verification</div>
                                            <div class="security-value">${verificationRate}%</div>
                                            <div class="security-description">Verified websites</div>
                                        </div>
                                    </div>
                                    <div class="security-card violations">
                                        <div class="security-icon">
                                            <i class="fas fa-exclamation-triangle"></i>
                                        </div>
                                        <div class="security-content">
                                            <div class="security-title">Security Violations</div>
                                            <div class="security-value">${violations}</div>
                                            <div class="security-description">No violations detected</div>
                                        </div>
                                    </div>
                                    <div class="security-card quality">
                                        <div class="security-icon">
                                            <i class="fas fa-star"></i>
                                        </div>
                                        <div class="security-content">
                                            <div class="security-title">Data Quality</div>
                                            <div class="security-value">${quality}%</div>
                                            <div class="security-description">High quality data</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                };
            }
            
            if (typeof SecurityIndicators !== 'undefined') {
                securityIndicators = new SecurityIndicators({
                    containerId: 'security-indicators',
                    showDetailed: true,
                    showTooltips: true,
                    theme: 'default'
                });
                securityIndicators.init();
            }
        }

        // Update security indicators with result data
        function updateSecurityIndicators(result) {
            if (securityIndicators && result) {
                // Extract security data from result
                const securityData = {
                    data_source_trust: result.security_metrics?.data_source_trust || {
                        trust_rate: 1.0,
                        trusted_count: 1,
                        total_validations: 1
                    },
                    website_verification: result.security_metrics?.website_verification || {
                        success_rate: 1.0,
                        success_count: 1,
                        total_attempts: 1
                    },
                    quality_metrics: result.quality_metrics || {
                        overall_quality: 0.95,
                        evidence_strength: 0.9,
                        data_completeness: 0.85
                    },
                    security_validation: result.security_metrics?.security_violations || {
                        total_violations: 0,
                        violations_by_type: {}
                    },
                    security_metrics: result.security_metrics
                };
                
                securityIndicators.update(securityData);
            }
        }
    </script>
    
    <!-- Security Indicators Component -->
    <script src="components/security-indicators.js"></script>
    <script>
        // Initialize security indicators when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeSecurityIndicators();
        });
    </script>
</body>
</html>
