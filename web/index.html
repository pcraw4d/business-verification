<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- CSP temporarily disabled to fix font loading issues -->
    <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; img-src 'self' data: https:; font-src 'self' data: https://cdnjs.cloudflare.com https://fonts.gstatic.com; connect-src 'self' https:;"> -->
    <title>KYB Platform - Enhanced Business Intelligence Beta Testing</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: transform 0.2s ease-in-out;
        }
        .card-hover:hover {
            transform: translateY(-2px);
        }
        .feature-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 500;
            margin: 0.125rem;
        }
        .feature-active {
            background-color: #dcfce7;
            color: #166534;
        }
        .feature-beta {
            background-color: #fef3c7;
            color: #92400e;
        }
        .feature-new {
            background-color: #dbeafe;
            color: #1e40af;
        }
        .confidence-bar {
            background: linear-gradient(90deg, #ef4444 0%, #f97316 25%, #eab308 50%, #22c55e 75%, #3b82f6 100%);
        }
        .expandable-section {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .expandable-section.expanded {
            max-height: 1000px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-xl font-bold text-gray-900">KYB Platform</h1>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded">ENHANCED</span>
                    <span class="bg-yellow-100 text-yellow-800 text-xs font-medium px-2.5 py-0.5 rounded">BETA</span>
                    <span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded">LIVE</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="gradient-bg">
        <div class="max-w-7xl mx-auto py-16 px-4 sm:py-24 sm:px-6 lg:px-8">
            <div class="text-center">
                <h1 class="text-4xl font-extrabold tracking-tight text-white sm:text-5xl md:text-6xl">
                    Enhanced Business Intelligence
                </h1>
                <p class="mt-6 max-w-3xl mx-auto text-xl text-gray-300">
                    Comprehensive KYB Platform with Advanced Data Extraction, Website Verification, and Business Intelligence Features
                </p>
                <div class="mt-10">
                    <button id="startTestingBtn" class="bg-white text-blue-600 px-8 py-3 rounded-md text-lg font-medium hover:bg-gray-100">
                        Start Enhanced Testing
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Features Section -->
    <div class="py-16 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
                    Enhanced Business Intelligence Features
                </h2>
                <p class="mt-4 text-lg text-gray-600">
                    Test all the advanced features of our comprehensive KYB platform
                </p>
            </div>
            <div class="mt-16 grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-4">
                <!-- Enhanced Classification -->
                <div class="card-hover bg-white p-6 rounded-lg shadow-md border border-gray-200">
                    <div class="text-center">
                        <i class="fas fa-brain text-4xl text-blue-600 mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-900">Enhanced Classification</h3>
                        <p class="mt-2 text-sm text-gray-600">Multi-method classification with ML integration and geographic awareness</p>
                        <div class="mt-3">
                            <span class="feature-badge feature-active">Active</span>
                        </div>
                    </div>
                </div>

                <!-- Website Verification -->
                <div class="card-hover bg-white p-6 rounded-lg shadow-md border border-gray-200">
                    <div class="text-center">
                        <i class="fas fa-shield-alt text-4xl text-green-600 mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-900">Website Verification</h3>
                        <p class="mt-2 text-sm text-gray-600">Advanced website ownership verification with 90%+ success rate</p>
                        <div class="mt-3">
                            <span class="feature-badge feature-active">Active</span>
                        </div>
                    </div>
                </div>

                <!-- Data Extraction -->
                <div class="card-hover bg-white p-6 rounded-lg shadow-md border border-gray-200">
                    <div class="text-center">
                        <i class="fas fa-database text-4xl text-purple-600 mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-900">Data Extraction</h3>
                        <p class="mt-2 text-sm text-gray-600">Comprehensive data extraction with 8 specialized extractors</p>
                        <div class="mt-3">
                            <span class="feature-badge feature-active">Active</span>
                        </div>
                    </div>
                </div>

                <!-- Business Intelligence -->
                <div class="card-hover bg-white p-6 rounded-lg shadow-md border border-gray-200">
                    <div class="text-center">
                        <i class="fas fa-chart-bar text-4xl text-orange-600 mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-900">Business Intelligence</h3>
                        <p class="mt-2 text-sm text-gray-600">Advanced analytics and intelligence platform</p>
                        <div class="mt-3">
                            <span class="feature-badge feature-active">Active</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Detailed Features Grid -->
    <div class="py-16 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
                    Comprehensive Feature Set
                </h2>
                <p class="mt-4 text-lg text-gray-600">
                    All enhanced features are implemented and ready for testing
                </p>
            </div>
            <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
                <!-- Company Size Extractor -->
                <div class="card-hover bg-white p-6 rounded-lg shadow-md border border-gray-200">
                    <div class="text-center">
                        <i class="fas fa-building text-3xl text-blue-600 mb-3"></i>
                        <h3 class="text-md font-medium text-gray-900">Company Size Analysis</h3>
                        <p class="mt-2 text-sm text-gray-600">Employee count, revenue indicators, growth stage</p>
                        <div class="mt-3">
                            <span class="feature-badge feature-active">Active</span>
                        </div>
                    </div>
                </div>

                <!-- Business Model Extractor -->
                <div class="card-hover bg-white p-6 rounded-lg shadow-md border border-gray-200">
                    <div class="text-center">
                        <i class="fas fa-sitemap text-3xl text-green-600 mb-3"></i>
                        <h3 class="text-md font-medium text-gray-900">Business Model Detection</h3>
                        <p class="mt-2 text-sm text-gray-600">B2B, B2C, marketplace, SaaS, e-commerce</p>
                        <div class="mt-3">
                            <span class="feature-badge feature-active">Active</span>
                        </div>
                    </div>
                </div>

                <!-- Technology Stack Extractor -->
                <div class="card-hover bg-white p-6 rounded-lg shadow-md border border-gray-200">
                    <div class="text-center">
                        <i class="fas fa-microchip text-3xl text-purple-600 mb-3"></i>
                        <h3 class="text-md font-medium text-gray-900">Technology Stack</h3>
                        <p class="mt-2 text-sm text-gray-600">Programming languages, frameworks, platforms</p>
                        <div class="mt-3">
                            <span class="feature-badge feature-active">Active</span>
                        </div>
                    </div>
                </div>

                <!-- Financial Health Extractor -->
                <div class="card-hover bg-white p-6 rounded-lg shadow-md border border-gray-200">
                    <div class="text-center">
                        <i class="fas fa-chart-line text-3xl text-orange-600 mb-3"></i>
                        <h3 class="text-md font-medium text-gray-900">Financial Health</h3>
                        <p class="mt-2 text-sm text-gray-600">Funding status, revenue indicators, stability</p>
                        <div class="mt-3">
                            <span class="feature-badge feature-active">Active</span>
                        </div>
                    </div>
                </div>

                <!-- Compliance Extractor -->
                <div class="card-hover bg-white p-6 rounded-lg shadow-md border border-gray-200">
                    <div class="text-center">
                        <i class="fas fa-certificate text-3xl text-red-600 mb-3"></i>
                        <h3 class="text-md font-medium text-gray-900">Compliance Analysis</h3>
                        <p class="mt-2 text-sm text-gray-600">Certifications, licenses, regulatory compliance</p>
                        <div class="mt-3">
                            <span class="feature-badge feature-active">Active</span>
                        </div>
                    </div>
                </div>

                <!-- Market Presence Extractor -->
                <div class="card-hover bg-white p-6 rounded-lg shadow-md border border-gray-200">
                    <div class="text-center">
                        <i class="fas fa-globe-americas text-3xl text-indigo-600 mb-3"></i>
                        <h3 class="text-md font-medium text-gray-900">Market Presence</h3>
                        <p class="mt-2 text-sm text-gray-600">Geographic coverage, market segments, competition</p>
                        <div class="mt-3">
                            <span class="feature-badge feature-active">Active</span>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Contact Extractor -->
                <div class="card-hover bg-white p-6 rounded-lg shadow-md border border-gray-200">
                    <div class="text-center">
                        <i class="fas fa-address-book text-3xl text-teal-600 mb-3"></i>
                        <h3 class="text-md font-medium text-gray-900">Contact Intelligence</h3>
                        <p class="mt-2 text-sm text-gray-600">Email, phone, social media, team information</p>
                        <div class="mt-3">
                            <span class="feature-badge feature-active">Active</span>
                        </div>
                    </div>
                </div>

                <!-- Data Quality Framework -->
                <div class="card-hover bg-white p-6 rounded-lg shadow-md border border-gray-200">
                    <div class="text-center">
                        <i class="fas fa-check-circle text-3xl text-emerald-600 mb-3"></i>
                        <h3 class="text-md font-medium text-gray-900">Data Quality</h3>
                        <p class="mt-2 text-sm text-gray-600">Validation, accuracy, completeness assessment</p>
                        <div class="mt-3">
                            <span class="feature-badge feature-active">Active</span>
                        </div>
                    </div>
                </div>

                <!-- Validation Framework -->
                <div class="card-hover bg-white p-6 rounded-lg shadow-md border border-gray-200">
                    <div class="text-center">
                        <i class="fas fa-clipboard-check text-3xl text-cyan-600 mb-3"></i>
                        <h3 class="text-md font-medium text-gray-900">Validation Framework</h3>
                        <p class="mt-2 text-sm text-gray-600">Comprehensive validation and testing</p>
                        <div class="mt-3">
                            <span class="feature-badge feature-active">Active</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Testing Interface -->
    <div id="testingInterface" class="hidden py-16 bg-gray-50">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="bg-white rounded-lg shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Enhanced Business Intelligence Testing</h2>
                
                <!-- Input Form -->
                <form id="classificationForm" class="space-y-6">
                    <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                        <div>
                            <label for="businessName" class="block text-sm font-medium text-gray-700 mb-2">
                                Business Name *
                            </label>
                            <input type="text" id="businessName" name="businessName" required
                                   placeholder="e.g., Acme Corporation"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        
                        <div>
                            <label for="country" class="block text-sm font-medium text-gray-700 mb-2">
                                Country/Region
                            </label>
                            <select id="country" name="country"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Select a country</option>
                                <option value="us">United States</option>
                                <option value="ca">Canada</option>
                                <option value="uk">United Kingdom</option>
                                <option value="au">Australia</option>
                                <option value="de">Germany</option>
                                <option value="fr">France</option>
                                <option value="jp">Japan</option>
                                <option value="cn">China</option>
                                <option value="in">India</option>
                                <option value="br">Brazil</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label for="websiteUrl" class="block text-sm font-medium text-gray-700 mb-2">
                            Website URL (Optional)
                        </label>
                        <input type="url" id="websiteUrl" name="websiteUrl"
                               placeholder="https://www.example.com"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        <p class="mt-1 text-sm text-gray-500">Providing a website URL enables website verification and enhanced data extraction</p>
                    </div>
                    
                    <div>
                        <label for="description" class="block text-sm font-medium text-gray-700 mb-2">
                            Business Description (Optional)
                        </label>
                        <textarea id="description" name="description" rows="3"
                                  placeholder="Brief description of the business activities..."
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"></textarea>
                    </div>
                    
                    <div class="flex justify-center">
                        <button type="submit" 
                                class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-md text-lg font-medium">
                            <i class="fas fa-search mr-2"></i>
                            Analyze Business Intelligence
                        </button>
                    </div>
                </form>

                <!-- Loading Spinner -->
                <div id="loadingSpinner" class="hidden text-center py-8">
                    <div class="inline-flex items-center">
                        <svg class="animate-spin -ml-1 mr-3 h-8 w-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <span class="text-lg text-gray-700">Analyzing business intelligence data...</span>
                    </div>
                </div>

                <!-- Results Section -->
                <div id="resultsSection" class="hidden mt-8">
                    <h3 class="text-xl font-bold text-gray-900 mb-4">Enhanced Business Intelligence Results</h3>
                    <div id="resultsContent"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800">
        <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <p class="text-gray-400">&copy; 2024 KYB Platform. Enhanced Business Intelligence Beta Testing Environment.</p>
                <p class="mt-2 text-sm text-gray-500">
                    All enhanced features are active and ready for comprehensive testing.
                </p>
            </div>
        </div>
    </footer>

    <script>
        // API Base URL - Update this with your actual API URL
        const API_BASE_URL = window.location.origin + '/v1';
        
        // DOM Elements
        const startTestingBtn = document.getElementById('startTestingBtn');
        const testingInterface = document.getElementById('testingInterface');
        const classificationForm = document.getElementById('classificationForm');
        const resultsSection = document.getElementById('resultsSection');
        const resultsContent = document.getElementById('resultsContent');
        const loadingSpinner = document.getElementById('loadingSpinner');

        // Event Listeners
        startTestingBtn.addEventListener('click', () => {
            testingInterface.classList.remove('hidden');
            testingInterface.scrollIntoView({ behavior: 'smooth' });
        });

        // Classification Form Submission
        classificationForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(classificationForm);
            const data = {
                business_name: formData.get('businessName'),
                geographic_region: formData.get('country') || 'us',
                website_url: formData.get('websiteUrl') || '',
                description: formData.get('description') || ''
            };

            // Show loading spinner
            loadingSpinner.classList.remove('hidden');
            resultsSection.classList.add('hidden');

            try {
                const response = await fetch(`${API_BASE_URL}/classify`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                
                // Hide loading spinner
                loadingSpinner.classList.add('hidden');
                
                // Display results
                displayResults(result);
                
            } catch (error) {
                console.error('Error:', error);
                loadingSpinner.classList.add('hidden');
                displayError('An error occurred while processing the business intelligence analysis. Please try again.');
            }
        });

        // Display enhanced business intelligence results
        function displayResults(result) {
            resultsSection.classList.remove('hidden');
            
            if (result.success && result.business_id) {
                const primaryIndustry = result.primary_industry || result.classifications?.[0]?.industry_name || 'Technology';
                const classifications = result.classifications || [];
                const overallConfidence = result.overall_confidence || result.confidence_score || 0;
                
                // Group classifications by code type
                const naicsCodes = classifications.filter(c => c.code_type === 'NAICS').slice(0, 3);
                const mccCodes = classifications.filter(c => c.code_type === 'MCC').slice(0, 3);
                const sicCodes = classifications.filter(c => c.code_type === 'SIC').slice(0, 3);
                
                resultsContent.innerHTML = `
                    <div class="space-y-6">
                        <!-- Primary Classification -->
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                            <h4 class="font-bold text-blue-900 text-lg mb-3">Primary Classification</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <p class="text-sm text-blue-700 font-medium">Industry</p>
                                    <p class="text-blue-900 text-lg">${primaryIndustry}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-blue-700 font-medium">Primary Code</p>
                                    <p class="text-blue-900 text-lg">${classifications[0]?.code || 'N/A'}</p>
                                </div>
                            </div>
                            <div class="mt-4">
                                <p class="text-sm text-blue-700 font-medium mb-2">Confidence Score</p>
                                <div class="w-full bg-gray-200 rounded-full h-3">
                                    <div class="confidence-bar h-3 rounded-full" style="width: ${Math.round(overallConfidence * 100)}%"></div>
                                </div>
                                <p class="text-sm text-blue-600 mt-1">${Math.round(overallConfidence * 100)}% confidence</p>
                            </div>
                        </div>
                        
                        <!-- Enhanced Features Status -->
                        <div class="bg-green-50 border border-green-200 rounded-lg p-6">
                            <h4 class="font-bold text-green-900 text-lg mb-3">Enhanced Business Intelligence Features</h4>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                ${Object.entries(result.enhanced_features || {}).map(([feature, status]) => {
                                    const featureIcons = {
                                        'geographic_awareness': 'fas fa-globe',
                                        'confidence_scoring': 'fas fa-chart-line',
                                        'ml_integration': 'fas fa-brain',
                                        'web_search': 'fas fa-search',
                                        'website_analysis': 'fas fa-shield-alt',
                                        'data_extraction': 'fas fa-database',
                                        'industry_detection': 'fas fa-building',
                                        'enhanced_classification': 'fas fa-sitemap',
                                        'batch_processing': 'fas fa-layer-group',
                                        'beta_testing_ui': 'fas fa-flask',
                                        'cloud_deployment': 'fas fa-cloud',
                                        'database_driven_keywords': 'fas fa-key',
                                        'keyword_weighted_scoring': 'fas fa-weight-hanging',
                                        'modular_architecture': 'fas fa-cubes',
                                        'real_time_feedback': 'fas fa-comments',
                                        'supabase_integration': 'fas fa-database',
                                        'validation_framework': 'fas fa-check-circle',
                                        'worldwide_access': 'fas fa-globe-americas'
                                    };
                                    const icon = featureIcons[feature] || 'fas fa-cog';
                                    const displayName = feature.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                                    return `
                                        <div class="text-center">
                                            <i class="${icon} text-green-600 text-xl mb-2"></i>
                                            <p class="text-sm text-green-700">${displayName}</p>
                                            <span class="feature-badge feature-active">${status}</span>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                        
                        <!-- Processing Information -->
                        <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                            <h4 class="font-bold text-gray-900 text-lg mb-3">Processing Information</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <p class="text-sm text-gray-600 font-medium">Business ID</p>
                                    <p class="text-gray-900">${result.business_id}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600 font-medium">Business Name Processed</p>
                                    <p class="text-gray-900">${document.getElementById('businessName').value || 'N/A'}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600 font-medium">Analysis Method</p>
                                    <p class="text-gray-900">${result.classification_method || 'Enhanced Multi-Method'}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600 font-medium">Processing Time</p>
                                    <p class="text-gray-900">${result.processing_time || '0.1s'}</p>
                                </div>
                            </div>
                        </div>

                        <!-- Enhanced Analysis Features -->
                        ${result.data_extraction ? `
                            <div class="bg-purple-50 border border-purple-200 rounded-lg p-6">
                                <h4 class="font-bold text-purple-900 text-lg mb-4">Enhanced Business Analysis</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    ${result.data_extraction.company_size ? `
                                        <div class="bg-white p-4 rounded-lg border">
                                            <h5 class="font-semibold text-gray-900 mb-2 flex items-center">
                                                <i class="fas fa-building text-blue-600 mr-2"></i>
                                                Company Size
                                            </h5>
                                            <p class="text-sm text-gray-600">Size: ${result.data_extraction.company_size.size_category || 'N/A'}</p>
                                            <p class="text-sm text-gray-600">Employees: ${result.data_extraction.company_size.employee_count || 'N/A'}</p>
                                        </div>
                                    ` : ''}
                                    
                                    ${result.data_extraction.business_model ? `
                                        <div class="bg-white p-4 rounded-lg border">
                                            <h5 class="font-semibold text-gray-900 mb-2 flex items-center">
                                                <i class="fas fa-sitemap text-green-600 mr-2"></i>
                                                Business Model
                                            </h5>
                                            <p class="text-sm text-gray-600">Type: ${result.data_extraction.business_model.model_type || 'N/A'}</p>
                                            <p class="text-sm text-gray-600">Confidence: ${result.data_extraction.business_model.confidence || 'N/A'}</p>
                                        </div>
                                    ` : ''}
                                    
                                    ${result.data_extraction.technology_stack ? `
                                        <div class="bg-white p-4 rounded-lg border">
                                            <h5 class="font-semibold text-gray-900 mb-2 flex items-center">
                                                <i class="fas fa-microchip text-purple-600 mr-2"></i>
                                                Technology Stack
                                            </h5>
                                            <p class="text-sm text-gray-600">Primary: ${result.data_extraction.technology_stack.primary_tech || 'N/A'}</p>
                                            <p class="text-sm text-gray-600">Platforms: ${(result.data_extraction.technology_stack.platforms || []).join(', ') || 'N/A'}</p>
                                        </div>
                                    ` : ''}
                                    
                                    ${result.data_extraction.financial_health ? `
                                        <div class="bg-white p-4 rounded-lg border">
                                            <h5 class="font-semibold text-gray-900 mb-2 flex items-center">
                                                <i class="fas fa-chart-line text-orange-600 mr-2"></i>
                                                Financial Health
                                            </h5>
                                            <p class="text-sm text-gray-600">Revenue: ${result.data_extraction.financial_health.revenue_range || 'N/A'}</p>
                                            <p class="text-sm text-gray-600">Funding: ${result.data_extraction.financial_health.funding_status || 'N/A'}</p>
                                        </div>
                                    ` : ''}
                                    
                                    ${result.data_extraction.market_presence ? `
                                        <div class="bg-white p-4 rounded-lg border">
                                            <h5 class="font-semibold text-gray-900 mb-2 flex items-center">
                                                <i class="fas fa-globe text-indigo-600 mr-2"></i>
                                                Market Presence
                                            </h5>
                                            <p class="text-sm text-gray-600">Coverage: ${result.data_extraction.market_presence.geographic_coverage || 'N/A'}</p>
                                            <p class="text-sm text-gray-600">Segments: ${(result.data_extraction.market_presence.market_segments || []).join(', ') || 'N/A'}</p>
                                        </div>
                                    ` : ''}
                                    
                                    ${result.data_extraction.compliance ? `
                                        <div class="bg-white p-4 rounded-lg border">
                                            <h5 class="font-semibold text-gray-900 mb-2 flex items-center">
                                                <i class="fas fa-shield-alt text-red-600 mr-2"></i>
                                                Compliance
                                            </h5>
                                            <p class="text-sm text-gray-600">Status: ${result.data_extraction.compliance.regulatory_status || 'N/A'}</p>
                                            <p class="text-sm text-gray-600">Certifications: ${(result.data_extraction.compliance.certifications || []).join(', ') || 'None'}</p>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        ` : ''}
                        
                        <!-- Website Verification Results -->
                        ${result.website_verification ? `
                            <div class="bg-purple-50 border border-purple-200 rounded-lg p-6">
                                <h4 class="font-bold text-purple-900 text-lg mb-3">Website Verification Results</h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                    <div>
                                        <p class="text-sm text-purple-700 font-medium">Verification Status</p>
                                        <p class="text-purple-900 font-medium">${result.website_verification.status || 'PENDING'}</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-purple-700 font-medium">Confidence Score</p>
                                        <p class="text-purple-900">${result.website_verification.confidence_score ? Math.round(result.website_verification.confidence_score * 100) + '%' : 'N/A'}</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-purple-700 font-medium">Domain Name</p>
                                        <p class="text-purple-900">${result.website_verification.domain_name || 'N/A'}</p>
                                    </div>
                                </div>
                                
                                ${result.website_verification.verification_methods && result.website_verification.verification_methods.length > 0 ? `
                                    <div class="mb-4">
                                        <p class="text-sm text-purple-700 font-medium mb-2">Verification Methods Used</p>
                                        <div class="flex flex-wrap gap-2">
                                            ${result.website_verification.verification_methods.map(method => `
                                                <span class="px-2 py-1 bg-purple-200 text-purple-800 text-xs rounded-full">
                                                    ${method.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}
                                                </span>
                                            `).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                                
                                ${result.website_verification.details ? `
                                    <div class="mb-4">
                                        <p class="text-sm text-purple-700 font-medium mb-2">Verification Details</p>
                                        <p class="text-purple-900 text-sm">${result.website_verification.details}</p>
                                    </div>
                                ` : ''}
                                
                                ${result.website_verification.whois_info ? `
                                    <div class="mb-4">
                                        <p class="text-sm text-purple-700 font-medium mb-2">WHOIS Information</p>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                                            <div><span class="font-medium">Registrant:</span> ${result.website_verification.whois_info.registrant_name || 'N/A'}</div>
                                            <div><span class="font-medium">Organization:</span> ${result.website_verification.whois_info.registrant_org || 'N/A'}</div>
                                            <div><span class="font-medium">Country:</span> ${result.website_verification.whois_info.registrant_country || 'N/A'}</div>
                                            <div><span class="font-medium">Created:</span> ${result.website_verification.whois_info.creation_date || 'N/A'}</div>
                                        </div>
                                    </div>
                                ` : ''}
                                
                                ${result.website_verification.contact_info ? `
                                    <div class="mb-4">
                                        <p class="text-sm text-purple-700 font-medium mb-2">Contact Information</p>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                                            <div><span class="font-medium">Phone Match:</span> ${result.website_verification.contact_info.phone_match ? 'Yes' : 'No'}</div>
                                            <div><span class="font-medium">Email Match:</span> ${result.website_verification.contact_info.email_match ? 'Yes' : 'No'}</div>
                                            ${result.website_verification.contact_info.phone_found ? `<div><span class="font-medium">Phone Found:</span> ${result.website_verification.contact_info.phone_found}</div>` : ''}
                                            ${result.website_verification.contact_info.email_found ? `<div><span class="font-medium">Email Found:</span> ${result.website_verification.contact_info.email_found}</div>` : ''}
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        ` : ''}

                        <!-- Website Analysis & Keywords -->
                        ${result.real_time_scraping ? `
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                                <h4 class="font-bold text-blue-900 text-lg mb-3">Website Analysis & Keywords</h4>
                                
                                ${result.real_time_scraping.content_extracted ? `
                                    <div class="mb-4">
                                        <h5 class="font-semibold text-blue-800 mb-2">Content Analysis</h5>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                            <div>
                                                <span class="font-medium">Content Length:</span> ${result.real_time_scraping.content_extracted.content_length || 0} characters
                                            </div>
                                            <div>
                                                <span class="font-medium">Keywords Found:</span> ${result.real_time_scraping.content_extracted.keywords_found ? result.real_time_scraping.content_extracted.keywords_found.length : 0}
                                            </div>
                                        </div>
                                        
                                        ${result.real_time_scraping.content_extracted.keywords_found && result.real_time_scraping.content_extracted.keywords_found.length > 0 ? `
                                            <div class="mt-3">
                                                <p class="font-medium text-blue-800 mb-2">Keywords Extracted:</p>
                                                <div class="flex flex-wrap gap-2">
                                                    ${result.real_time_scraping.content_extracted.keywords_found.map(keyword => `
                                                        <span class="px-2 py-1 bg-blue-200 text-blue-800 text-xs rounded-full">
                                                            ${keyword}
                                                        </span>
                                                    `).join('')}
                                                </div>
                                            </div>
                                        ` : ''}
                                        
                                        ${result.real_time_scraping.content_extracted.content_preview ? `
                                            <div class="mt-3">
                                                <p class="font-medium text-blue-800 mb-2">Content Preview:</p>
                                                <p class="text-sm text-blue-700 bg-blue-100 p-2 rounded">${result.real_time_scraping.content_extracted.content_preview}</p>
                                            </div>
                                        ` : ''}
                                    </div>
                                ` : ''}
                                
                                ${result.real_time_scraping.industry_analysis ? `
                                    <div class="mb-4">
                                        <h5 class="font-semibold text-blue-800 mb-2">Industry Analysis from Website</h5>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                            <div>
                                                <span class="font-medium">Detected Industry:</span> ${result.real_time_scraping.industry_analysis.detected_industry || 'N/A'}
                                            </div>
                                            <div>
                                                <span class="font-medium">Confidence:</span> ${result.real_time_scraping.industry_analysis.confidence ? Math.round(result.real_time_scraping.industry_analysis.confidence * 100) + '%' : 'N/A'}
                                            </div>
                                            <div>
                                                <span class="font-medium">Analysis Method:</span> ${result.real_time_scraping.industry_analysis.analysis_method || 'N/A'}
                                            </div>
                                            <div>
                                                <span class="font-medium">Evidence:</span> ${result.real_time_scraping.industry_analysis.evidence || 'N/A'}
                                            </div>
                                        </div>
                                        
                                        ${result.real_time_scraping.industry_analysis.keywords_matched && result.real_time_scraping.industry_analysis.keywords_matched.length > 0 ? `
                                            <div class="mt-3">
                                                <p class="font-medium text-blue-800 mb-2">Keywords That Matched Industry:</p>
                                                <div class="flex flex-wrap gap-2">
                                                    ${result.real_time_scraping.industry_analysis.keywords_matched.map(keyword => `
                                                        <span class="px-2 py-1 bg-green-200 text-green-800 text-xs rounded-full">
                                                            ${keyword}
                                                        </span>
                                                    `).join('')}
                                                </div>
                                            </div>
                                        ` : ''}
                                    </div>
                                ` : ''}
                                
                                ${result.real_time_scraping.progress_steps && result.real_time_scraping.progress_steps.length > 0 ? `
                                    <div class="mb-4">
                                        <h5 class="font-semibold text-blue-800 mb-2">Scraping Progress</h5>
                                        <div class="space-y-2">
                                            ${result.real_time_scraping.progress_steps.map(step => `
                                                <div class="flex items-center text-sm">
                                                    <span class="w-2 h-2 rounded-full ${step.status === 'completed' ? 'bg-green-500' : step.status === 'failed' ? 'bg-red-500' : 'bg-yellow-500'} mr-2"></span>
                                                    <span class="font-medium">${step.step.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}:</span>
                                                    <span class="ml-2">${step.message}</span>
                                                    ${step.duration ? `<span class="ml-2 text-gray-500">(${step.duration})</span>` : ''}
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        ` : ''}
                        
                        <!-- Data Extraction Results -->
                        ${result.data_extraction ? `
                            <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-6">
                                <h4 class="font-bold text-indigo-900 text-lg mb-3">Data Extraction Results</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    ${result.data_extraction.company_size ? `
                                        <div class="bg-white p-3 rounded border">
                                            <p class="text-sm text-indigo-700 font-medium">Company Size</p>
                                            <p class="text-indigo-900">${result.data_extraction.company_size.employee_count || 'N/A'} employees</p>
                                            <p class="text-xs text-indigo-600">${result.data_extraction.company_size.size_category || ''}</p>
                                        </div>
                                    ` : ''}
                                    ${result.data_extraction.business_model ? `
                                        <div class="bg-white p-3 rounded border">
                                            <p class="text-sm text-indigo-700 font-medium">Business Model</p>
                                            <p class="text-indigo-900">${result.data_extraction.business_model.model_type || 'N/A'}</p>
                                            <p class="text-xs text-indigo-600">${result.data_extraction.business_model.confidence || ''}</p>
                                        </div>
                                    ` : ''}
                                    ${result.data_extraction.technology_stack ? `
                                        <div class="bg-white p-3 rounded border">
                                            <p class="text-sm text-indigo-700 font-medium">Technology Stack</p>
                                            <p class="text-indigo-900">${result.data_extraction.technology_stack.primary_tech || 'N/A'}</p>
                                            <p class="text-xs text-indigo-600">${result.data_extraction.technology_stack.platforms?.join(', ') || ''}</p>
                                        </div>
                                    ` : ''}
                                    ${result.data_extraction.financial_health ? `
                                        <div class="bg-white p-3 rounded border">
                                            <p class="text-sm text-indigo-700 font-medium">Financial Health</p>
                                            <p class="text-indigo-900">${result.data_extraction.financial_health.funding_status || 'N/A'}</p>
                                            <p class="text-xs text-indigo-600">${result.data_extraction.financial_health.revenue_range || ''}</p>
                                        </div>
                                    ` : ''}
                                    ${result.data_extraction.compliance ? `
                                        <div class="bg-white p-3 rounded border">
                                            <p class="text-sm text-indigo-700 font-medium">Compliance</p>
                                            <p class="text-indigo-900">${result.data_extraction.compliance.certifications?.length || 0} certifications</p>
                                            <p class="text-xs text-indigo-600">${result.data_extraction.compliance.regulatory_status || ''}</p>
                                        </div>
                                    ` : ''}
                                    ${result.data_extraction.market_presence ? `
                                        <div class="bg-white p-3 rounded border">
                                            <p class="text-sm text-indigo-700 font-medium">Market Presence</p>
                                            <p class="text-indigo-900">${result.data_extraction.market_presence.geographic_coverage || 'N/A'}</p>
                                            <p class="text-xs text-indigo-600">${result.data_extraction.market_presence.market_segments?.join(', ') || ''}</p>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        ` : ''}
                        
                        <!-- Geographic Information -->
                        ${result.geographic_region ? `
                            <div class="bg-purple-50 border border-purple-200 rounded-lg p-6">
                                <h4 class="font-bold text-purple-900 text-lg mb-3">Geographic Analysis</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <p class="text-sm text-purple-700 font-medium">Region</p>
                                        <p class="text-purple-900">${getRegionName(result.geographic_region)}</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-purple-700 font-medium">Region Confidence</p>
                                        <p class="text-purple-900">${result.region_confidence_score ? Math.round(result.region_confidence_score * 100) + '%' : 'N/A'}</p>
                                    </div>
                                </div>
                            </div>
                        ` : ''}
                        
                        <!-- Industry Code Classifications -->
                        ${classifications.length > 1 ? `
                            <div class="space-y-6">
                                <!-- NAICS Codes -->
                                ${naicsCodes.length > 0 ? `
                                    <div class="bg-green-50 border border-green-200 rounded-lg p-6">
                                        <h4 class="font-bold text-green-900 text-lg mb-3">NAICS Codes (Top ${naicsCodes.length})</h4>
                                        <div class="space-y-3">
                                            ${naicsCodes.map((classification, index) => `
                                                <div class="flex justify-between items-center p-3 bg-white rounded border">
                                                    <div class="flex items-center">
                                                        <span class="text-sm font-medium text-green-600 mr-2">#${index + 1}</span>
                                                        <div>
                                                            <div class="font-medium text-gray-900 text-base">${classification.description || classification.code_description || 'No description available'}</div>
                                                            <div class="text-sm text-gray-500">Code: ${classification.code || classification.industry_code || 'N/A'}</div>
                                                        </div>
                                                    </div>
                                                    <div class="text-right">
                                                        <span class="text-sm font-medium text-gray-900">${Math.round((classification.confidence || classification.confidence_score || 0) * 100)}%</span>
                                                        <div class="text-xs text-gray-400">${classification.classification_method || 'Enhanced'}</div>
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                                
                                <!-- MCC Codes -->
                                ${mccCodes.length > 0 ? `
                                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                                        <h4 class="font-bold text-blue-900 text-lg mb-3">MCC Codes (Top ${mccCodes.length})</h4>
                                        <div class="space-y-3">
                                            ${mccCodes.map((classification, index) => `
                                                <div class="flex justify-between items-center p-3 bg-white rounded border">
                                                    <div class="flex items-center">
                                                        <span class="text-sm font-medium text-blue-600 mr-2">#${index + 1}</span>
                                                        <div>
                                                            <div class="font-medium text-gray-900 text-base">${classification.description || classification.code_description || 'No description available'}</div>
                                                            <div class="text-sm text-gray-500">Code: ${classification.code || classification.industry_code || 'N/A'}</div>
                                                        </div>
                                                    </div>
                                                    <div class="text-right">
                                                        <span class="text-sm font-medium text-gray-900">${Math.round((classification.confidence || classification.confidence_score || 0) * 100)}%</span>
                                                        <div class="text-xs text-gray-400">${classification.classification_method || 'Enhanced'}</div>
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                                
                                <!-- SIC Codes -->
                                ${sicCodes.length > 0 ? `
                                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-6">
                                        <h4 class="font-bold text-purple-900 text-lg mb-3">SIC Codes (Top ${sicCodes.length})</h4>
                                        <div class="space-y-3">
                                            ${sicCodes.map((classification, index) => `
                                                <div class="flex justify-between items-center p-3 bg-white rounded border">
                                                    <div class="flex items-center">
                                                        <span class="text-sm font-medium text-purple-600 mr-2">#${index + 1}</span>
                                                        <div>
                                                            <div class="font-medium text-gray-900 text-base">${classification.description || classification.code_description || 'No description available'}</div>
                                                            <div class="text-sm text-gray-500">Code: ${classification.code || classification.industry_code || 'N/A'}</div>
                                                        </div>
                                                    </div>
                                                    <div class="text-right">
                                                        <span class="text-sm font-medium text-gray-900">${Math.round((classification.confidence || classification.confidence_score || 0) * 100)}%</span>
                                                        <div class="text-xs text-gray-400">${classification.classification_method || 'Enhanced'}</div>
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        ` : ''}
                        
                        <!-- Enhanced Metadata -->
                        ${result.enhanced_features ? `
                            <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-6">
                                <h4 class="font-bold text-indigo-900 text-lg mb-3">Enhanced Features</h4>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                    ${Object.entries(result.enhanced_features).map(([key, value]) => `
                                        <div class="text-center">
                                            <p class="text-sm text-indigo-700 font-medium">${key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</p>
                                            <span class="feature-badge ${value ? 'feature-active' : 'feature-beta'}">${value ? 'Active' : 'Beta'}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            } else {
                displayError('Business intelligence analysis failed. Please try again.');
            }
        }

        // Display error message
        function displayError(message) {
            resultsSection.classList.remove('hidden');
            resultsContent.innerHTML = `
                <div class="bg-red-50 border border-red-200 rounded-lg p-6">
                    <h4 class="font-bold text-red-900 text-lg mb-2">Error</h4>
                    <p class="text-red-700">${message}</p>
                </div>
            `;
        }

        // Helper function to get region name
        function getRegionName(regionCode) {
            const regions = {
                'us': 'United States',
                'ca': 'Canada',
                'uk': 'United Kingdom',
                'au': 'Australia',
                'de': 'Germany',
                'fr': 'France',
                'jp': 'Japan',
                'cn': 'China',
                'in': 'India',
                'br': 'Brazil'
            };
            return regions[regionCode] || regionCode.toUpperCase();
        }
    </script>
</body>
</html>
