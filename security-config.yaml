# KYB Tool - Security Configuration
# Comprehensive security policies and scanning configuration

# Security Policy Configuration
security_policy:
  # Critical security requirements
  critical_requirements:
    - "No hardcoded secrets in code"
    - "All external dependencies must be scanned for vulnerabilities"
    - "All API endpoints must be authenticated and authorized"
    - "All user input must be validated and sanitized"
    - "All sensitive data must be encrypted at rest and in transit"
    - "All security vulnerabilities must be patched within 24 hours"
  
  # Security scanning thresholds
  thresholds:
    critical_vulnerabilities: 0
    high_vulnerabilities: 5
    medium_vulnerabilities: 20
    low_vulnerabilities: 50
  
  # Compliance frameworks
  compliance_frameworks:
    - "SOC 2 Type II"
    - "PCI DSS"
    - "GDPR"
    - "ISO 27001"

# Static Code Analysis Configuration
static_analysis:
  # Go security scanning with gosec
  gosec:
    enabled: true
    rules:
      - "G101"  # Look for hardcoded passwords
      - "G102"  # Bind to all interfaces
      - "G103"  # Audit the use of unsafe block
      - "G104"  # Audit errors not checked
      - "G105"  # Audit the use of math/big.Int.Exp
      - "G106"  # Audit the use of ssh.InsecureIgnoreHostKey
      - "G107"  # Url provided to HTTP request as taint input
      - "G108"  # Use of net/http serve function that has no support for setting timeouts
      - "G109"  # Converting strconv.Atoi result to int32/int16
      - "G110"  # Detect infinite loop in range over map or array
      - "G111"  # Detect http.Dir("/") as a potential risk
      - "G112"  # Detect ReadHeaderTimeout not being set
      - "G113"  # Usage of http.ListenAndServe instead of http.Server
      - "G114"  # Use of net/http serve function that has no support for setting timeouts
      - "G201"  # SQL query construction using format string
      - "G202"  # SQL query construction using string concatenation
      - "G203"  # Use of unescaped data in HTML templates
      - "G204"  # Audit use of command execution
      - "G301"  # Poor file permissions used when creating a directory
      - "G302"  # Poor file permissions used with chmod
      - "G303"  # Creating tempfile using a predictable path
      - "G304"  # File path provided as taint input
      - "G305"  # File path traversal when extracting zip/tar archive
      - "G306"  # Poor file permissions used when writing to a file
      - "G307"  # Poor file permissions used when creating a file with os.Create
      - "G401"  # Detect the usage of DES, RC4, MD5 or SHA1
      - "G402"  # Look for bad TLS connection settings
      - "G403"  # Ensure minimum RSA key length of 2048 bits
      - "G404"  # Insecure random number source (rand)
      - "G501"  # Import blacklist: crypto/md5
      - "G502"  # Import blacklist: crypto/des
      - "G503"  # Import blacklist: crypto/rc4
      - "G504"  # Import blacklist: net/http/cgi
      - "G505"  # Import blacklist: crypto/sha1
      - "G601"  # Implicit memory aliasing in for loop
    exclude:
      - "vendor/"
      - "test/"
      - "third-party/"
  
  # Dependency vulnerability scanning
  dependency_scanning:
    enabled: true
    tools:
      - "govulncheck"  # Go vulnerability checker
      - "trivy"        # Multi-language vulnerability scanner
      - "safety"       # Python dependency scanner
      - "npm audit"    # Node.js dependency scanner
    frequency: "daily"
    fail_on_critical: true
    fail_on_high: false

# Container Security Configuration
container_security:
  # Docker security scanning
  docker:
    enabled: true
    scan_images: true
    scan_dockerfiles: true
    scan_compose_files: true
    base_image_requirements:
      - "Use official base images only"
      - "Pin base image versions"
      - "Use minimal base images (alpine, distroless)"
    runtime_security:
      - "Run containers as non-root user"
      - "Disable unnecessary capabilities"
      - "Use read-only root filesystem"
      - "Set resource limits"
  
  # Kubernetes security
  kubernetes:
    enabled: true
    security_context:
      run_as_non_root: true
      read_only_root_filesystem: true
      allow_privilege_escalation: false
    network_policies:
      enabled: true
      default_deny: true
    pod_security_standards:
      level: "restricted"

# Infrastructure Security Configuration
infrastructure_security:
  # Terraform security
  terraform:
    enabled: true
    security_checks:
      - "No hardcoded secrets"
      - "Proper IAM permissions"
      - "Encryption at rest enabled"
      - "Network security groups configured"
      - "Logging and monitoring enabled"
  
  # Cloud security
  cloud_security:
    aws:
      security_requirements:
        - "Use IAM roles instead of access keys"
        - "Enable CloudTrail logging"
        - "Use VPC with private subnets"
        - "Enable encryption for all storage"
        - "Use security groups with minimal access"
    azure:
      security_requirements:
        - "Use managed identities"
        - "Enable Azure Monitor"
        - "Use virtual networks"
        - "Enable encryption for all storage"
        - "Use network security groups"

# API Security Configuration
api_security:
  # Authentication requirements
  authentication:
    required: true
    methods:
      - "JWT tokens"
      - "API keys"
      - "OAuth 2.0"
    token_requirements:
      - "Secure token generation"
      - "Token expiration"
      - "Token rotation"
      - "Secure token storage"
  
  # Authorization requirements
  authorization:
    required: true
    models:
      - "Role-based access control (RBAC)"
      - "Attribute-based access control (ABAC)"
    permission_requirements:
      - "Principle of least privilege"
      - "Regular permission reviews"
      - "Audit logging"
  
  # Input validation
  input_validation:
    required: true
    rules:
      - "Validate all user inputs"
      - "Sanitize data before processing"
      - "Use parameterized queries"
      - "Implement rate limiting"
      - "Validate file uploads"

# Data Security Configuration
data_security:
  # Encryption requirements
  encryption:
    at_rest:
      required: true
      algorithms:
        - "AES-256"
        - "ChaCha20-Poly1305"
    in_transit:
      required: true
      protocols:
        - "TLS 1.3"
        - "TLS 1.2"
      minimum_tls_version: "1.2"
  
  # Data classification
  classification:
    levels:
      - "public"
      - "internal"
      - "confidential"
      - "restricted"
    handling_requirements:
      public:
        encryption: false
        access_control: "minimal"
      internal:
        encryption: "in_transit"
        access_control: "authenticated"
      confidential:
        encryption: "at_rest_and_in_transit"
        access_control: "authorized"
      restricted:
        encryption: "at_rest_and_in_transit"
        access_control: "strict"
        audit_logging: true

# Monitoring and Alerting Configuration
security_monitoring:
  # Security event monitoring
  events:
    authentication_failures: true
    authorization_failures: true
    data_access_patterns: true
    configuration_changes: true
    vulnerability_detection: true
  
  # Alerting thresholds
  alerts:
    critical:
      - "Authentication bypass attempts"
      - "Unauthorized data access"
      - "Critical vulnerability detection"
      - "Configuration drift"
    high:
      - "Multiple failed login attempts"
      - "Unusual data access patterns"
      - "High severity vulnerability detection"
    medium:
      - "Failed authorization attempts"
      - "Medium severity vulnerability detection"
  
  # Incident response
  incident_response:
    automated_response: true
    escalation_procedures: true
    notification_channels:
      - "email"
      - "slack"
      - "pagerduty"
    response_time:
      critical: "15 minutes"
      high: "1 hour"
      medium: "4 hours"

# Compliance Configuration
compliance:
  # SOC 2 requirements
  soc2:
    enabled: true
    controls:
      - "Access Control"
      - "Change Management"
      - "Risk Assessment"
      - "Security Monitoring"
      - "Incident Response"
      - "Business Continuity"
  
  # PCI DSS requirements
  pci_dss:
    enabled: true
    requirements:
      - "Build and Maintain a Secure Network"
      - "Protect Cardholder Data"
      - "Maintain Vulnerability Management Program"
      - "Implement Strong Access Control Measures"
      - "Regularly Monitor and Test Networks"
      - "Maintain an Information Security Policy"
  
  # GDPR requirements
  gdpr:
    enabled: true
    requirements:
      - "Data Protection by Design and Default"
      - "Data Minimization"
      - "Purpose Limitation"
      - "Storage Limitation"
      - "Accuracy"
      - "Integrity and Confidentiality"
      - "Accountability"

# Security Testing Configuration
security_testing:
  # Automated security testing
  automated:
    enabled: true
    frequency: "daily"
    tools:
      - "OWASP ZAP"
      - "SonarQube"
      - "Snyk"
      - "Trivy"
  
  # Manual security testing
  manual:
    enabled: true
    frequency: "monthly"
    types:
      - "Penetration testing"
      - "Security code review"
      - "Architecture review"
      - "Threat modeling"
  
  # Bug bounty program
  bug_bounty:
    enabled: false
    scope: "public APIs"
    rewards:
      critical: "$5000"
      high: "$1000"
      medium: "$500"
      low: "$100"

# Security Training and Awareness
security_training:
  # Developer security training
  developers:
    required: true
    frequency: "quarterly"
    topics:
      - "Secure coding practices"
      - "OWASP Top 10"
      - "Authentication and authorization"
      - "Data protection"
      - "Incident response"
  
  # Security awareness training
  awareness:
    required: true
    frequency: "annually"
    topics:
      - "Phishing awareness"
      - "Password security"
      - "Social engineering"
      - "Data handling"
      - "Incident reporting"

# Security Metrics and KPIs
security_metrics:
  # Key performance indicators
  kpis:
    - "Mean time to detect (MTTD)"
    - "Mean time to respond (MTTR)"
    - "Vulnerability remediation time"
    - "Security incident frequency"
    - "Compliance score"
    - "Security training completion rate"
  
  # Reporting frequency
  reporting:
    daily: "Security incidents"
    weekly: "Vulnerability status"
    monthly: "Compliance status"
    quarterly: "Security program review"
