openapi: 3.0.3
info:
  title: Risk Assessment Service API
  description: |
    Comprehensive risk assessment and predictive analytics API for business verification.
    Provides real-time risk assessment, compliance screening, and predictive analytics
    with sub-1-second response times and 3-12 month forecasting capabilities.
    
    **Enhanced ML Capabilities:**
    - LSTM time-series prediction for 6-12 month forecasts
    - Smart ensemble routing (XGBoost for 1-3mo, LSTM for 6-12mo, combined for 3-6mo)
    - Multi-horizon predictions with temporal analysis
    - Advanced scenario analysis and model comparison
    - SHAP explainability for risk factor interpretation
    - Industry-specific risk models (9 sectors)
    - A/B testing framework for model validation
    - Premium external API integrations (Thomson Reuters, OFAC, World-Check)
    
    **Enterprise Features:**
    - Multi-tenant architecture with row-level security
    - SOC 2 compliance preparation
    - Global coverage for 10+ countries
    - Advanced monitoring and alerting
    - Batch processing capabilities
    - Webhook notifications
    - Custom risk models for enterprise customers
  version: 2.0.0
  contact:
    name: KYB Platform API Support
    email: api-support@kyb-platform.com
    url: https://docs.kyb-platform.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  termsOfService: https://kyb-platform.com/terms

servers:
  - url: https://risk-assessment-service-production.up.railway.app/api/v1
    description: Production server
  - url: https://risk-assessment-service-staging.up.railway.app/api/v1
    description: Staging server
  - url: http://localhost:8080/api/v1
    description: Local development server

paths:
  /assess:
    post:
      summary: Perform risk assessment
      description: |
        Performs comprehensive risk assessment including:
        - Financial risk analysis
        - Operational risk evaluation
        - Compliance screening
        - Regulatory risk assessment
        - Predictive analytics (3-12 months)
      operationId: assessRisk
      tags:
        - Risk Assessment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RiskAssessmentRequest'
            examples:
              basic_assessment:
                summary: Basic business risk assessment
                value:
                  business_name: "Acme Corporation"
                  business_address: "123 Main St, Anytown, ST 12345"
                  industry: "Technology"
                  country: "US"
                  phone: "+1-555-123-4567"
                  email: "contact@acme.com"
                  website: "https://www.acme.com"
                  prediction_horizon: 3
              extended_assessment:
                summary: Extended risk assessment with metadata
                value:
                  business_name: "Global Tech Solutions"
                  business_address: "456 Business Ave, Metropolis, NY 10001"
                  industry: "Financial Services"
                  country: "US"
                  phone: "+1-555-987-6543"
                  email: "info@globaltech.com"
                  website: "https://www.globaltech.com"
                  prediction_horizon: 6
                  metadata:
                    annual_revenue: 5000000
                    employee_count: 50
                    years_in_business: 10
      responses:
        '200':
          description: Risk assessment completed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RiskAssessmentResponse'
              examples:
                successful_assessment:
                  summary: Successful risk assessment
                  value:
                    id: "risk_1703123456789"
                    business_id: "biz_123456789"
                    risk_score: 0.75
                    risk_level: "medium"
                    risk_factors:
                      - category: "financial"
                        name: "Credit Score"
                        score: 0.8
                        weight: 0.3
                        description: "Business credit score analysis"
                        source: "internal"
                        confidence: 0.9
                      - category: "compliance"
                        name: "Regulatory Compliance"
                        score: 0.6
                        weight: 0.4
                        description: "Regulatory compliance check"
                        source: "external"
                        confidence: 0.8
                    prediction_horizon: 3
                    confidence_score: 0.85
                    status: "completed"
                    created_at: "2023-12-21T10:30:00Z"
                    updated_at: "2023-12-21T10:30:00Z"
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
        '429':
          description: Rate limit exceeded
        '500':
          description: Internal server error

  /assess/{id}:
    get:
      summary: Get risk assessment by ID
      description: Retrieves a specific risk assessment by its ID
      operationId: getRiskAssessment
      tags:
        - Risk Assessment
      parameters:
        - name: id
          in: path
          required: true
          description: Risk assessment ID
          schema:
            type: string
            example: "risk_1703123456789"
      responses:
        '200':
          description: Risk assessment retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RiskAssessmentResponse'
        '404':
          description: Risk assessment not found
        '500':
          description: Internal server error

  /assess/{id}/predict:
    post:
      summary: Generate risk prediction
      description: Generates risk predictions for future time periods using ML models
      operationId: predictRisk
      tags:
        - Risk Prediction
      parameters:
        - name: id
          in: path
          required: true
          description: Risk assessment ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                horizon_months:
                  type: integer
                  minimum: 1
                  maximum: 24
                  description: Prediction horizon in months
                  example: 6
                model_type:
                  type: string
                  enum: [auto, xgboost, lstm, ensemble]
                  description: ML model preference
                  example: "auto"
                include_temporal_analysis:
                  type: boolean
                  description: Include temporal analysis
                  example: true
                scenarios:
                  type: array
                  items:
                    type: string
                  description: Risk scenarios to analyze
                  example: ["optimistic", "realistic", "pessimistic"]
      responses:
        '200':
          description: Risk prediction generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RiskPrediction'
        '404':
          description: Risk assessment not found
        '500':
          description: Internal server error

  /risk/predict-advanced:
    post:
      summary: Advanced multi-horizon risk prediction
      description: |
        Performs advanced risk prediction with multiple horizons, model comparison,
        temporal analysis, and scenario analysis. Supports LSTM time-series prediction
        and ensemble model routing for optimal accuracy across different time horizons.
      operationId: predictRiskAdvanced
      tags:
        - Risk Prediction
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdvancedPredictionRequest'
            examples:
              multi_horizon_prediction:
                summary: Multi-horizon prediction with model comparison
                value:
                  business:
                    business_name: "Tech Startup Inc"
                    business_address: "456 Innovation Ave, Tech City, TC 54321"
                    industry: "technology"
                    country: "US"
                    phone: "+1-555-987-6543"
                    email: "info@techstartup.com"
                    website: "https://www.techstartup.com"
                  prediction_horizons: [3, 6, 9, 12]
                  model_preference: "auto"
                  include_temporal_analysis: true
                  include_scenario_analysis: true
                  include_model_comparison: true
                  confidence_threshold: 0.7
                  custom_scenarios: ["market_crash", "regulatory_change"]
              lstm_focused_prediction:
                summary: LSTM-focused long-term prediction
                value:
                  business:
                    business_name: "Manufacturing Corp"
                    business_address: "789 Industrial Blvd, Factory City, FC 67890"
                    industry: "manufacturing"
                    country: "US"
                  prediction_horizons: [6, 12, 18, 24]
                  model_preference: "lstm"
                  include_temporal_analysis: true
                  include_scenario_analysis: true
                  confidence_threshold: 0.8
      responses:
        '200':
          description: Advanced prediction completed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdvancedPredictionResponse'
              examples:
                successful_advanced_prediction:
                  summary: Successful advanced prediction
                  value:
                    request_id: "adv_pred_1703123456789"
                    business_id: "biz_123456789"
                    predictions:
                      "3":
                        horizon_months: 3
                        model_type: "xgboost"
                        predicted_score: 0.65
                        predicted_level: "medium"
                        confidence_score: 0.88
                        risk_factors: []
                        scenario_analysis: []
                        prediction_date: "2023-12-21T10:30:00Z"
                      "6":
                        horizon_months: 6
                        model_type: "lstm"
                        predicted_score: 0.72
                        predicted_level: "medium"
                        confidence_score: 0.82
                        risk_factors: []
                        scenario_analysis: []
                        prediction_date: "2023-12-21T10:30:00Z"
                    model_comparison:
                      horizons:
                        "3":
                          horizon_months: 3
                          xgboost_prediction:
                            horizon_months: 3
                            model_type: "xgboost"
                            predicted_score: 0.65
                            predicted_level: "medium"
                            confidence_score: 0.88
                          lstm_prediction:
                            horizon_months: 3
                            model_type: "lstm"
                            predicted_score: 0.68
                            predicted_level: "medium"
                            confidence_score: 0.75
                          ensemble_prediction:
                            horizon_months: 3
                            model_type: "ensemble"
                            predicted_score: 0.66
                            predicted_level: "medium"
                            confidence_score: 0.85
                          best_model: "xgboost"
                          confidence_difference: 0.13
                          score_difference: 0.03
                      best_model_per_horizon:
                        "3": "xgboost"
                        "6": "lstm"
                        "9": "lstm"
                        "12": "lstm"
                    temporal_analysis:
                      trend_analysis:
                        overall_trend: "stable"
                        trend_strength: 0.3
                        seasonal_patterns: ["q1_increase", "q4_decrease"]
                      volatility_analysis:
                        historical_volatility: 0.15
                        volatility_trend: "decreasing"
                        volatility_forecast: 0.12
                    scenario_analysis:
                      - scenario_name: "Optimistic"
                        description: "Best case scenario with favorable market conditions"
                        probability: 0.2
                        risk_score: 0.2
                        risk_level: "low"
                        impact: "low"
                        time_horizon: 3
                        key_factors: ["market_growth", "regulatory_support", "strong_financials"]
                        mitigation_strategies: ["maintain_current_strategy", "monitor_market_conditions"]
                    confidence_analysis:
                      overall_confidence: 0.85
                      confidence_by_horizon:
                        "3": 0.88
                        "6": 0.82
                        "9": 0.78
                        "12": 0.75
                      confidence_by_model:
                        "xgboost": 0.88
                        "lstm": 0.82
                        "ensemble": 0.85
                      low_confidence_predictions: [12]
                      high_confidence_predictions: [3, 6]
                      calibration_score: 0.85
                    processing_time: "PT0.125S"
                    generated_at: "2023-12-21T10:30:00Z"
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error

  /compliance/check:
    post:
      summary: Perform compliance check
      description: Performs comprehensive compliance screening including OFAC, UN, and EU sanctions
      operationId: checkCompliance
      tags:
        - Compliance
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                entity_name:
                  type: string
                  description: Name of the entity to check
                  example: "Acme Corporation"
                entity_type:
                  type: string
                  enum: [individual, organization, vessel, aircraft]
                  description: Type of entity
                  example: "organization"
                country:
                  type: string
                  description: Country code
                  example: "US"
      responses:
        '200':
          description: Compliance check completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComplianceCheck'
        '400':
          description: Invalid request
        '500':
          description: Internal server error

  /sanctions/screen:
    post:
      summary: Screen against sanctions lists
      description: Screens entity against OFAC, UN, EU, and other sanctions lists
      operationId: screenSanctions
      tags:
        - Compliance
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                entity_name:
                  type: string
                  description: Name of the entity to screen
                  example: "John Doe"
                entity_type:
                  type: string
                  enum: [individual, organization, vessel, aircraft]
                  description: Type of entity
                  example: "individual"
      responses:
        '200':
          description: Sanctions screening completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SanctionsCheck'
        '400':
          description: Invalid request
        '500':
          description: Internal server error

  /media/monitor:
    post:
      summary: Monitor adverse media
      description: Monitors for adverse media mentions and sentiment analysis
      operationId: monitorAdverseMedia
      tags:
        - Media Monitoring
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                entity_name:
                  type: string
                  description: Name of the entity to monitor
                  example: "Acme Corporation"
                keywords:
                  type: array
                  items:
                    type: string
                  description: Additional keywords to monitor
                  example: ["fraud", "scandal", "investigation"]
                days_back:
                  type: integer
                  description: Number of days to look back
                  example: 30
      responses:
        '200':
          description: Media monitoring completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdverseMedia'
        '400':
          description: Invalid request
        '500':
          description: Internal server error

  /analytics/trends:
    get:
      summary: Get risk trends
      description: Retrieves risk trend analytics and insights
      operationId: getRiskTrends
      tags:
        - Analytics
      parameters:
        - name: industry
          in: query
          description: Filter by industry
          schema:
            type: string
        - name: country
          in: query
          description: Filter by country
          schema:
            type: string
        - name: days
          in: query
          description: Number of days to analyze
          schema:
            type: integer
            default: 30
      responses:
        '200':
          description: Risk trends retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  trends:
                    type: array
                    items:
                      $ref: '#/components/schemas/RiskTrend'
                  insights:
                    type: array
                    items:
                      type: string
        '500':
          description: Internal server error

  # Phase 2-7 Enhanced Endpoints
  
  /risk/predict-advanced:
    post:
      summary: Advanced multi-horizon risk prediction
      description: |
        Performs advanced multi-horizon risk prediction with model comparison and temporal analysis.
        Supports LSTM, XGBoost, and ensemble models with confidence scoring.
      operationId: predictRiskAdvanced
      tags:
        - Risk Prediction
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [business_id, horizons]
              properties:
                business_id:
                  type: string
                  description: Business ID for prediction
                  example: "biz_123456789"
                horizons:
                  type: array
                  items:
                    type: integer
                  description: Prediction horizons in months
                  example: [3, 6, 12]
                model_types:
                  type: array
                  items:
                    type: string
                    enum: [xgboost, lstm, ensemble]
                  description: Models to compare
                  example: ["xgboost", "lstm", "ensemble"]
                include_temporal_analysis:
                  type: boolean
                  description: Include temporal trend analysis
                  example: true
                include_confidence_intervals:
                  type: boolean
                  description: Include confidence intervals
                  example: true
      responses:
        '200':
          description: Advanced prediction completed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdvancedPredictionResponse'
        '400':
          description: Invalid request data
        '404':
          description: Business not found
        '500':
          description: Internal server error

  /explain/{assessment_id}:
    get:
      summary: Get explainable AI insights
      description: |
        Retrieves SHAP-like explainable AI insights for a risk assessment,
        showing how each risk factor contributed to the overall risk score.
      operationId: getExplainability
      tags:
        - Explainability
      parameters:
        - name: assessment_id
          in: path
          required: true
          description: Risk assessment ID
          schema:
            type: string
            example: "risk_1234567890"
      responses:
        '200':
          description: Explainability insights retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExplainabilityResponse'
        '404':
          description: Assessment not found
        '500':
          description: Internal server error

  /scenarios/analyze:
    post:
      summary: Perform scenario analysis
      description: |
        Performs comprehensive scenario analysis with Monte Carlo simulations
        and stress testing for different risk scenarios.
      operationId: analyzeScenarios
      tags:
        - Scenario Analysis
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [business_id, scenarios]
              properties:
                business_id:
                  type: string
                  description: Business ID for analysis
                  example: "biz_123456789"
                scenarios:
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        type: string
                        example: "optimistic"
                      probability:
                        type: number
                        format: float
                        example: 0.2
                      description:
                        type: string
                        example: "Best-case scenario with favorable market conditions"
                monte_carlo_runs:
                  type: integer
                  description: Number of Monte Carlo simulation runs
                  example: 10000
                time_horizon:
                  type: integer
                  description: Analysis time horizon in months
                  example: 12
      responses:
        '200':
          description: Scenario analysis completed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScenarioAnalysisResponse'
        '400':
          description: Invalid request data
        '500':
          description: Internal server error

  /industries:
    get:
      summary: Get available industry-specific models
      description: |
        Retrieves available industry-specific risk models with their
        capabilities, accuracy metrics, and risk factors.
      operationId: getIndustries
      tags:
        - Industry Models
      responses:
        '200':
          description: Industry models retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IndustryModelsResponse'
        '500':
          description: Internal server error

  /assess/industry/{industry_id}:
    post:
      summary: Perform industry-specific risk assessment
      description: |
        Performs risk assessment using industry-specific model with
        specialized risk factors and validation rules.
      operationId: assessRiskIndustry
      tags:
        - Industry Models
      parameters:
        - name: industry_id
          in: path
          required: true
          description: Industry model ID
          schema:
            type: string
            example: "fintech"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/components/schemas/RiskAssessmentRequest'
                - type: object
                  properties:
                    industry_specific_data:
                      type: object
                      description: Industry-specific data fields
                      additionalProperties: true
      responses:
        '200':
          description: Industry-specific assessment completed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RiskAssessmentResponse'
        '400':
          description: Invalid request data
        '404':
          description: Industry model not found
        '500':
          description: Internal server error

  /experiments:
    post:
      summary: Create A/B testing experiment
      description: |
        Creates a new A/B testing experiment for model comparison,
        hyperparameter tuning, or feature testing.
      operationId: createExperiment
      tags:
        - A/B Testing
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, type, traffic_split]
              properties:
                name:
                  type: string
                  description: Experiment name
                  example: "LSTM vs XGBoost Comparison"
                description:
                  type: string
                  description: Experiment description
                  example: "Compare LSTM and XGBoost model performance"
                type:
                  type: string
                  enum: [model_comparison, hyperparameter, feature_testing]
                  description: Experiment type
                  example: "model_comparison"
                traffic_split:
                  type: object
                  description: Traffic distribution across variants
                  example: {"lstm_model": 0.5, "xgboost_model": 0.5}
                metrics:
                  type: array
                  items:
                    type: string
                  description: Metrics to track
                  example: ["accuracy", "latency", "confidence"]
                duration_days:
                  type: integer
                  description: Experiment duration in days
                  example: 30
      responses:
        '201':
          description: Experiment created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExperimentResponse'
        '400':
          description: Invalid request data
        '500':
          description: Internal server error

  /experiments/{experiment_id}/results:
    get:
      summary: Get experiment results
      description: |
        Retrieves A/B testing experiment results with statistical
        significance analysis and recommendations.
      operationId: getExperimentResults
      tags:
        - A/B Testing
      parameters:
        - name: experiment_id
          in: path
          required: true
          description: Experiment ID
          schema:
            type: string
            example: "exp_1234567890"
      responses:
        '200':
          description: Experiment results retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExperimentResultsResponse'
        '404':
          description: Experiment not found
        '500':
          description: Internal server error

  /validate/accuracy:
    post:
      summary: Validate model accuracy
      description: |
        Performs comprehensive model validation and accuracy testing
        with cross-validation and statistical analysis.
      operationId: validateModelAccuracy
      tags:
        - Model Validation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [validation_config]
              properties:
                validation_config:
                  type: object
                  properties:
                    num_samples:
                      type: integer
                      description: Number of validation samples
                      example: 1000
                    cross_validation_folds:
                      type: integer
                      description: Cross-validation folds
                      example: 5
                    target_accuracy:
                      type: number
                      format: float
                      description: Target accuracy threshold
                      example: 0.90
                    enable_calibration:
                      type: boolean
                      description: Enable model calibration
                      example: true
                    enable_ensemble:
                      type: boolean
                      description: Enable ensemble testing
                      example: true
                test_data:
                  type: array
                  items:
                    type: object
                  description: Optional test data for validation
      responses:
        '200':
          description: Model validation completed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModelValidationResponse'
        '400':
          description: Invalid request data
        '500':
          description: Internal server error

  /external/health:
    get:
      summary: Check external API health
      description: |
        Checks the health status of premium external API integrations
        including Thomson Reuters, OFAC, and World-Check.
      operationId: getExternalAPIHealth
      tags:
        - External APIs
      responses:
        '200':
          description: External API health status retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExternalAPIHealthResponse'
        '500':
          description: Internal server error

  /external/comprehensive:
    post:
      summary: Comprehensive external data lookup
      description: |
        Performs comprehensive external data lookup using all premium APIs
        for sanctions screening, adverse media monitoring, and compliance checks.
      operationId: getComprehensiveExternalData
      tags:
        - External APIs
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [business_name, business_address, country]
              properties:
                business_name:
                  type: string
                  description: Business name
                  example: "Acme Corporation"
                business_address:
                  type: string
                  description: Business address
                  example: "123 Main St, Anytown, ST 12345"
                country:
                  type: string
                  description: Country code
                  example: "US"
                include_sanctions:
                  type: boolean
                  description: Include sanctions screening
                  example: true
                include_adverse_media:
                  type: boolean
                  description: Include adverse media monitoring
                  example: true
                include_worldcheck:
                  type: boolean
                  description: Include World-Check screening
                  example: true
      responses:
        '200':
          description: Comprehensive external data retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComprehensiveExternalDataResponse'
        '400':
          description: Invalid request data
        '500':
          description: Internal server error

  /batch/assess:
    post:
      summary: Batch risk assessment
      description: |
        Performs batch risk assessment for multiple businesses with
        asynchronous processing and progress tracking.
      operationId: batchAssessRisk
      tags:
        - Batch Processing
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [businesses]
              properties:
                businesses:
                  type: array
                  items:
                    $ref: '#/components/schemas/RiskAssessmentRequest'
                  description: List of businesses to assess
                  maxItems: 1000
                options:
                  type: object
                  properties:
                    prediction_horizon:
                      type: integer
                      description: Default prediction horizon
                      example: 3
                    include_explainability:
                      type: boolean
                      description: Include explainability analysis
                      example: true
                    priority:
                      type: string
                      enum: [low, normal, high]
                      description: Processing priority
                      example: "normal"
      responses:
        '202':
          description: Batch assessment initiated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchAssessmentResponse'
        '400':
          description: Invalid request data
        '500':
          description: Internal server error

  /batch/{batch_id}/status:
    get:
      summary: Get batch processing status
      description: |
        Retrieves the status of a batch risk assessment job
        with progress information and results.
      operationId: getBatchStatus
      tags:
        - Batch Processing
      parameters:
        - name: batch_id
          in: path
          required: true
          description: Batch job ID
          schema:
            type: string
            example: "batch_1234567890"
      responses:
        '200':
          description: Batch status retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchStatusResponse'
        '404':
          description: Batch job not found
        '500':
          description: Internal server error

  /webhooks:
    post:
      summary: Create webhook endpoint
      description: |
        Creates a webhook endpoint for real-time notifications
        of risk assessment events and updates.
      operationId: createWebhook
      tags:
        - Webhooks
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [url, events]
              properties:
                url:
                  type: string
                  format: uri
                  description: Webhook endpoint URL
                  example: "https://api.example.com/webhooks/risk-assessment"
                events:
                  type: array
                  items:
                    type: string
                    enum: [assessment.completed, assessment.failed, prediction.updated, compliance.alert, sanctions.match, media.alert]
                  description: Events to subscribe to
                  example: ["assessment.completed", "prediction.updated"]
                secret:
                  type: string
                  description: Webhook secret for signature verification
                  example: "whsec_1234567890"
                active:
                  type: boolean
                  description: Whether webhook is active
                  example: true
      responses:
        '201':
          description: Webhook created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookResponse'
        '400':
          description: Invalid request data
        '500':
          description: Internal server error

  /webhooks/{webhook_id}:
    get:
      summary: Get webhook details
      description: Retrieves webhook configuration and delivery statistics
      operationId: getWebhook
      tags:
        - Webhooks
      parameters:
        - name: webhook_id
          in: path
          required: true
          description: Webhook ID
          schema:
            type: string
            example: "wh_1234567890"
      responses:
        '200':
          description: Webhook details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookResponse'
        '404':
          description: Webhook not found
        '500':
          description: Internal server error

    put:
      summary: Update webhook
      description: Updates webhook configuration and settings
      operationId: updateWebhook
      tags:
        - Webhooks
      parameters:
        - name: webhook_id
          in: path
          required: true
          description: Webhook ID
          schema:
            type: string
            example: "wh_1234567890"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                url:
                  type: string
                  format: uri
                  description: Webhook endpoint URL
                events:
                  type: array
                  items:
                    type: string
                    enum: [assessment.completed, assessment.failed, prediction.updated, compliance.alert, sanctions.match, media.alert]
                  description: Events to subscribe to
                secret:
                  type: string
                  description: Webhook secret for signature verification
                active:
                  type: boolean
                  description: Whether webhook is active
      responses:
        '200':
          description: Webhook updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookResponse'
        '400':
          description: Invalid request data
        '404':
          description: Webhook not found
        '500':
          description: Internal server error

    delete:
      summary: Delete webhook
      description: Deletes a webhook endpoint
      operationId: deleteWebhook
      tags:
        - Webhooks
      parameters:
        - name: webhook_id
          in: path
          required: true
          description: Webhook ID
          schema:
            type: string
            example: "wh_1234567890"
      responses:
        '204':
          description: Webhook deleted successfully
        '404':
          description: Webhook not found
        '500':
          description: Internal server error

  /performance/stats:
    get:
      summary: Get performance statistics
      description: |
        Retrieves real-time performance statistics including
        response times, throughput, error rates, and resource usage.
      operationId: getPerformanceStats
      tags:
        - Performance Monitoring
      responses:
        '200':
          description: Performance statistics retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PerformanceStatsResponse'
        '500':
          description: Internal server error

  /performance/health:
    get:
      summary: Get service health status
      description: |
        Retrieves comprehensive service health status including
        database connectivity, external API status, and system metrics.
      operationId: getServiceHealth
      tags:
        - Performance Monitoring
      responses:
        '200':
          description: Service health status retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
        '503':
          description: Service unhealthy
        '500':
          description: Internal server error

components:
  schemas:
    # Phase 2-7 Enhanced Schemas
    
    AdvancedPredictionResponse:
      type: object
      properties:
        business_id:
          type: string
          description: Business ID
          example: "biz_123456789"
        predictions:
          type: object
          additionalProperties:
            type: object
            properties:
              model_type:
                type: string
                example: "lstm"
              predictions:
                type: array
                items:
                  type: object
                  properties:
                    horizon_months:
                      type: integer
                      example: 6
                    predicted_score:
                      type: number
                      format: float
                      example: 0.72
                    predicted_level:
                      type: string
                      example: "medium"
                    confidence:
                      type: number
                      format: float
                      example: 0.85
                    confidence_interval:
                      type: object
                      properties:
                        lower:
                          type: number
                          format: float
                          example: 0.65
                        upper:
                          type: number
                          format: float
                          example: 0.79
        temporal_analysis:
          type: object
          properties:
            trend_direction:
              type: string
              enum: [improving, stable, deteriorating]
              example: "improving"
            trend_magnitude:
              type: number
              format: float
              example: 0.05
            volatility:
              type: number
              format: float
              example: 0.12
            seasonality:
              type: object
              properties:
                detected:
                  type: boolean
                  example: true
                period:
                  type: integer
                  example: 12
                strength:
                  type: number
                  format: float
                  example: 0.3
        model_comparison:
          type: object
          properties:
            best_model:
              type: string
              example: "lstm"
            model_scores:
              type: object
              additionalProperties:
                type: number
                format: float
              example: {"lstm": 0.92, "xgboost": 0.89, "ensemble": 0.91}
        created_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

    ExplainabilityResponse:
      type: object
      properties:
        assessment_id:
          type: string
          description: Risk assessment ID
          example: "risk_1234567890"
        explanation:
          type: object
          properties:
            overall_risk_score:
              type: number
              format: float
              example: 0.75
            feature_contributions:
              type: array
              items:
                type: object
                properties:
                  feature_name:
                    type: string
                    example: "credit_score"
                  contribution:
                    type: number
                    format: float
                    example: 0.15
                  weight:
                    type: number
                    format: float
                    example: 0.3
                  description:
                    type: string
                    example: "Business credit score contributed 15% to overall risk"
                  confidence:
                    type: number
                    format: float
                    example: 0.9
            shap_values:
              type: object
              additionalProperties:
                type: number
                format: float
              example: {"credit_score": 0.15, "industry_risk": 0.25, "geographic_risk": 0.1}
            explanation_summary:
              type: string
              example: "The risk assessment is primarily driven by industry risk (25%) and regulatory risk (20%)"
        created_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

    ScenarioAnalysisResponse:
      type: object
      properties:
        business_id:
          type: string
          description: Business ID
          example: "biz_123456789"
        scenario_analysis:
          type: object
          additionalProperties:
            type: object
            properties:
              risk_score:
                type: number
                format: float
                example: 0.75
              probability:
                type: number
                format: float
                example: 0.6
              confidence_interval:
                type: object
                properties:
                  lower:
                    type: number
                    format: float
                    example: 0.70
                  upper:
                    type: number
                    format: float
                    example: 0.80
              key_factors:
                type: array
                items:
                  type: string
                example: ["industry_volatility", "regulatory_changes"]
              mitigation_recommendations:
                type: array
                items:
                  type: string
                example: ["Enhance compliance monitoring", "Diversify revenue streams"]
        monte_carlo_results:
          type: object
          properties:
            mean_risk_score:
              type: number
              format: float
              example: 0.72
            standard_deviation:
              type: number
              format: float
              example: 0.15
            percentiles:
              type: object
              properties:
                "5th":
                  type: number
                  format: float
                  example: 0.45
                "25th":
                  type: number
                  format: float
                  example: 0.62
                "50th":
                  type: number
                  format: float
                  example: 0.72
                "75th":
                  type: number
                  format: float
                  example: 0.82
                "95th":
                  type: number
                  format: float
                  example: 0.95
        stress_test_results:
          type: object
          properties:
            crisis_scenario:
              type: object
              properties:
                risk_score:
                  type: number
                  format: float
                  example: 0.98
                survival_probability:
                  type: number
                  format: float
                  example: 0.15
                recovery_time:
                  type: integer
                  example: 24
            recovery_scenario:
              type: object
              properties:
                risk_score:
                  type: number
                  format: float
                  example: 0.35
                recovery_probability:
                  type: number
                  format: float
                  example: 0.85
                recovery_time:
                  type: integer
                  example: 12
        created_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

    IndustryModelsResponse:
      type: object
      properties:
        industries:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
                example: "fintech"
              name:
                type: string
                example: "Financial Technology"
              description:
                type: string
                example: "Specialized risk model for fintech companies"
              risk_factors:
                type: array
                items:
                  type: string
                example: ["payment_processing_risk", "regulatory_compliance", "cybersecurity_risk"]
              accuracy:
                type: number
                format: float
                example: 0.92
              supported_countries:
                type: array
                items:
                  type: string
                example: ["US", "UK", "EU", "CA"]
              last_updated:
                type: string
                format: date-time
                example: "2024-01-15T10:30:00Z"

    ExperimentResponse:
      type: object
      properties:
        experiment_id:
          type: string
          description: Experiment ID
          example: "exp_1234567890"
        name:
          type: string
          description: Experiment name
          example: "LSTM vs XGBoost Comparison"
        status:
          type: string
          enum: [active, completed, paused, cancelled]
          example: "active"
        traffic_split:
          type: object
          additionalProperties:
            type: number
            format: float
          example: {"lstm_model": 0.5, "xgboost_model": 0.5}
        metrics:
          type: array
          items:
            type: string
          example: ["accuracy", "latency", "confidence"]
        start_date:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        end_date:
          type: string
          format: date-time
          example: "2024-02-14T10:30:00Z"
        created_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

    ExperimentResultsResponse:
      type: object
      properties:
        experiment_id:
          type: string
          description: Experiment ID
          example: "exp_1234567890"
        status:
          type: string
          enum: [active, completed, paused, cancelled]
          example: "completed"
        results:
          type: object
          additionalProperties:
            type: object
            properties:
              accuracy:
                type: number
                format: float
                example: 0.92
              latency:
                type: number
                example: 150
              confidence:
                type: number
                format: float
                example: 0.88
              sample_size:
                type: integer
                example: 1000
        statistical_significance:
          type: object
          properties:
            p_value:
              type: number
              format: float
              example: 0.03
            confidence_level:
              type: number
              format: float
              example: 0.95
            winner:
              type: string
              example: "lstm_model"
            effect_size:
              type: number
              format: float
              example: 0.15
        recommendation:
          type: string
          example: "LSTM model shows statistically significant improvement in accuracy (3.4% increase)"

    ModelValidationResponse:
      type: object
      properties:
        validation_id:
          type: string
          description: Validation ID
          example: "val_1234567890"
        overall_accuracy:
          type: number
          format: float
          example: 0.92
        target_achieved:
          type: boolean
          example: true
        validation_metadata:
          type: object
          properties:
            num_samples:
              type: integer
              example: 1000
            validation_method:
              type: string
              example: "comprehensive"
            duration:
              type: integer
              example: 300
            cross_validation_folds:
              type: integer
              example: 5
        model_comparison:
          type: object
          properties:
            baseline_model:
              type: object
              properties:
                accuracy:
                  type: number
                  format: float
                  example: 0.85
                precision:
                  type: number
                  format: float
                  example: 0.82
                recall:
                  type: number
                  format: float
                  example: 0.88
                f1_score:
                  type: number
                  format: float
                  example: 0.85
            enhanced_model:
              type: object
              properties:
                accuracy:
                  type: number
                  format: float
                  example: 0.88
                precision:
                  type: number
                  format: float
                  example: 0.85
                recall:
                  type: number
                  format: float
                  example: 0.91
                f1_score:
                  type: number
                  format: float
                  example: 0.88
            ensemble_model:
              type: object
              properties:
                accuracy:
                  type: number
                  format: float
                  example: 0.92
                precision:
                  type: number
                  format: float
                  example: 0.90
                recall:
                  type: number
                  format: float
                  example: 0.94
                f1_score:
                  type: number
                  format: float
                  example: 0.92
            best_model:
              type: string
              example: "ensemble"
            improvement:
              type: number
              format: float
              example: 0.07
        recommendations:
          type: array
          items:
            type: string
          example: ["Model accuracy (92%) meets target (90%). Model is ready for production."]
        created_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

    ExternalAPIHealthResponse:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
          example: "healthy"
        services:
          type: object
          additionalProperties:
            type: object
            properties:
              status:
                type: string
                enum: [healthy, degraded, unhealthy]
                example: "healthy"
              response_time:
                type: integer
                example: 150
              last_check:
                type: string
                format: date-time
                example: "2024-01-15T10:30:00Z"
              error_rate:
                type: number
                format: float
                example: 0.01
        overall_health_score:
          type: number
          format: float
          example: 0.95
        last_updated:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

    ComprehensiveExternalDataResponse:
      type: object
      properties:
        business_name:
          type: string
          example: "Acme Corporation"
        external_data:
          type: object
          properties:
            thomson_reuters:
              type: object
              properties:
                risk_factors:
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        type: string
                        example: "revenue_growth_risk"
                      score:
                        type: number
                        format: float
                        example: 0.3
                      description:
                        type: string
                        example: "Strong revenue growth indicates low risk"
                confidence:
                  type: number
                  format: float
                  example: 0.9
            ofac:
              type: object
              properties:
                sanctions_matches:
                  type: integer
                  example: 0
                status:
                  type: string
                  example: "clear"
                last_updated:
                  type: string
                  format: date-time
                  example: "2024-01-15T10:30:00Z"
            worldcheck:
              type: object
              properties:
                adverse_media_count:
                  type: integer
                  example: 0
                risk_level:
                  type: string
                  example: "low"
                last_updated:
                  type: string
                  format: date-time
                  example: "2024-01-15T10:30:00Z"
        overall_external_risk:
          type: number
          format: float
          example: 0.35
        created_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

    BatchAssessmentResponse:
      type: object
      properties:
        batch_id:
          type: string
          description: Batch job ID
          example: "batch_1234567890"
        status:
          type: string
          enum: [queued, processing, completed, failed]
          example: "queued"
        total_businesses:
          type: integer
          example: 100
        processed_businesses:
          type: integer
          example: 0
        failed_businesses:
          type: integer
          example: 0
        estimated_completion_time:
          type: string
          format: date-time
          example: "2024-01-15T11:30:00Z"
        created_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

    BatchStatusResponse:
      type: object
      properties:
        batch_id:
          type: string
          description: Batch job ID
          example: "batch_1234567890"
        status:
          type: string
          enum: [queued, processing, completed, failed]
          example: "processing"
        progress:
          type: object
          properties:
            total:
              type: integer
              example: 100
            processed:
              type: integer
              example: 45
            failed:
              type: integer
              example: 2
            percentage:
              type: number
              format: float
              example: 45.0
        results:
          type: array
          items:
            type: object
            properties:
              business_id:
                type: string
                example: "biz_123456789"
              assessment_id:
                type: string
                example: "risk_1234567890"
              status:
                type: string
                enum: [completed, failed]
                example: "completed"
              risk_score:
                type: number
                format: float
                example: 0.75
              error_message:
                type: string
                example: null
        estimated_completion_time:
          type: string
          format: date-time
          example: "2024-01-15T11:30:00Z"
        created_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2024-01-15T10:45:00Z"

    WebhookResponse:
      type: object
      properties:
        webhook_id:
          type: string
          description: Webhook ID
          example: "wh_1234567890"
        url:
          type: string
          format: uri
          example: "https://api.example.com/webhooks/risk-assessment"
        events:
          type: array
          items:
            type: string
          example: ["assessment.completed", "prediction.updated"]
        active:
          type: boolean
          example: true
        delivery_stats:
          type: object
          properties:
            total_deliveries:
              type: integer
              example: 150
            successful_deliveries:
              type: integer
              example: 145
            failed_deliveries:
              type: integer
              example: 5
            success_rate:
              type: number
              format: float
              example: 0.967
        created_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

    PerformanceStatsResponse:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        response_times:
          type: object
          properties:
            p50:
              type: number
              example: 120
            p95:
              type: number
              example: 250
            p99:
              type: number
              example: 500
            average:
              type: number
              example: 135
        throughput:
          type: object
          properties:
            requests_per_minute:
              type: number
              example: 1250
            requests_per_second:
              type: number
              example: 20.8
        error_rates:
          type: object
          properties:
            total_errors:
              type: integer
              example: 15
            error_rate_percentage:
              type: number
              format: float
              example: 0.5
            error_breakdown:
              type: object
              additionalProperties:
                type: integer
              example: {"400": 5, "500": 10}
        resource_usage:
          type: object
          properties:
            cpu_usage_percentage:
              type: number
              format: float
              example: 45.2
            memory_usage_mb:
              type: number
              example: 1024
            database_connections:
              type: integer
              example: 25
        external_api_latency:
          type: object
          additionalProperties:
            type: number
          example: {"thomson_reuters": 150, "ofac": 200, "worldcheck": 180}

    HealthResponse:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
          example: "healthy"
        timestamp:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        version:
          type: string
          example: "2.0.0"
        uptime:
          type: integer
          example: 86400
        checks:
          type: object
          properties:
            database:
              type: object
              properties:
                status:
                  type: string
                  enum: [healthy, unhealthy]
                  example: "healthy"
                response_time:
                  type: number
                  example: 5
            redis:
              type: object
              properties:
                status:
                  type: string
                  enum: [healthy, unhealthy]
                  example: "healthy"
                response_time:
                  type: number
                  example: 2
            external_apis:
              type: object
              properties:
                status:
                  type: string
                  enum: [healthy, degraded, unhealthy]
                  example: "healthy"
                services:
                  type: object
                  additionalProperties:
                    type: string
                    enum: [healthy, degraded, unhealthy]
                  example: {"thomson_reuters": "healthy", "ofac": "healthy"}
        metrics:
          type: object
          properties:
            active_connections:
              type: integer
              example: 150
            requests_per_minute:
              type: number
              example: 1250
            error_rate:
              type: number
              format: float
              example: 0.005

    # Original Schemas
    RiskAssessmentRequest:
      type: object
      required:
        - business_name
        - business_address
        - industry
        - country
      properties:
        business_name:
          type: string
          description: Business name
          example: "Acme Corporation"
          minLength: 1
          maxLength: 255
        business_address:
          type: string
          description: Business address
          example: "123 Main St, Anytown, ST 12345"
          minLength: 10
          maxLength: 500
        industry:
          type: string
          description: Business industry
          example: "Technology"
          minLength: 1
          maxLength: 100
        country:
          type: string
          description: Country code (ISO 3166-1 alpha-2)
          example: "US"
          pattern: '^[A-Z]{2}$'
        phone:
          type: string
          description: Business phone number
          example: "+1-555-123-4567"
          pattern: '^\\+[1-9]\\d{1,14}$'
        email:
          type: string
          description: Business email address
          example: "contact@acme.com"
          format: email
        website:
          type: string
          description: Business website
          example: "https://www.acme.com"
          format: uri
        prediction_horizon:
          type: integer
          description: Prediction horizon in months
          example: 3
          minimum: 1
          maximum: 24
        metadata:
          type: object
          description: Additional metadata
          additionalProperties: true
        model_type:
          type: string
          enum: [auto, xgboost, lstm, ensemble]
          description: ML model preference for prediction
          example: "auto"
        include_temporal_analysis:
          type: boolean
          description: Include temporal analysis in response
          example: true

    RiskAssessmentResponse:
      type: object
      properties:
        id:
          type: string
          description: Risk assessment ID
          example: "risk_1703123456789"
        business_id:
          type: string
          description: Business ID
          example: "biz_123456789"
        risk_score:
          type: number
          format: float
          description: Overall risk score (0-1)
          example: 0.75
          minimum: 0
          maximum: 1
        risk_level:
          type: string
          enum: [low, medium, high, critical]
          description: Risk level classification
          example: "medium"
        risk_factors:
          type: array
          items:
            $ref: '#/components/schemas/RiskFactor'
        prediction_horizon:
          type: integer
          description: Prediction horizon in months
          example: 3
        confidence_score:
          type: number
          format: float
          description: Confidence score for the assessment
          example: 0.85
          minimum: 0
          maximum: 1
        status:
          type: string
          enum: [pending, completed, failed, error]
          description: Assessment status
          example: "completed"
        created_at:
          type: string
          format: date-time
          description: Creation timestamp
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp
        metadata:
          type: object
          description: Additional metadata
          additionalProperties: true

    RiskFactor:
      type: object
      properties:
        category:
          type: string
          enum: [financial, operational, compliance, reputational, regulatory, geopolitical, technology, environmental]
          description: Risk category
          example: "financial"
        name:
          type: string
          description: Risk factor name
          example: "Credit Score"
        score:
          type: number
          format: float
          description: Risk factor score (0-1)
          example: 0.8
          minimum: 0
          maximum: 1
        weight:
          type: number
          format: float
          description: Weight of this factor in overall score
          example: 0.3
          minimum: 0
          maximum: 1
        description:
          type: string
          description: Risk factor description
          example: "Business credit score analysis"
        source:
          type: string
          description: Data source
          example: "internal"
        confidence:
          type: number
          format: float
          description: Confidence in this factor (0-1)
          example: 0.9
          minimum: 0
          maximum: 1

    RiskPrediction:
      type: object
      properties:
        business_id:
          type: string
          description: Business ID
          example: "biz_123456789"
        prediction_date:
          type: string
          format: date-time
          description: Date of prediction
        horizon_months:
          type: integer
          description: Prediction horizon in months
          example: 6
        predicted_score:
          type: number
          format: float
          description: Predicted risk score
          example: 0.82
        predicted_level:
          type: string
          enum: [low, medium, high, critical]
          description: Predicted risk level
          example: "high"
        confidence_score:
          type: number
          format: float
          description: Confidence in prediction
          example: 0.78
        risk_factors:
          type: array
          items:
            $ref: '#/components/schemas/RiskFactor'
        scenario_analysis:
          type: array
          items:
            $ref: '#/components/schemas/ScenarioAnalysis'
        created_at:
          type: string
          format: date-time
          description: Creation timestamp

    ScenarioAnalysis:
      type: object
      properties:
        scenario_name:
          type: string
          description: Scenario name
          example: "optimistic"
        description:
          type: string
          description: Scenario description
          example: "Best case scenario with favorable market conditions"
        risk_score:
          type: number
          format: float
          description: Risk score for this scenario
          example: 0.65
        risk_level:
          type: string
          enum: [low, medium, high, critical]
          description: Risk level for this scenario
          example: "medium"
        probability:
          type: number
          format: float
          description: Probability of this scenario
          example: 0.3
        impact:
          type: string
          description: Impact description
          example: "Low impact on business operations"

    ComplianceCheck:
      type: object
      properties:
        check_type:
          type: string
          description: Type of compliance check
          example: "OFAC"
        status:
          type: string
          enum: [passed, failed, warning, error]
          description: Check status
          example: "passed"
        description:
          type: string
          description: Check description
          example: "OFAC sanctions screening completed"
        risk_level:
          type: string
          enum: [low, medium, high, critical]
          description: Risk level
          example: "low"
        details:
          type: object
          description: Additional check details
          additionalProperties: true
        checked_at:
          type: string
          format: date-time
          description: Check timestamp
        next_check_at:
          type: string
          format: date-time
          description: Next check due date

    SanctionsCheck:
      type: object
      properties:
        entity_name:
          type: string
          description: Entity name
          example: "John Doe"
        entity_type:
          type: string
          enum: [individual, organization, vessel, aircraft]
          description: Entity type
          example: "individual"
        match_type:
          type: string
          enum: [exact, partial, fuzzy, none]
          description: Match type
          example: "none"
        match_score:
          type: number
          format: float
          description: Match score (0-1)
          example: 0.0
        sanctions_list:
          type: string
          description: Sanctions list name
          example: "OFAC SDN"
        details:
          type: object
          description: Match details
          additionalProperties: true
        checked_at:
          type: string
          format: date-time
          description: Check timestamp

    AdverseMedia:
      type: object
      properties:
        title:
          type: string
          description: Article title
          example: "Company faces regulatory investigation"
        source:
          type: string
          description: Media source
          example: "Financial Times"
        url:
          type: string
          format: uri
          description: Article URL
          example: "https://ft.com/content/123456"
        published_at:
          type: string
          format: date-time
          description: Publication date
        sentiment:
          type: string
          enum: [positive, neutral, negative]
          description: Sentiment analysis
          example: "negative"
        risk_level:
          type: string
          enum: [low, medium, high, critical]
          description: Risk level
          example: "high"
        summary:
          type: string
          description: Article summary
          example: "Company under investigation for regulatory violations"
        keywords:
          type: array
          items:
            type: string
          description: Relevant keywords
          example: ["investigation", "regulatory", "violations"]

    RiskTrend:
      type: object
      properties:
        date:
          type: string
          format: date
          description: Trend date
        average_risk_score:
          type: number
          format: float
          description: Average risk score for the date
          example: 0.72
        risk_level_distribution:
          type: object
          properties:
            low:
              type: integer
              description: Number of low risk assessments
            medium:
              type: integer
              description: Number of medium risk assessments
            high:
              type: integer
              description: Number of high risk assessments
            critical:
              type: integer
              description: Number of critical risk assessments

    AdvancedPredictionRequest:
      type: object
      required:
        - business
        - prediction_horizons
      properties:
        business:
          $ref: '#/components/schemas/RiskAssessmentRequest'
        prediction_horizons:
          type: array
          items:
            type: integer
            minimum: 1
            maximum: 24
          description: List of prediction horizons in months
          example: [3, 6, 9, 12]
          minItems: 1
          maxItems: 5
        model_preference:
          type: string
          enum: [auto, xgboost, lstm, ensemble]
          description: ML model preference for prediction
          example: "auto"
          default: "auto"
        include_temporal_analysis:
          type: boolean
          description: Include temporal analysis in response
          example: true
          default: false
        include_scenario_analysis:
          type: boolean
          description: Include scenario analysis in response
          example: true
          default: false
        include_model_comparison:
          type: boolean
          description: Include model comparison analysis
          example: true
          default: false
        confidence_threshold:
          type: number
          format: float
          description: Minimum confidence threshold for predictions
          example: 0.7
          minimum: 0
          maximum: 1
          default: 0.6
        custom_scenarios:
          type: array
          items:
            type: string
          description: Custom scenarios to analyze
          example: ["market_crash", "regulatory_change"]
        metadata:
          type: object
          description: Additional metadata
          additionalProperties: true

    AdvancedPredictionResponse:
      type: object
      properties:
        request_id:
          type: string
          description: Unique request identifier
          example: "adv_pred_1703123456789"
        business_id:
          type: string
          description: Business identifier
          example: "biz_123456789"
        predictions:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/HorizonPrediction'
          description: Predictions for each requested horizon
        model_comparison:
          $ref: '#/components/schemas/ModelComparison'
        temporal_analysis:
          type: object
          description: Temporal analysis results
          additionalProperties: true
        scenario_analysis:
          type: array
          items:
            $ref: '#/components/schemas/AdvancedScenarioAnalysis'
          description: Scenario analysis results
        confidence_analysis:
          $ref: '#/components/schemas/ConfidenceAnalysis'
        processing_time:
          type: string
          format: duration
          description: Total processing time
          example: "PT0.125S"
        generated_at:
          type: string
          format: date-time
          description: Generation timestamp
        metadata:
          type: object
          description: Additional metadata
          additionalProperties: true

    HorizonPrediction:
      type: object
      properties:
        horizon_months:
          type: integer
          description: Prediction horizon in months
          example: 6
        model_type:
          type: string
          enum: [xgboost, lstm, ensemble]
          description: Model used for prediction
          example: "lstm"
        predicted_score:
          type: number
          format: float
          description: Predicted risk score
          example: 0.72
          minimum: 0
          maximum: 1
        predicted_level:
          type: string
          enum: [low, medium, high, critical]
          description: Predicted risk level
          example: "medium"
        confidence_score:
          type: number
          format: float
          description: Confidence in prediction
          example: 0.82
          minimum: 0
          maximum: 1
        risk_factors:
          type: array
          items:
            $ref: '#/components/schemas/RiskFactor'
          description: Risk factors contributing to prediction
        scenario_analysis:
          type: array
          items:
            $ref: '#/components/schemas/ScenarioAnalysis'
          description: Scenario analysis for this horizon
        prediction_date:
          type: string
          format: date-time
          description: Date of prediction
        model_info:
          type: object
          description: Model-specific information
          additionalProperties: true
        metadata:
          type: object
          description: Additional metadata
          additionalProperties: true

    ModelComparison:
      type: object
      properties:
        horizons:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/ModelComparisonHorizon'
          description: Model comparison for each horizon
        best_model_per_horizon:
          type: object
          additionalProperties:
            type: string
            enum: [xgboost, lstm, ensemble]
          description: Best model for each horizon
        agreement_analysis:
          $ref: '#/components/schemas/AgreementAnalysis'
        performance_metrics:
          $ref: '#/components/schemas/PerformanceMetrics'

    ModelComparisonHorizon:
      type: object
      properties:
        horizon_months:
          type: integer
          description: Horizon in months
          example: 6
        xgboost_prediction:
          $ref: '#/components/schemas/HorizonPrediction'
        lstm_prediction:
          $ref: '#/components/schemas/HorizonPrediction'
        ensemble_prediction:
          $ref: '#/components/schemas/HorizonPrediction'
        best_model:
          type: string
          enum: [xgboost, lstm, ensemble]
          description: Best performing model for this horizon
          example: "lstm"
        confidence_difference:
          type: number
          format: float
          description: Maximum confidence difference between models
          example: 0.13
        score_difference:
          type: number
          format: float
          description: Maximum score difference between models
          example: 0.03

    AgreementAnalysis:
      type: object
      properties:
        overall_agreement:
          type: number
          format: float
          description: Overall model agreement score
          example: 0.85
          minimum: 0
          maximum: 1
        agreement_by_horizon:
          type: object
          additionalProperties:
            type: number
            format: float
          description: Agreement score by horizon
        disagreement_threshold:
          type: number
          format: float
          description: Threshold for high disagreement
          example: 0.2
        high_disagreement_horizons:
          type: array
          items:
            type: integer
          description: Horizons with high model disagreement
          example: [12, 18]

    PerformanceMetrics:
      type: object
      properties:
        average_latency:
          type: string
          format: duration
          description: Average processing latency
          example: "PT0.095S"
        latency_by_model:
          type: object
          additionalProperties:
            type: string
            format: duration
          description: Latency by model type
        memory_usage:
          type: object
          additionalProperties:
            type: integer
          description: Memory usage by model (bytes)
        throughput:
          type: number
          format: float
          description: Requests per second
          example: 1500.0

    AdvancedScenarioAnalysis:
      type: object
      properties:
        scenario_name:
          type: string
          description: Scenario name
          example: "Optimistic"
        description:
          type: string
          description: Scenario description
          example: "Best case scenario with favorable market conditions"
        probability:
          type: number
          format: float
          description: Probability of scenario
          example: 0.2
          minimum: 0
          maximum: 1
        risk_score:
          type: number
          format: float
          description: Risk score for scenario
          example: 0.2
          minimum: 0
          maximum: 1
        risk_level:
          type: string
          enum: [low, medium, high, critical]
          description: Risk level for scenario
          example: "low"
        impact:
          type: string
          description: Impact description
          example: "low"
        time_horizon:
          type: integer
          description: Time horizon for scenario
          example: 3
        key_factors:
          type: array
          items:
            type: string
          description: Key factors influencing scenario
          example: ["market_growth", "regulatory_support", "strong_financials"]
        mitigation_strategies:
          type: array
          items:
            type: string
          description: Recommended mitigation strategies
          example: ["maintain_current_strategy", "monitor_market_conditions"]

    ConfidenceAnalysis:
      type: object
      properties:
        overall_confidence:
          type: number
          format: float
          description: Overall confidence score
          example: 0.85
          minimum: 0
          maximum: 1
        confidence_by_horizon:
          type: object
          additionalProperties:
            type: number
            format: float
          description: Confidence by prediction horizon
        confidence_by_model:
          type: object
          additionalProperties:
            type: number
            format: float
          description: Confidence by model type
        low_confidence_predictions:
          type: array
          items:
            type: integer
          description: Horizons with low confidence
          example: [12, 18]
        high_confidence_predictions:
          type: array
          items:
            type: integer
          description: Horizons with high confidence
          example: [3, 6]
        calibration_score:
          type: number
          format: float
          description: Model calibration score
          example: 0.85
          minimum: 0
          maximum: 1

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          description: Error message
          example: "Invalid request data"
        code:
          type: string
          description: Error code
          example: "VALIDATION_ERROR"
        details:
          type: object
          description: Additional error details
          additionalProperties: true

  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: Authorization
      description: API key for authentication
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token for authentication

security:
  - ApiKeyAuth: []
  - BearerAuth: []

tags:
  - name: Risk Assessment
    description: Core risk assessment operations with LSTM and ensemble support
  - name: Risk Prediction
    description: |
      ML-powered risk prediction and forecasting with:
      - LSTM time-series prediction for 6-12 month forecasts
      - Smart ensemble routing (XGBoost for 1-3mo, LSTM for 6-12mo, combined for 3-6mo)
      - Multi-horizon predictions with temporal analysis
      - Advanced scenario analysis and model comparison
  - name: Explainability
    description: |
      Explainable AI insights and SHAP-like feature contributions:
      - Feature importance analysis
      - Risk factor contribution breakdown
      - Model interpretability and transparency
  - name: Scenario Analysis
    description: |
      Advanced scenario analysis and stress testing:
      - Monte Carlo simulations
      - Stress testing scenarios
      - Risk scenario modeling
  - name: Industry Models
    description: |
      Industry-specific risk models and assessments:
      - 9 specialized industry models (FinTech, Healthcare, Technology, etc.)
      - Industry-specific risk factors and validation rules
      - Customized risk assessment for different sectors
  - name: A/B Testing
    description: |
      ML model experimentation and validation:
      - Model comparison experiments
      - Statistical significance testing
      - Performance optimization through experimentation
  - name: Model Validation
    description: |
      Model accuracy validation and testing:
      - Cross-validation and accuracy testing
      - Model performance benchmarking
      - Validation reporting and recommendations
  - name: External APIs
    description: |
      Premium external API integrations:
      - Thomson Reuters World-Check integration
      - OFAC/UN/EU sanctions screening
      - Comprehensive external data lookup
  - name: Batch Processing
    description: |
      Large-scale batch risk assessment:
      - Asynchronous batch processing
      - Progress tracking and monitoring
      - Bulk risk assessment capabilities
  - name: Webhooks
    description: |
      Real-time event notifications:
      - Webhook endpoint management
      - Event subscription and delivery
      - Delivery statistics and monitoring
  - name: Performance Monitoring
    description: |
      Service health and performance monitoring:
      - Real-time performance statistics
      - Service health checks
      - Resource usage monitoring
  - name: Compliance
    description: Compliance screening and sanctions checking
  - name: Media Monitoring
    description: Adverse media monitoring and sentiment analysis
  - name: Analytics
    description: Risk analytics and insights
