apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: risk-assessment-service
  annotations:
    config.kubernetes.io/local-config: "true"

namespace: kyb-platform

resources:
  - namespace.yaml
  - rbac.yaml
  - configmap.yaml
  - secrets.yaml
  - network-policies.yaml
  - pdb.yaml
  - deployment.yaml
  - service.yaml
  - hpa.yaml
  - ingress.yaml

commonLabels:
  app: risk-assessment-service
  component: risk-assessment
  version: v1.0.0
  managed-by: kustomize

commonAnnotations:
  description: "Risk Assessment Service for KYB Platform"
  contact: "platform-team@company.com"

images:
  - name: risk-assessment-service
    newTag: latest

patchesStrategicMerge:
  - |-
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: risk-assessment-service
    spec:
      template:
        spec:
          containers:
          - name: risk-assessment-service
            env:
            - name: ENVIRONMENT
              value: "production"
            - name: LOG_LEVEL
              value: "info"

configMapGenerator:
  - name: risk-assessment-config
    literals:
      - APP_NAME=Risk Assessment Service
      - APP_VERSION=1.0.0
      - ENVIRONMENT=production
    options:
      disableNameSuffixHash: true

secretGenerator:
  - name: risk-assessment-secrets
    literals:
      - database-url=postgresql://username:password@postgres-service:5432/risk_assessment
      - redis-url=redis://redis-service:6379/0
      - jwt-secret=your-super-secret-jwt-key
    options:
      disableNameSuffixHash: true

replicas:
  - name: risk-assessment-service
    count: 3

patchesJson6902:
  - target:
      group: autoscaling
      version: v2
      kind: HorizontalPodAutoscaler
      name: risk-assessment-service-hpa
    path: hpa-patch.yaml

generatorOptions:
  disableNameSuffixHash: true
  labels:
    app: risk-assessment-service
    component: risk-assessment
  annotations:
    config.kubernetes.io/local-config: "true"
