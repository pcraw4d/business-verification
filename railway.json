{
  "$schema": "https://railway.app/railway.schema.json",
  "services": [
    {
      "name": "classification-service",
      "source": ".",
      "build": {
        "builder": "DOCKERFILE",
        "dockerfilePath": "services/classification-service/Dockerfile",
        "watchPatterns": []
      },
      "deploy": {
        "startCommand": "./classification-service",
        "healthcheckPath": "/health",
        "healthcheckTimeout": 30,
        "restartPolicyType": "ON_FAILURE",
        "restartPolicyMaxRetries": 10
      },
      "environments": {
        "production": {
          "variables": {
            "ENV": "production",
            "LOG_LEVEL": "info"
          }
        },
        "staging": {
          "variables": {
            "ENV": "staging",
            "LOG_LEVEL": "debug"
          }
        }
      }
    },
    {
      "name": "risk-assessment-service",
      "source": ".",
      "build": {
        "builder": "DOCKERFILE",
        "dockerfilePath": "services/risk-assessment-service/Dockerfile.go123"
      },
      "deploy": {
        "startCommand": "./risk-assessment-service",
        "healthcheckPath": "/health",
        "healthcheckTimeout": 30,
        "restartPolicyType": "ON_FAILURE",
        "restartPolicyMaxRetries": 3
      },
      "environments": {
        "production": {
          "variables": {
            "ENVIRONMENT": "production",
            "LOG_LEVEL": "info",
            "PORT": "8080",
            "ENABLE_ENSEMBLE": "true",
            "DEFAULT_PREDICTION_HORIZON": "3",
            "CGO_ENABLED": "1",
            "CGO_LDFLAGS": "-L/app/onnxruntime/lib",
            "CGO_CFLAGS": "-I/app/onnxruntime/include",
            "LD_LIBRARY_PATH": "/app/onnxruntime/lib",
            "LSTM_MODEL_PATH": "/app/models/risk_lstm_v1.onnx",
            "XGBOOST_MODEL_PATH": "/app/models/xgb_model.json"
          }
        },
        "staging": {
          "variables": {
            "ENVIRONMENT": "staging",
            "LOG_LEVEL": "debug",
            "PORT": "8080"
          }
        }
      }
    },
    {
      "name": "merchant-service",
      "source": "services/merchant-service",
      "build": {
        "builder": "DOCKERFILE",
        "dockerfilePath": "Dockerfile",
        "dockerContext": "../.."
      },
      "deploy": {
        "startCommand": "./merchant-service",
        "healthcheckPath": "/health",
        "healthcheckTimeout": 30,
        "restartPolicyType": "ON_FAILURE",
        "restartPolicyMaxRetries": 10
      }
    },
    {
      "name": "api-gateway",
      "source": ".",
      "build": {
        "builder": "DOCKERFILE",
        "dockerfilePath": "services/api-gateway/Dockerfile"
      },
      "deploy": {
        "startCommand": "./api-gateway",
        "restartPolicyType": "ON_FAILURE",
        "restartPolicyMaxRetries": 10,
        "numReplicas": 1,
        "healthcheckPath": "/health",
        "healthcheckTimeout": 30,
        "healthcheckInterval": 60
      }
    },
    {
      "name": "frontend",
      "source": "services/frontend",
      "build": {
        "builder": "DOCKERFILE",
        "dockerfilePath": "Dockerfile"
      },
      "deploy": {
        "startCommand": "./frontend-server",
        "healthcheckPath": "/health",
        "healthcheckTimeout": 300,
        "restartPolicyType": "ON_FAILURE",
        "restartPolicyMaxRetries": 10,
        "numReplicas": 1,
        "cpu": "0.5",
        "memory": "256MB"
      }
    },
    {
      "name": "redis-cache",
      "source": "services/redis-cache",
      "build": {
        "builder": "DOCKERFILE",
        "dockerfilePath": "Dockerfile",
        "dockerContext": "."
      },
      "deploy": {
        "startCommand": "redis-server /usr/local/etc/redis/redis.conf",
        "restartPolicyType": "ON_FAILURE",
        "restartPolicyMaxRetries": 3
      }
    }
  ],
  "databases": [
    {
      "name": "postgres",
      "type": "postgresql",
      "version": "15"
    }
  ],
  "networking": {
    "ports": [
      {
        "port": 8080,
        "protocol": "http"
      }
    ]
  }
}
