<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frontend Compatibility Test - Classification API</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 6px;
            border-left: 4px solid #007bff;
        }
        .test-section h2 {
            margin-top: 0;
            color: #007bff;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background 0.2s;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .response {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
            border: 1px solid #dee2e6;
            max-height: 500px;
            overflow-y: auto;
        }
        .response pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 12px;
            line-height: 1.5;
        }
        .status {
            padding: 8px 12px;
            border-radius: 4px;
            margin-bottom: 10px;
            font-weight: 600;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .field-check {
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        .field-check.pass {
            background: #d4edda;
            color: #155724;
        }
        .field-check.fail {
            background: #f8d7da;
            color: #721c24;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Frontend Compatibility Test</h1>
        <p class="subtitle">Classification API - Manual Testing Interface</p>
        
        <div class="test-section">
            <h2>Test 1: Success Response</h2>
            <form id="successForm">
                <div class="form-group">
                    <label for="businessName">Business Name:</label>
                    <input type="text" id="businessName" value="Microsoft Corporation" required>
                </div>
                <div class="form-group">
                    <label for="description">Description:</label>
                    <textarea id="description" required>Software development</textarea>
                </div>
                <div class="form-group">
                    <label for="websiteUrl">Website URL (optional):</label>
                    <input type="url" id="websiteUrl" placeholder="https://example.com">
                </div>
                <button type="submit" id="successBtn">Test Success Response</button>
            </form>
            <div id="successResponse"></div>
        </div>
        
        <div class="test-section">
            <h2>Test 2: Error Response</h2>
            <form id="errorForm">
                <div class="form-group">
                    <label for="errorBusinessName">Business Name (empty to trigger error):</label>
                    <input type="text" id="errorBusinessName" value="">
                </div>
                <button type="submit" id="errorBtn">Test Error Response</button>
            </form>
            <div id="errorResponse"></div>
        </div>
    </div>

    <script>
        const API_URL = 'https://classification-service-production.up.railway.app/v1/classify';
        
        const requiredFields = [
            'request_id', 'business_name', 'primary_industry', 'classification',
            'confidence_score', 'explanation', 'status', 'success', 'timestamp', 'metadata'
        ];
        
        const requiredClassificationFields = [
            'industry', 'mcc_codes', 'naics_codes', 'sic_codes', 'explanation'
        ];
        
        function checkFields(response, containerId) {
            const container = document.getElementById(containerId);
            let html = '<div class="status success">‚úÖ Response received</div>';
            html += '<h3>Field Validation:</h3>';
            
            let allPassed = true;
            
            // Check top-level fields
            for (const field of requiredFields) {
                const exists = field in response;
                const status = exists ? 'pass' : 'fail';
                const icon = exists ? '‚úÖ' : '‚ùå';
                html += `<div class="field-check ${status}">${icon} ${field}: ${exists ? 'Present' : 'MISSING'}</div>`;
                if (!exists) allPassed = false;
            }
            
            // Check classification fields
            if (response.classification) {
                html += '<h4>Classification Fields:</h4>';
                for (const field of requiredClassificationFields) {
                    const exists = field in response.classification;
                    const status = exists ? 'pass' : 'fail';
                    const icon = exists ? '‚úÖ' : '‚ùå';
                    html += `<div class="field-check ${status}">${icon} classification.${field}: ${exists ? 'Present' : 'MISSING'}</div>`;
                    if (!exists) allPassed = false;
                }
                
                // Check structured explanation
                if (response.classification.explanation) {
                    const exp = response.classification.explanation;
                    const expFields = ['primary_reason', 'supporting_factors', 'key_terms_found', 'method_used', 'processing_path'];
                    html += '<h4>Structured Explanation Fields:</h4>';
                    for (const field of expFields) {
                        const exists = field in exp;
                        const status = exists ? 'pass' : 'fail';
                        const icon = exists ? '‚úÖ' : '‚ùå';
                        html += `<div class="field-check ${status}">${icon} classification.explanation.${field}: ${exists ? 'Present' : 'MISSING'}</div>`;
                        if (!exists) allPassed = false;
                    }
                } else {
                    html += '<div class="field-check fail">‚ùå classification.explanation: MISSING (null)</div>';
                    allPassed = false;
                }
                
                // Check arrays are not null
                const arrays = ['mcc_codes', 'naics_codes', 'sic_codes'];
                for (const arr of arrays) {
                    const isArray = Array.isArray(response.classification[arr]);
                    const status = isArray ? 'pass' : 'fail';
                    const icon = isArray ? '‚úÖ' : '‚ùå';
                    html += `<div class="field-check ${status}">${icon} classification.${arr}: ${isArray ? 'Array (not null)' : 'NULL'}</div>`;
                    if (!isArray) allPassed = false;
                }
            } else {
                html += '<div class="field-check fail">‚ùå classification: MISSING</div>';
                allPassed = false;
            }
            
            // Check metadata is not null
            const hasMetadata = response.metadata !== null && response.metadata !== undefined;
            const metadataStatus = hasMetadata ? 'pass' : 'fail';
            const metadataIcon = hasMetadata ? '‚úÖ' : '‚ùå';
            html += `<div class="field-check ${metadataStatus}">${metadataIcon} metadata: ${hasMetadata ? 'Object (not null)' : 'NULL'}</div>`;
            if (!hasMetadata) allPassed = false;
            
            // Overall status
            html += '<div style="margin-top: 20px; padding: 15px; border-radius: 4px; ' +
                    (allPassed ? 'background: #d4edda; color: #155724;' : 'background: #f8d7da; color: #721c24;') +
                    ' font-weight: 600;">' +
                    (allPassed ? '‚úÖ ALL FIELDS PRESENT - Frontend Compatible!' : '‚ùå SOME FIELDS MISSING - Not Frontend Compatible') +
                    '</div>';
            
            // Show full response
            html += '<h3>Full Response:</h3>';
            html += '<div class="response"><pre>' + JSON.stringify(response, null, 2) + '</pre></div>';
            
            container.innerHTML = html;
        }
        
        document.getElementById('successForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('successBtn');
            const container = document.getElementById('successResponse');
            
            btn.disabled = true;
            container.innerHTML = '<div class="loading"></div> Sending request...';
            
            try {
                const payload = {
                    business_name: document.getElementById('businessName').value,
                    description: document.getElementById('description').value
                };
                
                const websiteUrl = document.getElementById('websiteUrl').value;
                if (websiteUrl) {
                    payload.website_url = websiteUrl;
                }
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
                
                const data = await response.json();
                checkFields(data, 'successResponse');
            } catch (error) {
                container.innerHTML = '<div class="status error">‚ùå Error: ' + error.message + '</div>';
            } finally {
                btn.disabled = false;
            }
        });
        
        document.getElementById('errorForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('errorBtn');
            const container = document.getElementById('errorResponse');
            
            btn.disabled = true;
            container.innerHTML = '<div class="loading"></div> Sending request...';
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        business_name: document.getElementById('errorBusinessName').value
                    })
                });
                
                const data = await response.json();
                checkFields(data, 'errorResponse');
            } catch (error) {
                container.innerHTML = '<div class="status error">‚ùå Error: ' + error.message + '</div>';
            } finally {
                btn.disabled = false;
            }
        });
    </script>
</body>
</html>

